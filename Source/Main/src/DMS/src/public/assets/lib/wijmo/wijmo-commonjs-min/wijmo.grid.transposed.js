/*!
    *
    * Wijmo Library 5.20201.680
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(e,o){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,o){e.__proto__=o}||function(e,o){for(var r in o)o.hasOwnProperty(r)&&(e[r]=o[r])})(e,o)};return function(e,o){extendStatics(e,o);function __(){this.constructor=e}e.prototype=null===o?Object.create(o):(__.prototype=o.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var wijmo_1=require("wijmo/wijmo"),wijmo_grid_1=require("wijmo/wijmo.grid"),selfModule=require("wijmo/wijmo.grid.transposed"),TransposedGrid=function(e){__extends(TransposedGrid,e);function TransposedGrid(o,r){var t=e.call(this,o,null)||this;t._keyPrefix="item";t._autoGenRows=!0;wijmo_1.addClass(t.hostElement,"wj-transposed-grid");t.allowSorting=wijmo_grid_1.AllowSorting.None;t.headersVisibility=wijmo_grid_1.HeadersVisibility.Row;t._rowInfo=new wijmo_grid_1.ColumnCollection(t,t.columns.defaultSize);t.initialize(r);t._rowInfo.collectionChanged.addHandler(t._rowInfoChanged,t);t.deferUpdate((function(){var e=t.rowHeaders.columns;if(e.length){e[e.length-1].width=t.columns.defaultSize}}));return t}Object.defineProperty(TransposedGrid.prototype,"autoGenerateRows",{get:function(){return this._autoGenRows},set:function(e){this._autoGenRows=wijmo_1.asBoolean(e)},enumerable:!0,configurable:!0});TransposedGrid.prototype.refresh=function(o){var r=this._rowInfo;if(r._dirty){r._dirty=!1;this._rowInfoChanged()}else e.prototype.refresh.call(this,o)};Object.defineProperty(TransposedGrid.prototype,"allowAddNew",{get:function(){return!1},set:function(e){},enumerable:!0,configurable:!0});Object.defineProperty(TransposedGrid.prototype,"allowDelete",{get:function(){return!1},set:function(e){},enumerable:!0,configurable:!0});TransposedGrid.prototype.onRowEditEnded=function(o){if(null!=this._view){var r=new wijmo_1.NotifyCollectionChangedEventArgs(wijmo_1.NotifyCollectionChangedAction.Change);this._view.collectionChanged.raise(this._view,r)}e.prototype.onRowEditEnded.call(this,o)};TransposedGrid.prototype._getCollectionView=function(o){var r=this,t=null;null!=this._view&&this._view.collectionChanged.removeHandler(this._sourceViewChanged);if(wijmo_1.isArray(o))o=this._transposeItemsSource(o);else if(o){this._view&&this._view.collectionChanged.removeHandler(this._sourceViewChanged);this._view=wijmo_1.tryCast(o,"ICollectionView");if(this._view){this._view.collectionChanged.addHandler(this._sourceViewChanged,this);o instanceof wijmo_1.CollectionView&&(t=o.getError);o=this._transposeItemsSource(this._view.items)}}this.autoGenerateColumns=!0;var i=e.prototype._getCollectionView.call(this,o);t&&i instanceof wijmo_1.CollectionView&&(this._supportsProxies()?i.getError=function(e,o){var r=e._keys.indexOf(o);return t(e._arr[r],e._bnd.path)}:i.getError=function(e,o){var i=parseInt(o.substr(r._keyPrefix.length));return t(e._arr[i],e._rowInfo.binding)});return i};TransposedGrid.prototype._getColumnTypes=function(e){var o=this;if(this._view){var r=this._view.items;if(wijmo_1.isArray(r))return r.map((function(e,r){return{binding:o._keyPrefix+r,dataType:wijmo_1.DataType.Object}}))}return wijmo_1.getTypes(e)};TransposedGrid.prototype._copy=function(o,r){var t=this;if(/rows|columns/.test(o)){wijmo_1.assert(wijmo_1.isArray(r),"Array Expected.");this._rowInfo.deferUpdate((function(){t.autoGenerateRows=!1;t._rowInfo.clear();r.forEach((function(e){var o=new wijmo_grid_1.Column(e);t._rowInfo.push(o)}))}));return!0}return e.prototype._copy.call(this,o,r)};TransposedGrid.prototype.onLoadedRows=function(o){for(var r=this,t=this.rowHeaders.columns,i=0;i<t.length;i++)t[i].align="left";var n=this.columns;for(i=0;i<n.length;i++){var s=n[i];s.align=null;s.dataType=0}var a=wijmo_grid_1.FlexGrid._getSerializableProperties(wijmo_grid_1.Row);this.rows.forEach((function(e){var o=e.dataItem._rowInfo;if(o){for(var i in o)if(a.indexOf(i)>-1&&"showDropDown"!=i){var n=o[i];if(!wijmo_1.isUndefined(n))try{e[i]=n}catch(e){}}if(t.length){var s=o.header||wijmo_1.toHeaderCase(o.binding);r.rowHeaders.setCellData(e.index,t.length-1,s)}}}));e.prototype.onLoadedRows.call(this,o)};TransposedGrid.prototype._rowInfoChanged=function(){var e=this;this._toRowInfo&&clearTimeout(this._toRowInfo);this._toRowInfo=setTimeout((function(){var o=e.selection,r=e.itemsSource;e.itemsSource=null;e.itemsSource=r;e.selection=o}),wijmo_1.Control._REFRESH_INTERVAL)};TransposedGrid.prototype._sourceViewChanged=function(e,o){this.activeEditor||this.invalidate()};TransposedGrid.prototype._transposeItemsSource=function(e){var o=this,r=new wijmo_1.ObservableArray,t=wijmo_1.getTypes(e),i=e.map((function(e,r){return o._keyPrefix+r}));(this.autoGenerateRows?this._getRowInfo(e):this._rowInfo).forEach((function(n,s){var a=new wijmo_1.Binding(n.binding);if(null==n.dataType){var d=a.getValue(e[0]);n.dataType=null!=d?wijmo_1.getType(d):t[s].dataType}if(o._supportsProxies()){var l=o._createProxy(e,n,i);r.push(l)}else{var _=o._createTransposedObject(e,n,o._keyPrefix);r.push(_)}}));e instanceof wijmo_1.ObservableArray&&e.collectionChanged.addHandler((function(){var e=new wijmo_1.NotifyCollectionChangedEventArgs(wijmo_1.NotifyCollectionChangedAction.Reset);r.onCollectionChanged(e);o._rowInfoChanged()}));return r};TransposedGrid.prototype._supportsProxies=function(){return null!=window.Proxy};TransposedGrid.prototype._createProxy=function(e,o,r){var t={_arr:e,_rowInfo:o,_bnd:new wijmo_1.Binding(o.binding),_keys:r};return new Proxy(t,{ownKeys:function(e){return e._keys},getOwnPropertyDescriptor:function(){return{enumerable:!0,configurable:!0,writable:!0}},get:function(e,o){var r=e._keys.indexOf(o);return r>-1?e._bnd.getValue(e._arr[r]):e[o]},set:function(e,o,r){var t=e._keys.indexOf(o);if(t>-1){var i=e._arr,n=i[t];e._bnd.setValue(n,r);if(i instanceof wijmo_1.ObservableArray){var s=new wijmo_1.NotifyCollectionChangedEventArgs(wijmo_1.NotifyCollectionChangedAction.Change,n,t);i.onCollectionChanged(s)}return!0}return!1}})};TransposedGrid.prototype._createTransposedObject=function(e,o,r){for(var t={_arr:e,_rowInfo:o},i=new wijmo_1.Binding(o.binding),_loop_1=function(o){var n=e[o];Object.defineProperty(t,r+o,{enumerable:!0,get:function(){return i.getValue(n)},set:function(r){i.setValue(n,r);if(e instanceof wijmo_1.ObservableArray){var t=new wijmo_1.NotifyCollectionChangedEventArgs(wijmo_1.NotifyCollectionChangedAction.Change,n,o);e.onCollectionChanged(t)}return!0}})},n=0;n<e.length;n++)_loop_1(n);return t};TransposedGrid.prototype._getRowInfo=function(e){var o=this,r=[];wijmo_1.getTypes(e).forEach((function(e){var t=e.binding,i=e.dataType;if(i!=wijmo_1.DataType.Object&&i!=wijmo_1.DataType.Array){var n={binding:t,header:wijmo_1.toHeaderCase(t),dataType:i},s=wijmo_grid_1.FlexGrid._defTypeWidth[i];if(null!=s){if(wijmo_1.isString(s)){var a=Math.round(parseFloat(s));s=s.indexOf("*")<0?a:a*o.columns.defaultSize}wijmo_1.isNumber(s)&&s>0&&(n.width=s)}r.push(n)}}));return r};return TransposedGrid}(wijmo_grid_1.FlexGrid);exports.TransposedGrid=TransposedGrid;var TransposedGridRow=function(e){__extends(TransposedGridRow,e);function TransposedGridRow(){return null!==e&&e.apply(this,arguments)||this}return TransposedGridRow}(wijmo_grid_1.Column);exports.TransposedGridRow=TransposedGridRow;wijmo_1._registerModule("wijmo.grid.transposed",selfModule);