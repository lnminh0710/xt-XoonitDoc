/*!
    *
    * Wijmo Library 5.20201.680
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

"use strict";var _a,__extends=this&&this.__extends||function(){var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var DataMapEditor,wijmo_1=require("wijmo/wijmo"),mInput=require("wijmo/wijmo.input"),selfModule=require("wijmo/wijmo.grid");!function(e){e[e.AutoComplete=0]="AutoComplete";e[e.DropDownList=1]="DropDownList";e[e.RadioButtons=2]="RadioButtons"}(DataMapEditor=exports.DataMapEditor||(exports.DataMapEditor={}));var DataMap=function(){function DataMap(e,t,i){this.mapChanged=new wijmo_1.Event;if(wijmo_1.isArray(e)&&!t&&!i){e=e.map((function(e){return{value:e}}));t=i="value"}this._cv=wijmo_1.asCollectionView(e);this._keyPath=wijmo_1.asString(t,!1);this._displayPath=wijmo_1.asString(i,!1);this._cv.collectionChanged.addHandler(this.onMapChanged,this)}Object.defineProperty(DataMap.prototype,"sortByDisplayValues",{get:function(){return 1!=this._sortByKey},set:function(e){this._sortByKey=!wijmo_1.asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(DataMap.prototype,"collectionView",{get:function(){return this._cv},enumerable:!0,configurable:!0});Object.defineProperty(DataMap.prototype,"selectedValuePath",{get:function(){return this._keyPath},enumerable:!0,configurable:!0});Object.defineProperty(DataMap.prototype,"displayMemberPath",{get:function(){return this._displayPath},enumerable:!0,configurable:!0});DataMap.prototype.getDataItem=function(e){var t=this;if(!this._hash){var i=this._cv.sourceCollection,o={};wijmo_1.isArray(i)&&this._keyPath&&i.forEach((function(e){var i=e[t._keyPath];null==o[i]&&(o[i]=e)}));this._hash=o}return this._hash[e]};DataMap.prototype.getDisplayValue=function(e){var t=this._displayPath,i=this.getDataItem(e);return t&&i?i[t]:e};DataMap.prototype.getKeyValue=function(e,t){var i=this._displayPath,o=this._indexOf(e,i,t,!0);o<0&&(o=this._indexOf(e,i,t,!1));return o>-1?this._cv.sourceCollection[o][this._keyPath]:null};DataMap.prototype.getDisplayValues=function(e){var t=this;return this._cv&&this._displayPath?this._cv.items.map((function(e){return e[t._displayPath]})):[]};DataMap.prototype.getKeyValues=function(){var e=this;return this._cv&&this._keyPath?this._cv.items.map((function(t){return t[e._keyPath]})):[]};Object.defineProperty(DataMap.prototype,"isEditable",{get:function(){return this._editable},set:function(e){this._editable=wijmo_1.asBoolean(e)},enumerable:!0,configurable:!0});DataMap.prototype.onMapChanged=function(e){this._hash=null;this.mapChanged.raise(this,e)};DataMap.prototype._indexOf=function(e,t,i,o){var n=-1,r=-1;if(this._cv&&t)for(var l=null!=e?e.toString():"",s=o?l:l.toLowerCase(),a=this._cv.sourceCollection,c=0;c<a.length;c++){var d=a[c],u=d[t];i&&(u=wijmo_1.toPlainText(u));u==e?n=c:o||u.length!=s.length||u.toLowerCase()!=s?null!=u&&u.toString()==l&&(n=c):n=c;if(n==c){if(!this._cv.filter||this._cv.filter(d))return n;r<0&&(r=n)}}return r};return DataMap}();exports.DataMap=DataMap;var CellRange=function(){function CellRange(e,t,i,o){void 0===e&&(e=-1);void 0===t&&(t=-1);void 0===i&&(i=e);void 0===o&&(o=t);this.setRange(e,t,i,o)}CellRange.prototype.setRange=function(e,t,i,o){void 0===e&&(e=-1);void 0===t&&(t=-1);void 0===i&&(i=e);void 0===o&&(o=t);this._row=wijmo_1.asInt(e);this._col=wijmo_1.asInt(t);this._row2=wijmo_1.asInt(i);this._col2=wijmo_1.asInt(o)};Object.defineProperty(CellRange.prototype,"row",{get:function(){return this._row},set:function(e){this._row=wijmo_1.asInt(e)},enumerable:!0,configurable:!0});Object.defineProperty(CellRange.prototype,"col",{get:function(){return this._col},set:function(e){this._col=wijmo_1.asInt(e)},enumerable:!0,configurable:!0});Object.defineProperty(CellRange.prototype,"row2",{get:function(){return this._row2},set:function(e){this._row2=wijmo_1.asInt(e)},enumerable:!0,configurable:!0});Object.defineProperty(CellRange.prototype,"col2",{get:function(){return this._col2},set:function(e){this._col2=wijmo_1.asInt(e)},enumerable:!0,configurable:!0});CellRange.prototype.clone=function(){return new CellRange(this._row,this._col,this._row2,this._col2)};CellRange.prototype.copy=function(e){this.setRange(e._row,e._col,e._row2,e._col2)};Object.defineProperty(CellRange.prototype,"rowSpan",{get:function(){return Math.abs(this._row2-this._row)+1},enumerable:!0,configurable:!0});Object.defineProperty(CellRange.prototype,"columnSpan",{get:function(){return Math.abs(this._col2-this._col)+1},enumerable:!0,configurable:!0});Object.defineProperty(CellRange.prototype,"topRow",{get:function(){return Math.min(this._row,this._row2)},enumerable:!0,configurable:!0});Object.defineProperty(CellRange.prototype,"bottomRow",{get:function(){return Math.max(this._row,this._row2)},enumerable:!0,configurable:!0});Object.defineProperty(CellRange.prototype,"leftCol",{get:function(){return Math.min(this._col,this._col2)},enumerable:!0,configurable:!0});Object.defineProperty(CellRange.prototype,"rightCol",{get:function(){return Math.max(this._col,this._col2)},enumerable:!0,configurable:!0});Object.defineProperty(CellRange.prototype,"isValid",{get:function(){return this._row>-1&&this._col>-1&&this._row2>-1&&this._col2>-1},enumerable:!0,configurable:!0});Object.defineProperty(CellRange.prototype,"isSingleCell",{get:function(){return this._row==this._row2&&this._col==this._col2},enumerable:!0,configurable:!0});CellRange.prototype.contains=function(e,t){var i=wijmo_1.tryCast(e,CellRange);if(i)return i.topRow>=this.topRow&&i.bottomRow<=this.bottomRow&&i.leftCol>=this.leftCol&&i.rightCol<=this.rightCol;if(wijmo_1.isInt(e)&&wijmo_1.isInt(t))return e>=this.topRow&&e<=this.bottomRow&&t>=this.leftCol&&t<=this.rightCol;throw"contains expects a CellRange or row/column indices."};CellRange.prototype.containsRow=function(e){return wijmo_1.asInt(e)>=this.topRow&&e<=this.bottomRow};CellRange.prototype.containsColumn=function(e){return wijmo_1.asInt(e)>=this.leftCol&&e<=this.rightCol};CellRange.prototype.intersects=function(e){return this.intersectsRow(e)&&this.intersectsColumn(e)};CellRange.prototype.intersectsRow=function(e){return e&&!(this.bottomRow<e.topRow||this.topRow>e.bottomRow)};CellRange.prototype.intersectsColumn=function(e){return e&&!(this.rightCol<e.leftCol||this.leftCol>e.rightCol)};CellRange.prototype.getRenderSize=function(e){var t=new wijmo_1.Size(0,0);if(this.isValid){for(var i=this.topRow;i<=this.bottomRow;i++)t.height+=e.rows[i].renderSize;for(var o=this.leftCol;o<=this.rightCol;o++)t.width+=e.columns[o].renderSize}return t};CellRange.prototype.equals=function(e){return e instanceof CellRange&&this._row==e._row&&this._col==e._col&&this._row2==e._row2&&this._col2==e._col2};CellRange.prototype.combine=function(e){return e?new CellRange(Math.min(this.topRow,e.topRow),Math.min(this.leftCol,e.leftCol),Math.max(this.bottomRow,e.bottomRow),Math.max(this.rightCol,e.rightCol)):this};CellRange.prototype.toString=function(){return wijmo_1.format("({row}, {col})-({row2}, {col2})",this)};return CellRange}();exports.CellRange=CellRange;var CellRangeEventArgs=function(e){__extends(CellRangeEventArgs,e);function CellRangeEventArgs(t,i,o){var n=e.call(this)||this;n._p=wijmo_1.asType(t,GridPanel,!0);n._rng=wijmo_1.asType(i,CellRange,!0);n._data=o;return n}Object.defineProperty(CellRangeEventArgs.prototype,"panel",{get:function(){return this._p},enumerable:!0,configurable:!0});Object.defineProperty(CellRangeEventArgs.prototype,"range",{get:function(){return this._rng.clone()},enumerable:!0,configurable:!0});Object.defineProperty(CellRangeEventArgs.prototype,"row",{get:function(){return this._rng.row},enumerable:!0,configurable:!0});Object.defineProperty(CellRangeEventArgs.prototype,"col",{get:function(){return this._rng.col},enumerable:!0,configurable:!0});Object.defineProperty(CellRangeEventArgs.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!0,configurable:!0});CellRangeEventArgs.prototype.getRow=function(){return this._p&&this.row>-1?this._p.rows[this.row]:null};CellRangeEventArgs.prototype.getColumn=function(){return this._p&&this.col>-1?this._p.columns[this.col]:null};return CellRangeEventArgs}(wijmo_1.CancelEventArgs);exports.CellRangeEventArgs=CellRangeEventArgs;var FormatItemEventArgs=function(e){__extends(FormatItemEventArgs,e);function FormatItemEventArgs(t,i,o){var n=e.call(this,t,i)||this;n._cell=wijmo_1.asType(o,HTMLElement);return n}Object.defineProperty(FormatItemEventArgs.prototype,"cell",{get:function(){return this._cell},enumerable:!0,configurable:!0});return FormatItemEventArgs}(CellRangeEventArgs);exports.FormatItemEventArgs=FormatItemEventArgs;var SelectionMode,SelectedState,SelMove,CellEditEndingEventArgs=function(e){__extends(CellEditEndingEventArgs,e);function CellEditEndingEventArgs(){var t=null!==e&&e.apply(this,arguments)||this;t._stayInEditMode=!1;t._refresh=!0;return t}Object.defineProperty(CellEditEndingEventArgs.prototype,"stayInEditMode",{get:function(){return this._stayInEditMode},set:function(e){this._stayInEditMode=wijmo_1.asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(CellEditEndingEventArgs.prototype,"refresh",{get:function(){return this._refresh},set:function(e){this._refresh=wijmo_1.asBoolean(e)},enumerable:!0,configurable:!0});return CellEditEndingEventArgs}(CellRangeEventArgs);exports.CellEditEndingEventArgs=CellEditEndingEventArgs;!function(e){e[e.None=0]="None";e[e.Cell=1]="Cell";e[e.CellRange=2]="CellRange";e[e.Row=3]="Row";e[e.RowRange=4]="RowRange";e[e.ListBox=5]="ListBox";e[e.MultiRange=6]="MultiRange"}(SelectionMode=exports.SelectionMode||(exports.SelectionMode={}));!function(e){e[e.None=0]="None";e[e.Selected=1]="Selected";e[e.Cursor=2]="Cursor";e[e.Active=3]="Active"}(SelectedState=exports.SelectedState||(exports.SelectedState={}));!function(e){e[e.None=0]="None";e[e.Next=1]="Next";e[e.Prev=2]="Prev";e[e.NextPage=3]="NextPage";e[e.PrevPage=4]="PrevPage";e[e.Home=5]="Home";e[e.End=6]="End";e[e.NextCell=7]="NextCell";e[e.PrevCell=8]="PrevCell"}(SelMove=exports.SelMove||(exports.SelMove={}));var RowColFlags,_SelectionHandler=function(){function _SelectionHandler(e){this._sel=new CellRange(0,0);this._xSel=new wijmo_1.ObservableArray;this._mode=SelectionMode.CellRange;this._g=e;this._e=new CellRangeEventArgs(e.cells,new CellRange(0,0));this._xSel.collectionChanged.addHandler((function(){e.invalidate()}))}Object.defineProperty(_SelectionHandler.prototype,"selectionMode",{get:function(){return this._mode},set:function(e){e!=this._mode&&this._setSelectionMode(e)},enumerable:!0,configurable:!0});Object.defineProperty(_SelectionHandler.prototype,"selection",{get:function(){return this._sel},set:function(e){this.select(e)},enumerable:!0,configurable:!0});Object.defineProperty(_SelectionHandler.prototype,"extendedSelection",{get:function(){return this._xSel},enumerable:!0,configurable:!0});_SelectionHandler.prototype.select=function(e,t,i){void 0===t&&(t=!0);void 0===i&&(i=!1);var o=this._g,n=this._e.range,r=this._sel,l=n,s=!1,a=SelectionMode;if(wijmo_1.isNumber(e)&&wijmo_1.isNumber(t)){n.setRange(e,t);t=!0}else e instanceof CellRange?n.copy(e):wijmo_1.assert(!1,"CellRange expected");switch(o.selectionMode){case a.Cell:l.row2=l.row;l.col2=l.col;break;case a.Row:l.row2=l.row;break;case a.ListBox:s=!0}var c=l.equals(r);s&&l.row>-1&&l.row<o.rows.length&&(o.rows[l.row].isSelected||(c=!1));if(c&&o.isRangeValid(l)){t&&this._showSelection();return!0}var d=this._e;d._rng=l;d.cancel=!1;if(!o.onSelectionChanging(d)&&!i)return!1;s&&(l.row!=r.row||l.rowSpan>1||r.rowSpan>1)&&o.rows.forEach((function(e,t){e._setFlag(RowColFlags.Selected,l.containsRow(t),!0)}));l.row=Math.min(l.row,o.rows.length-1);l.row2=Math.min(l.row2,o.rows.length-1);this._sel.copy(l);o.refreshCells(!1,!0,!0);t&&this._showSelection();var u=o.collectionView;if(u){var h=o._getCvIndex(l.row);u.moveCurrentToPosition(h)}o.onSelectionChanged(d);return!0};_SelectionHandler.prototype.moveSelection=function(e,t,i){var o=this._g,n=this._sel,r=i&&o.anchorCursor?new CellRange(n.row2,n.col2):new CellRange(n.row,n.col);this._adjustReferenceCell(r,e,t);var l=r.row,s=r.col,a=o.rows,c=o.columns,d=Math.max(0,o._szClient.height-o.columnHeaders.height),u=SelMove;switch(t){case u.NextCell:if((s=c.getNextCell(s,u.Next,d))==r.col&&(l=a.getNextCell(l,u.Next,d))>r.row){s=c.getNextCell(0,u.Next,d);s=c.getNextCell(s,u.Prev,d)}o.select(l,s);break;case u.PrevCell:if((s=c.getNextCell(r.col,u.Prev,d))==r.col&&(l=a.getNextCell(l,u.Prev,d))<r.row){s=c.getNextCell(c.length-1,u.Prev,d);s=c.getNextCell(s,u.Next,d)}o.select(l,s);break;default:l=a.getNextCell(l,e,d);s=c.getNextCell(s,t,d);i?o.selection=o.anchorCursor?new CellRange(n.row,n.col,l,s):new CellRange(l,s,n.row2,n.col2):o.select(l,s)}};_SelectionHandler.prototype._setSelectionMode=function(e){var t=this._g,i=t.rows,o=SelectionMode;if(e==o.ListBox||this._mode==o.ListBox)for(var n=0;n<i.length;n++){var r=e==o.ListBox&&this._sel.containsRow(n);i[n]._setFlag(RowColFlags.Selected,r,!0)}this._mode=e;this._xSel.clear();if(i.length){r=this._sel;r=e!=o.None?new CellRange(r.row,r.col):new CellRange;this.select(r,!1,!0);t.invalidate()}};_SelectionHandler.prototype._expandSelection=function(){var e=this._g;if(e.expandSelectionOnCopyPaste&&e.selectionMode){var t=this.selection,i=e.cells,o=e.getMergedRange(i,t.topRow,t.leftCol,!1),n=e.getMergedRange(i,t.bottomRow,t.leftCol,!1),r=e.getMergedRange(i,t.topRow,t.rightCol,!1),l=e.getMergedRange(i,t.bottomRow,t.rightCol,!1);if(o||n||r||l){o=o||new CellRange(t.topRow,t.leftCol);n=n||new CellRange(t.bottomRow,t.leftCol);r=r||new CellRange(t.topRow,t.rightCol);l=l||new CellRange(t.bottomRow,t.rightCol);var s=new CellRange(Math.min(o.topRow,n.topRow,r.topRow,l.topRow),Math.min(o.leftCol,n.leftCol,r.leftCol,l.leftCol),Math.max(o.bottomRow,n.bottomRow,r.bottomRow,l.bottomRow),Math.max(o.rightCol,n.rightCol,r.rightCol,l.rightCol));this.select(s,!1)}}};_SelectionHandler.prototype._deselectRange=function(e){var t=this.selection,i=this.extendedSelection;if(t.contains(e)){var o=i.length;this._sel=o?i[o-1]:new CellRange;o&&i.removeAt(o-1);return!0}for(var n=0;n<i.length;n++)if(i[n].contains(e)){i.removeAt(n);return!0}return!1};_SelectionHandler.prototype._showSelection=function(){var e=this._g,t=this._sel;e.anchorCursor?e.scrollIntoView(t.row2,t.col2):e.scrollIntoView(t.row,t.col)};_SelectionHandler.prototype._adjustReferenceCell=function(e,t,i){var o=this._g,n=o.getMergedRange(o.cells,e.row,e.col);if(n&&!n.isSingleCell){var r=SelMove;switch(t){case r.Next:case r.NextCell:e.row=n.bottomRow;break;case r.Prev:case r.PrevCell:e.row=n.topRow}switch(i){case r.Next:case r.NextCell:e.col=n.rightCol;break;case r.Prev:case r.PrevCell:e.col=n.leftCol}}};return _SelectionHandler}();exports._SelectionHandler=_SelectionHandler;!function(e){e[e.Visible=1]="Visible";e[e.AllowResizing=2]="AllowResizing";e[e.AllowDragging=4]="AllowDragging";e[e.AllowMerging=8]="AllowMerging";e[e.AllowSorting=16]="AllowSorting";e[e.AutoGenerated=32]="AutoGenerated";e[e.Collapsed=64]="Collapsed";e[e.ParentCollapsed=128]="ParentCollapsed";e[e.Selected=256]="Selected";e[e.ReadOnly=512]="ReadOnly";e[e.HtmlContent=1024]="HtmlContent";e[e.WordWrap=2048]="WordWrap";e[e.MultiLine=4096]="MultiLine";e[e.HasTemplate=8192]="HasTemplate";e[e.RowDefault=3]="RowDefault";e[e.ColumnDefault=23]="ColumnDefault"}(RowColFlags=exports.RowColFlags||(exports.RowColFlags={}));var RowCol=function(){function RowCol(){this._pos=0;this._idx=-1;this._idxVis=-1;this._idxData=-1;this.gridChanged=new wijmo_1.Event}Object.defineProperty(RowCol.prototype,"binding",{get:function(){return this._binding?this._binding.path:null},set:function(e){if(e!=this.binding){var t=wijmo_1.asString(e);this._binding=t?new wijmo_1.Binding(t):null;if(!this._type&&this.grid&&this._binding){var i=this.grid.collectionView;if(i&&i.sourceCollection&&i.sourceCollection.length){var o=i.sourceCollection[0];this._type=wijmo_1.getType(this._binding.getValue(o))}}this.onPropertyChanged()}},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"sortMemberPath",{get:function(){return this._bindingSort?this._bindingSort.path:null},set:function(e){if(e!=this.sortMemberPath){var t=wijmo_1.asString(e);this._bindingSort=t?new wijmo_1.Binding(t):null;this.onPropertyChanged()}},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"dataType",{get:function(){return this._type},set:function(e){e=wijmo_1.asEnum(e,wijmo_1.DataType,!0);if(this._type!=e){this._type=e;this.grid&&this.grid.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"inputType",{get:function(){return this._inpType},set:function(e){this._inpType=wijmo_1.asString(e,!0)},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"mask",{get:function(){return this._mask},set:function(e){this._mask=wijmo_1.asString(e,!0)},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"maxLength",{get:function(){return this._maxLen},set:function(e){this._maxLen=wijmo_1.asNumber(e,!0,!0)},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"align",{get:function(){return this._align},set:function(e){if(this._align!=e){this._align=e;this.onPropertyChanged()}},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"format",{get:function(){return this._fmt},set:function(e){if(this._fmt!=e){this._fmt=e;this.onPropertyChanged()}},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"dataMap",{get:function(){return this._map},set:function(e){if(this._map!=e){this._map&&this._map.mapChanged.removeHandler(this.onPropertyChanged,this);wijmo_1.isArray(e)&&(e=new DataMap(e,null,null));this._map=wijmo_1.asType(e,DataMap,!0);this._map&&this._map.mapChanged.addHandler(this.onPropertyChanged,this);this.onPropertyChanged()}},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"dataMapEditor",{get:function(){return null!=this._mapEditor?this._mapEditor:DataMapEditor.DropDownList},set:function(e){if(e!=this._mapEditor){this._mapEditor=wijmo_1.asEnum(e,DataMapEditor);this.grid&&this.grid.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"showDropDown",{get:function(){return this.dataMapEditor==DataMapEditor.DropDownList},set:function(e){wijmo_1._deprecated("showDropDown","dataMapEditor");this.dataMapEditor=e?DataMapEditor.DropDownList:DataMapEditor.AutoComplete},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"dropDownCssClass",{get:function(){return this._ddCssClass},set:function(e){this._ddCssClass=wijmo_1.asString(e)},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"visible",{get:function(){return this._getFlag(RowColFlags.Visible)},set:function(e){this._setFlag(RowColFlags.Visible,e)},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"isVisible",{get:function(){return!!this._getFlag(RowColFlags.Visible)&&(!this._getFlag(RowColFlags.ParentCollapsed)||this instanceof _NewRowTemplate)},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"pos",{get:function(){this._list&&this._list._dirty&&this._list._update();return this._pos},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"index",{get:function(){this._list&&this._list._dirty&&this._list._update();return this._idx},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"visibleIndex",{get:function(){this._list&&this._list._dirty&&this._list._update();return this.isVisible?this._idxVis:-1},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"size",{get:function(){return this._sz},set:function(e){if(e!=this._sz){this._sz=wijmo_1.asNumber(e,!0);this.onPropertyChanged()}},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"renderSize",{get:function(){var e=0,t=this._list;if(this.isVisible){(null==(e=this._sz)||e<0)&&(e=t?t.defaultSize:0);t&&null!=t.minSize&&e<t.minSize&&(e=t.minSize);t&&null!=t.maxSize&&e>t.maxSize&&(e=t.maxSize);null!=this._szMin&&e<this._szMin&&(e=this._szMin);null!=this._szMax&&e>this._szMax&&(e=this._szMax)}return e},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"allowResizing",{get:function(){return this._getFlag(RowColFlags.AllowResizing)},set:function(e){this._setFlag(RowColFlags.AllowResizing,e)},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"allowDragging",{get:function(){return this._getFlag(RowColFlags.AllowDragging)},set:function(e){this._setFlag(RowColFlags.AllowDragging,e)},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"allowMerging",{get:function(){return this._getFlag(RowColFlags.AllowMerging)},set:function(e){this._setFlag(RowColFlags.AllowMerging,e)},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"isSelected",{get:function(){return this._getFlag(RowColFlags.Selected)},set:function(e){if(this._setFlag(RowColFlags.Selected,e,!0)){var t=this.grid;t&&t.refreshCells(!1,!0,!0)}},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"isReadOnly",{get:function(){return this._getFlag(RowColFlags.ReadOnly)},set:function(e){this._setFlag(RowColFlags.ReadOnly,e)},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"isRequired",{get:function(){return this._required},set:function(e){this._required=wijmo_1.asBoolean(e,!0)},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"isContentHtml",{get:function(){return this._getFlag(RowColFlags.HtmlContent)},set:function(e){if(this.isContentHtml!=e){this._setFlag(RowColFlags.HtmlContent,e);this.grid&&this.grid.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"wordWrap",{get:function(){return this._getFlag(RowColFlags.WordWrap)},set:function(e){this._setFlag(RowColFlags.WordWrap,e)},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"multiLine",{get:function(){return this._getFlag(RowColFlags.MultiLine)},set:function(e){this._setFlag(RowColFlags.MultiLine,e)},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"cssClass",{get:function(){return this._cssClass},set:function(e){if(e!=this._cssClass){this._cssClass=wijmo_1.asString(e);this.grid&&this.grid.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"cssClassAll",{get:function(){return this._cssClassAll},set:function(e){if(e!=this._cssClassAll){this._cssClassAll=wijmo_1.asString(e);this.grid&&this.grid.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"grid",{get:function(){return this._list?this._list._g:null},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"collectionView",{get:function(){return this.grid?this.grid.collectionView:null},enumerable:!0,configurable:!0});RowCol.prototype.onPropertyChanged=function(){if(this._list){this._list._dirty=!0;this.grid.invalidate()}};RowCol.prototype.onGridChanged=function(e){this.gridChanged.raise(this,e)};RowCol.prototype._setList=function(e){if(e!=this._list){this._list=e;this.onGridChanged()}};RowCol.prototype._getFlag=function(e){return 0!=(this._f&e)};RowCol.prototype._setFlag=function(e,t,i){if(t!=this._getFlag(e)){this._f=t?this._f|e:this._f&~e;i||this.onPropertyChanged();return!0}return!1};return RowCol}();exports.RowCol=RowCol;var Column=function(e){__extends(Column,e);function Column(t){var i=e.call(this)||this;i._f=RowColFlags.ColumnDefault;i._hash=Column._ctr.toString(36);Column._ctr++;t&&wijmo_1.copy(i,t);return i}Object.defineProperty(Column.prototype,"name",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!0,configurable:!0});Object.defineProperty(Column.prototype,"width",{get:function(){return null!=this._szStar?this._szStar:this.size},set:function(e){if(null!=Column._parseStarSize(e)){this._szStar=e;this.onPropertyChanged()}else{this._szStar=null;this.size=wijmo_1.asNumber(e,!0)}},enumerable:!0,configurable:!0});Object.defineProperty(Column.prototype,"minWidth",{get:function(){return this._szMin},set:function(e){if(e!=this._szMin){this._szMin=wijmo_1.asNumber(e,!0,!0);this.onPropertyChanged()}},enumerable:!0,configurable:!0});Object.defineProperty(Column.prototype,"maxWidth",{get:function(){return this._szMax},set:function(e){if(e!=this._szMax){this._szMax=wijmo_1.asNumber(e,!0,!0);this.onPropertyChanged()}},enumerable:!0,configurable:!0});Object.defineProperty(Column.prototype,"quickAutoSize",{get:function(){return this._quickSize},set:function(e){this._quickSize=wijmo_1.asBoolean(e,!0)},enumerable:!0,configurable:!0});Column.prototype._getQuickAutoSize=function(){return!!this.grid._getQuickAutoSize()&&(wijmo_1.isBoolean(this._quickSize)?this._quickSize:!(this.isContentHtml||this.wordWrap||this.multiLine||this._getFlag(RowColFlags.HasTemplate)))};Object.defineProperty(Column.prototype,"renderWidth",{get:function(){return this.renderSize},enumerable:!0,configurable:!0});Object.defineProperty(Column.prototype,"header",{get:function(){return this._hdr?this._hdr:this.binding},set:function(e){if(this._hdr!=e){this._hdr=e;this.onPropertyChanged()}},enumerable:!0,configurable:!0});Object.defineProperty(Column.prototype,"cellTemplate",{get:function(){return this._tpl},set:function(e){if(e!=this._tpl){wijmo_1.assert(null==e||wijmo_1.isString(e)||wijmo_1.isFunction(e),"cellTemplate should be a string or an ICellTemplateFunction.");this._tpl=e;this._setFlag(RowColFlags.HasTemplate,null!=e&&""!=e);this.onPropertyChanged()}},enumerable:!0,configurable:!0});Object.defineProperty(Column.prototype,"allowSorting",{get:function(){return this._getFlag(RowColFlags.AllowSorting)},set:function(e){this._setFlag(RowColFlags.AllowSorting,e)},enumerable:!0,configurable:!0});Object.defineProperty(Column.prototype,"currentSort",{get:function(){var e=this.currentSortIndex;if(e>-1){return this.grid.collectionView.sortDescriptions[e].ascending?"+":"-"}return null},enumerable:!0,configurable:!0});Object.defineProperty(Column.prototype,"currentSortIndex",{get:function(){var e=this.grid?this.grid.collectionView:null,t=e?e.sortDescriptions:null,i=t&&t.length?this._getBindingSort():null;if(i)for(var o=0;o<t.length;o++)if(t[o].property==i)return o;return-1},enumerable:!0,configurable:!0});Object.defineProperty(Column.prototype,"aggregate",{get:function(){return null!=this._agg?this._agg:wijmo_1.Aggregate.None},set:function(e){if((e=wijmo_1.asEnum(e,wijmo_1.Aggregate))!=this._agg){this._agg=e;this.onPropertyChanged()}},enumerable:!0,configurable:!0});Object.defineProperty(Column.prototype,"describedById",{get:function(){return this._descById},set:function(e){if(e!=this._descById){this._descById=wijmo_1.asString(e);this.grid&&this.grid.invalidate()}},enumerable:!0,configurable:!0});Column.prototype.getIsRequired=function(e){return null!=this._required?this._required:e&&null!=e.isRequired?e.isRequired:this.dataType==wijmo_1.DataType.String?null!=this.dataMap||null!=this._mask&&this._mask.length>0:!e||e.dataType!=wijmo_1.DataType.String||(null!=e.dataMap||null!=e.mask&&e.mask.length>0)};Column.prototype.getAlignment=function(e){if(null!=this._align)return this._align;if(e&&null!=e.align)return e.align;if(!this._map)switch(this.dataType){case wijmo_1.DataType.Boolean:return"center";case wijmo_1.DataType.Number:return"right"}if(e&&!e.dataMap)switch(e.dataType){case wijmo_1.DataType.Boolean:return"center";case wijmo_1.DataType.Number:return"right"}return""};Column.prototype._getBindingSort=function(){return this.sortMemberPath?this.sortMemberPath:this.binding?this.binding:null};Column._parseStarSize=function(e){if(wijmo_1.isString(e)){var t=e.length;if(t>0&&"*"==e[t-1]){var i=1==t?1:parseFloat(e);if(i>0&&!isNaN(i))return i}}return null};Column._ctr=0;return Column}(RowCol);exports.Column=Column;var Row=function(e){__extends(Row,e);function Row(t){var i=e.call(this)||this;i._f=RowColFlags.ColumnDefault;i._data=t;return i}Object.defineProperty(Row.prototype,"dataItem",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!0,configurable:!0});Object.defineProperty(Row.prototype,"dataIndex",{get:function(){this._list&&this._list._dirty&&this._list._update();return this._idxData},enumerable:!0,configurable:!0});Object.defineProperty(Row.prototype,"height",{get:function(){return this.size},set:function(e){this.size=e},enumerable:!0,configurable:!0});Object.defineProperty(Row.prototype,"renderHeight",{get:function(){return this.renderSize},enumerable:!0,configurable:!0});return Row}(RowCol);exports.Row=Row;var GroupRow=function(e){__extends(GroupRow,e);function GroupRow(t){var i=e.call(this,t)||this;i._level=-1;i.level=t instanceof wijmo_1.CollectionViewGroup?t.level:-1;i.isReadOnly=!0;return i}Object.defineProperty(GroupRow.prototype,"level",{get:function(){return this._level},set:function(e){wijmo_1.asInt(e);if(e!=this._level){this._level=e;this.onPropertyChanged()}},enumerable:!0,configurable:!0});Object.defineProperty(GroupRow.prototype,"hasChildren",{get:function(){if(null!=this.grid&&null!=this._list){this._list._update();var e=this.index<this._list.length-1?this._list[this.index+1]:null,t=wijmo_1.tryCast(e,GroupRow),i=wijmo_1.tryCast(e,_NewRowTemplate);return null!=e&&null==i&&(null==t||t.level>this.level)}return!0},enumerable:!0,configurable:!0});Object.defineProperty(GroupRow.prototype,"isCollapsed",{get:function(){return this._getFlag(RowColFlags.Collapsed)},set:function(e){e!=this.isCollapsed&&null!=this._list&&this._setCollapsed(wijmo_1.asBoolean(e))},enumerable:!0,configurable:!0});GroupRow.prototype.getGroupHeader=function(){var e=this.grid,t=e.groupHeaderFormat||wijmo_1.culture.FlexGrid.groupHeaderFormat,i=this.dataItem;if(i instanceof wijmo_1.CollectionViewGroup&&t&&e.showGroups&&!e.childItemsPath){var o=i.groupDescription.propertyName,n=i.name,r=e.getColumn(o),l=this.isContentHtml;if(r){l=l||r.isContentHtml;r.header&&(o=r.header);var s=r.dataMap;s&&(n=s.getDisplayValue(n));r.dataType==wijmo_1.getType(n)&&(n=wijmo_1.Globalize.format(n,r.format))}else o=wijmo_1.toHeaderCase(o);var a=i.getAggregate(wijmo_1.Aggregate.CntAll,null,e.collectionView);return wijmo_1.format(t,{name:wijmo_1.escapeHtml(o),value:l?n:wijmo_1.escapeHtml(n),level:i.level,count:a})}return""};GroupRow.prototype._setCollapsed=function(e){var t=this,i=this.grid,o=i.rows,n=this.getCellRange(),r=new CellRangeEventArgs(i.cells,new CellRange(this.index,-1));if(i.onGroupCollapsedChanging(r)){i.deferUpdate((function(){o.deferUpdate((function(){t._setFlag(RowColFlags.Collapsed,e,!0);for(var i=n.topRow+1;i<=n.bottomRow&&i>-1&&i<o.length;i++){o[i]._setFlag(RowColFlags.ParentCollapsed,e,!0);var r=o[i];r instanceof GroupRow&&r.isCollapsed&&(i=r.getCellRange().bottomRow)}}))}));i.onGroupCollapsedChanged(r)}};GroupRow.prototype.getCellRange=function(){for(var e=this._list,t=this.index,i=e.length-1,o=t+1;o<=i;o++){var n=e[o];if(n instanceof GroupRow&&n.level<=this.level){i=o-1;break}}return new CellRange(t,0,i,this.grid.columns.length-1)};return GroupRow}(Row);exports.GroupRow=GroupRow;var RowColCollection=function(e){__extends(RowColCollection,e);function RowColCollection(t,i){var o=e.call(this)||this;o._frozen=0;o._lastFrozen=-1;o._firstVisible=-1;o._vlen=0;o._szDef=28;o._szTot=0;o._szCustom=!1;o._dirty=!1;o._g=wijmo_1.asType(t,FlexGrid);o._szDef=wijmo_1.asNumber(i,!1,!0);return o}Object.defineProperty(RowColCollection.prototype,"grid",{get:function(){return this._g},enumerable:!0,configurable:!0});Object.defineProperty(RowColCollection.prototype,"defaultSize",{get:function(){return this._szDef},set:function(e){this._szCustom=!0;if(this._szDef!=e){this._szDef=wijmo_1.asNumber(e,!1,!0);this._dirty=!0;this._g.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(RowColCollection.prototype,"frozen",{get:function(){return this._frozen},set:function(e){if(e!=this._frozen){this._frozen=wijmo_1.asNumber(e,!1,!0);this._dirty=!0;this._g.invalidate()}},enumerable:!0,configurable:!0});RowColCollection.prototype.isFrozen=function(e){return e<this.frozen};Object.defineProperty(RowColCollection.prototype,"minSize",{get:function(){return this._szMin},set:function(e){if(e!=this._szMin){this._szMin=wijmo_1.asNumber(e,!0,!0);this._dirty=!0;this._g.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(RowColCollection.prototype,"maxSize",{get:function(){return this._szMax},set:function(e){if(e!=this._szMax){this._szMax=wijmo_1.asNumber(e,!0,!0);this._dirty=!0;this._g.invalidate()}},enumerable:!0,configurable:!0});RowColCollection.prototype.getTotalSize=function(){this._dirty&&this._update();return this._szTot};Object.defineProperty(RowColCollection.prototype,"visibleLength",{get:function(){this._dirty&&this._update();return this._vlen},enumerable:!0,configurable:!0});RowColCollection.prototype.getItemAt=function(e){this._dirty&&this._update();if(e<=0&&this.length>0&&this[0].renderSize)return 0;for(var t,i,o=this.length,n=0,r=o-1;n<=r;)if((i=this[t=n+r>>>1])._pos>e&&t>0)r=t-1;else{if(!(i._pos+i.renderSize<=e&&t<o-1)){for(;t>0&&!this[t].renderSize;)t--;for(;t<o-1&&!this[t].renderSize;)t++;return t}n=t+1}return r};RowColCollection.prototype.getNextCell=function(e,t,i){var o,n=SelMove;switch(t){case n.Next:for(o=e+1;o<this.length;o++)if(this[o].renderSize>0)return o;break;case n.Prev:for(o=e-1;o>=0;o--)if(this[o].renderSize>0)return o;break;case n.End:for(o=this.length-1;o>=0;o--)if(this[o].renderSize>0)return o;break;case n.Home:for(o=0;o<this.length;o++)if(this[o].renderSize>0)return o;break;case n.NextPage:return(o=this.getItemAt(this[e].pos+this[e].renderSize+i))<0?this.getNextCell(e,SelMove.End,i):o==e&&o<this.length-1&&this[o+1].renderSize?o+1:o;case n.PrevPage:return(o=this.getItemAt(this[e].pos-i))<0?this.getNextCell(e,SelMove.Home,i):o==e&&o>0&&this[o-1].renderSize?o-1:o}return e};RowColCollection.prototype.canMoveElement=function(e,t,i){void 0===i&&(i=!0);if(t==e)return!1;if(e<0||e>=this.length||t>=this.length)return!1;if(i){t<0&&(t=this.length-1);for(var o=Math.min(e,t),n=Math.max(e,t),r=o;r<=n;r++)if(!this[r].allowDragging)return!1}return!(this[t]instanceof _NewRowTemplate)};RowColCollection.prototype.moveElement=function(e,t,i){void 0===i&&(i=!0);if(this.canMoveElement(e,t,i)){var o=this[e];this.removeAt(e);t<0&&(t=this.length);this.insert(t,o);if(i){var n=this.frozen;e<n&&t>=n?this.frozen--:e>=n&&t<n&&this.frozen++}return!0}return!1};RowColCollection.prototype.onCollectionChanged=function(t){void 0===t&&(t=wijmo_1.NotifyCollectionChangedEventArgs.reset);this._dirty=!0;this._g.invalidate();e.prototype.onCollectionChanged.call(this,t)};RowColCollection.prototype.push=function(t){t._setList(this);return e.prototype.push.call(this,t)};RowColCollection.prototype.splice=function(t,i){for(var o=this,n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];for(var l=t;l<t+i&&l<this.length;l++){var s=this[l];s instanceof RowCol&&s._setList(null)}n.forEach((function(e){return e._setList(o)}));return e.prototype.splice.apply(this,[t,i].concat(n))};RowColCollection.prototype.beginUpdate=function(){this._update();e.prototype.beginUpdate.call(this)};RowColCollection.prototype._setDefaultSize=function(e){if(!this._szCustom){this.defaultSize=e;this._szCustom=!1}};RowColCollection.prototype._update=function(){if(this._dirty&&!this.isUpdating){this._dirty=!1;this._lastFrozen=-1;this._firstVisible=-1;for(var e=0,t=0,i=void 0,o=void 0,n=0;n<this.length;n++){(o=this[n])._idx=n;o._idxVis=e;o._pos=t;o._setList(this);if((i=o.renderSize)>0){t+=i;e++;n<this._frozen&&(this._lastFrozen=n)}this._firstVisible<0&&o.visible&&(this._firstVisible=n)}this._vlen=e;this._szTot=t;return!0}return!1};return RowColCollection}(wijmo_1.ObservableArray);exports.RowColCollection=RowColCollection;var ColumnCollection=function(e){__extends(ColumnCollection,e);function ColumnCollection(){return null!==e&&e.apply(this,arguments)||this}ColumnCollection.prototype.getColumn=function(e){var t=wijmo_1.isNumber(e)?e:this.indexOf(e);return t>-1?this[t]:null};ColumnCollection.prototype.indexOf=function(t){if(t instanceof Column)return e.prototype.indexOf.call(this,t);for(var i=0;i<this.length;i++)if(this[i].name==t)return i;for(i=0;i<this.length;i++)if(this[i].binding==t)return i;return-1};Object.defineProperty(ColumnCollection.prototype,"describedById",{get:function(){return this._descById},set:function(e){if(e!=this._descById){this._descById=wijmo_1.asString(e);this._g&&this._g.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(ColumnCollection.prototype,"firstVisibleIndex",{get:function(){this._dirty&&this._update();return this._firstVisible},enumerable:!0,configurable:!0});ColumnCollection.prototype._updateStarSizes=function(e){for(var t,i=!1,o=0,n=0;n<this.length;n++){if((l=this[n]).isVisible)if(l._szStar){o+=Column._parseStarSize(l._szStar);t=l}else e-=l.renderWidth}if(t){var r=e;for(n=0;n<this.length;n++){var l;if((l=this[n]).isVisible&&l._szStar){var s=l._sz;l==t&&r>0?s=r:r-=s=Math.max(0,Math.round(Column._parseStarSize(l._szStar)/o*e));if(s!=l._sz){l._sz=s;i=!0}}}if(i){this._dirty=!0;this._update()}return i}return!1};return ColumnCollection}(RowColCollection);exports.ColumnCollection=ColumnCollection;var RowCollection=function(e){__extends(RowCollection,e);function RowCollection(){var t=null!==e&&e.apply(this,arguments)||this;t._maxLevel=-1;return t}Object.defineProperty(RowCollection.prototype,"ariaLabel",{get:function(){return this._ariaLabel},set:function(e){if(e!=this.ariaLabel){this._ariaLabel=wijmo_1.asString(e);this._g&&this._g.refresh()}},enumerable:!0,configurable:!0});Object.defineProperty(RowCollection.prototype,"maxGroupLevel",{get:function(){this._dirty&&this._update();return this._maxLevel},enumerable:!0,configurable:!0});RowCollection.prototype._update=function(){var t=this;if(e.prototype._update.call(this)){var i=this.grid?this.grid.collectionView:null,o=i?i.items:null,n=0;this._maxLevel=-1;this.forEach((function(e){e instanceof GroupRow&&e.level>t._maxLevel&&(t._maxLevel=e.level);e._idxData=-1;var i=e.dataItem;i&&o&&(e._idxData=i===o[n]?n:i===o[n+1]?++n:-1)}));return!0}return!1};return RowCollection}(RowColCollection);exports.RowCollection=RowCollection;var _AddNewHandler=function(){function _AddNewHandler(e){this._nrt=new _NewRowTemplate;this._g=e;this._keydownBnd=this._keydown.bind(this);this._attach()}Object.defineProperty(_AddNewHandler.prototype,"newRowAtTop",{get:function(){return this._top},set:function(e){if(e!=this.newRowAtTop){this._top=wijmo_1.asBoolean(e);this.updateNewRowTemplate();var t=this._g;if(this._top&&t.selectionMode==SelectionMode.ListBox){t.rows.forEach((function(e,t){e._setFlag(RowColFlags.Selected,0==t,!0)}));t.select(0,t.selection.col)}}},enumerable:!0,configurable:!0});_AddNewHandler.prototype.updateNewRowTemplate=function(){var e=this._g,t=e.editableCollectionView,i=e.rows,o=this._nrt,n=t&&t.canAddNew&&e.allowAddNew&&!e.isReadOnly,r=i.indexOf(o),l=this._top?0:i.length-1,s=!1;if(!n&&r>-1){var a=e.selection;a.row==r&&e.select(a.row-1,a.col);i.removeAt(r)}else if(n){if(r<0)s=!0;else if(r!=l){i.removeAt(r);s=!0}s&&(this._top?i.insert(0,o):i.push(o));if(o){o._ubv=null;o._setFlag(RowColFlags.ParentCollapsed,!1);this._top&&e.selectionMode==SelectionMode.ListBox||o._setFlag(RowColFlags.Selected,!1)}}};_AddNewHandler.prototype._attach=function(){var e=this._g;if(e){e.beginningEdit.addHandler(this._beginningEdit,this);e.pastingCell.addHandler(this._beginningEdit,this);e.rowEditEnded.addHandler(this._rowEditEnded,this);e.loadedRows.addHandler(this.updateNewRowTemplate,this);e.hostElement.addEventListener("keydown",this._keydownBnd,!0)}};_AddNewHandler.prototype._detach=function(){var e=this._g;if(e){e.beginningEdit.removeHandler(this._beginningEdit);e.pastingCell.removeHandler(this._beginningEdit);e.rowEditEnded.removeHandler(this._rowEditEnded);e.loadedRows.removeHandler(this.updateNewRowTemplate);e.hostElement.removeEventListener("keydown",this._keydownBnd,!0)}};_AddNewHandler.prototype._keydown=function(e){if(!e.defaultPrevented&&e.keyCode==wijmo_1.Key.Escape&&null==this._g.activeEditor&&this._top&&this._nrt.dataItem){this._nrt.dataItem=null;this._g.invalidate()}};_AddNewHandler.prototype._beginningEdit=function(e,t){if(!t.cancel){var i=e.rows[t.row];if(i instanceof _NewRowTemplate){var o=e.editableCollectionView;if(o&&o.canAddNew)if(this._top){if(null==this._nrt.dataItem){var n=null,r=o.sourceCollection,l=o.newItemCreator;n=wijmo_1.isFunction(l)?l():r&&r.length?new r[0].constructor:{};this._nrt.dataItem=n}}else{n=o.currentAddItem&&o.currentAddItem==i.dataItem?o.currentAddItem:o.addNew();o.moveCurrentTo(n);var s=this._nrt.isSelected;this.updateNewRowTemplate();s&&t.row>-1&&(e.rows[t.row].isSelected=!0);e.refresh(!0);e.onRowAdded(t)||o.cancelNew()}}}};_AddNewHandler.prototype._rowEditEnded=function(e,t){var i=this,o=e.editableCollectionView,n=this._nrt.dataItem;if(o&&!this._committing)if(o.isAddingNew)o.commitNew();else if(n&&!t.cancel){this._committing=!0;this._nrt.dataItem=null;var r=o.addNew();for(var l in n)r[l]=n[l];e.onRowAdded(t)?o.commitNew():o.cancelNew();setTimeout((function(){e.select(0,e.columns.firstVisibleIndex);i.updateNewRowTemplate()}),20);this._committing=!1}};return _AddNewHandler}();exports._AddNewHandler=_AddNewHandler;var AllowSorting,AllowPinning,HeadersVisibility,ClipStringOptions,_NewRowTemplate=function(e){__extends(_NewRowTemplate,e);function _NewRowTemplate(){return null!==e&&e.apply(this,arguments)||this}return _NewRowTemplate}(Row);exports._NewRowTemplate=_NewRowTemplate;wijmo_1._addCultureInfo("FlexGrid",{groupHeaderFormat:"{name}: <b>{value}</b> ({count:n0} items)",ariaLabels:{toggleDropDown:"Toggle Dropdown",toggleGroup:"Toggle Group"}});!function(e){e[e.None=0]="None";e[e.SingleColumn=1]="SingleColumn";e[e.MultiColumn=2]="MultiColumn"}(AllowSorting=exports.AllowSorting||(exports.AllowSorting={}));!function(e){e[e.None=0]="None";e[e.SingleColumn=1]="SingleColumn";e[e.ColumnRange=2]="ColumnRange";e[e.Both=3]="Both"}(AllowPinning=exports.AllowPinning||(exports.AllowPinning={}));!function(e){e[e.None=0]="None";e[e.Column=1]="Column";e[e.Row=2]="Row";e[e.All=3]="All"}(HeadersVisibility=exports.HeadersVisibility||(exports.HeadersVisibility={}));!function(e){e[e.Default=0]="Default";e[e.CSV=1]="CSV";e[e.QuoteAll=2]="QuoteAll";e[e.SkipMerged=4]="SkipMerged";e[e.Unformatted=8]="Unformatted";e[e.InvisibleRows=16]="InvisibleRows";e[e.InvisibleColumns=32]="InvisibleColumns";e[e.InvisibleCells=48]="InvisibleCells"}(ClipStringOptions=exports.ClipStringOptions||(exports.ClipStringOptions={}));var FlexGrid=function(e){__extends(FlexGrid,e);function FlexGrid(t,i){var o=e.call(this,t,null,!0)||this;o._szClient=new wijmo_1.Size(0,0);o._offsetY=0;o._cssPage=0;o._ptScrl=new wijmo_1.Point(0,0);o._cellPadLeft=3;o._cellPadHorz=3;o._cellPadVert=0;o._clipToScreen=!1;o._autoGenCols=!0;o._autoClipboard=!0;o._xOnCopyPaste=!0;o._autoScroll=!0;o._autoSearch=!1;o._caseSensitive=!1;o._readOnly=!1;o._indent=14;o._autoSizeMode=AutoSizeMode.Both;o._autoHeights=!1;o._hdrVis=HeadersVisibility.All;o._alSorting=AllowSorting.SingleColumn;o._alPinning=AllowPinning.None;o._alAddNew=!1;o._alDelete=!1;o._alResizing=AllowResizing.Columns;o._alDragging=AllowDragging.Columns;o._alMerging=AllowMerging.None;o._ssHdr=HeadersVisibility.None;o._shSort=!0;o._shGroups=!0;o._shMarquee=!1;o._altStep=1;o._shErr=!0;o._shDropDown=!0;o._valEdt=!0;o._deferResizing=!1;o._pSel=!0;o._pOutline=!0;o._stickyHdr=!1;o._anchorCursor=!1;o._copyHeaders=HeadersVisibility.None;o._bigChecks=!1;o._vt=0;o._vtRows=0;o._vtCols=0;o._lazyRender=!0;o._refreshOnEdit=!0;o._reorderCells=!0;o.itemsSourceChanging=new wijmo_1.Event;o.itemsSourceChanged=new wijmo_1.Event;o.scrollPositionChanged=new wijmo_1.Event;o.selectionChanging=new wijmo_1.Event;o.selectionChanged=new wijmo_1.Event;o.loadingRows=new wijmo_1.Event;o.loadedRows=new wijmo_1.Event;o.updatingLayout=new wijmo_1.Event;o.updatedLayout=new wijmo_1.Event;o.resizingColumn=new wijmo_1.Event;o.resizedColumn=new wijmo_1.Event;o.autoSizingColumn=new wijmo_1.Event;o.autoSizedColumn=new wijmo_1.Event;o.starSizedColumns=new wijmo_1.Event;o.draggingColumn=new wijmo_1.Event;o.draggingColumnOver=new wijmo_1.Event;o.draggedColumn=new wijmo_1.Event;o.pinningColumn=new wijmo_1.Event;o.pinnedColumn=new wijmo_1.Event;o.resizingRow=new wijmo_1.Event;o.resizedRow=new wijmo_1.Event;o.autoSizingRow=new wijmo_1.Event;o.autoSizedRow=new wijmo_1.Event;o.draggingRow=new wijmo_1.Event;o.draggingRowOver=new wijmo_1.Event;o.draggedRow=new wijmo_1.Event;o.groupCollapsedChanging=new wijmo_1.Event;o.groupCollapsedChanged=new wijmo_1.Event;o.columnGroupCollapsedChanging=new wijmo_1.Event;o.columnGroupCollapsedChanged=new wijmo_1.Event;o.sortingColumn=new wijmo_1.Event;o.sortedColumn=new wijmo_1.Event;o.beginningEdit=new wijmo_1.Event;o.prepareCellForEdit=new wijmo_1.Event;o.cellEditEnding=new wijmo_1.Event;o.cellEditEnded=new wijmo_1.Event;o.rowEditStarting=new wijmo_1.Event;o.rowEditStarted=new wijmo_1.Event;o.rowEditEnding=new wijmo_1.Event;o.rowEditEnded=new wijmo_1.Event;o.rowAdded=new wijmo_1.Event;o.deletingRow=new wijmo_1.Event;o.deletedRow=new wijmo_1.Event;o.copying=new wijmo_1.Event;o.copied=new wijmo_1.Event;o.pasting=new wijmo_1.Event;o.pasted=new wijmo_1.Event;o.pastingCell=new wijmo_1.Event;o.pastedCell=new wijmo_1.Event;o.formatItem=new wijmo_1.Event((function(){o._clearCells()}));o.updatingView=new wijmo_1.Event;o.updatedView=new wijmo_1.Event;o._mappedColumns=null;var n=o.hostElement;wijmo_1.isIE()&&(n.style.borderRadius="0");var r=o.getTemplate();o.applyTemplate("wj-control wj-content wj-flexgrid",r,{_root:"root",_eSz:"sz",_eCt:"cells",_fCt:"fcells",_eTL:"tl",_eBL:"bl",_eCHdr:"ch",_eRHdr:"rh",_eCFtr:"cf",_eTLCt:"tlcells",_eBLCt:"blcells",_eCHdrCt:"chcells",_eCFtrCt:"cfcells",_eRHdrCt:"rhcells",_eMarquee:"marquee",_eFocus:"focus"});wijmo_1.setCss(o._root.parentElement,{position:"relative",left:"0",top:"0",width:"100%",height:"100%",overflow:"hidden",maxWidth:"inherit",maxHeight:"inherit"});wijmo_1.setCss(o._root,{position:"absolute",left:"0",top:"0",width:"100%",height:"100%",overflow:"auto",maxWidth:"inherit",maxHeight:"inherit",webkitOverflowScrolling:"touch"});wijmo_1.setCss(o._eCt,{position:"absolute"});wijmo_1.setCss(o._eMarquee,{display:"none"});wijmo_1.setCss(o._eMarquee.firstChild,{width:"100%",height:"100%"});wijmo_1.setCss(o._fCt,{position:"absolute",left:"0",top:"0",overflow:"hidden",pointerEvents:"none"});wijmo_1.setCss(o._eFocus,{position:"fixed",left:"-32000px"});wijmo_1.setCss(o._eSz,{position:"relative",visibility:"hidden"});[o._eRHdr,o._eCFtr,o._eCHdr,o._eBL,o._eTL].forEach((function(e){wijmo_1.setAttribute(e,"aria-hidden",!0);wijmo_1.setCss(e,{position:"absolute",overflow:"hidden",outline:"none"});wijmo_1.setCss(e.firstElementChild,{position:"relative"})}));[o._eFocus,o._eMarquee,o._fCt,o._eSz].forEach((function(e){wijmo_1.setAttribute(e,"aria-hidden",!0)}));n.tabIndex=-1;o.deferUpdate((function(){var e=o._getDefaultRowHeight();o._rows=new RowCollection(o,e);o._cols=new ColumnCollection(o,4*e);o._hdrRows=new RowCollection(o,e);o._hdrCols=new ColumnCollection(o,Math.round(1.25*e));o._ftrRows=new RowCollection(o,e);var t=CellType;o._gpTL=new GridPanel(o,t.TopLeft,o._hdrRows,o._hdrCols,o._eTLCt);o._gpCHdr=new GridPanel(o,t.ColumnHeader,o._hdrRows,o._cols,o._eCHdrCt);o._gpRHdr=new GridPanel(o,t.RowHeader,o._rows,o._hdrCols,o._eRHdrCt);o._gpCells=new GridPanel(o,t.Cell,o._rows,o._cols,o._eCt);o._gpBL=new GridPanel(o,t.BottomLeft,o._ftrRows,o._hdrCols,o._eBLCt);o._gpCFtr=new GridPanel(o,t.ColumnFooter,o._ftrRows,o._cols,o._eCFtrCt);o._hdrRows.push(new Row);o._hdrCols.push(new Column({align:"center"}));o._cf=new CellFactory;o._keyHdl=new _KeyboardHandler(o);o._mouseHdl=new _MouseHandler(o);o._edtHdl=new _EditHandler(o);o._selHdl=new _SelectionHandler(o);o._addHdl=new _AddNewHandler(o);o._grpHdl=new _ColumnGroupHandler(o);o._mrgMgr=new MergeManager(o);o._bndSortConverter=o._sortConverter.bind(o);o._errorTip=new wijmo_1.Tooltip({isContentHtml:!1,showDelay:0,cssClass:"wj-error-tip"});wijmo_1.setAttribute(o.cells.hostElement,"role","grid");o.selectionMode=SelectionMode.CellRange;o._root.tabIndex=-1;o.initialize(i)}));o.addEventListener(o._root,"scroll",(function(e){if(o._updateScrollPosition()){o.finishEditing();o._updateContent(!0);o.frozenColumns&&setTimeout((function(){var e=o.columnHeaders.hostElement.style,t=parseInt(e.left),i=o._ptScrl.x;Math.abs(t-i)>1&&o.invalidate()}))}}));o.addEventListener(n,"focus",(function(e){if(n.tabIndex>-1){var t=e.target;if(t instanceof HTMLElement&&t.tabIndex<0){o._setFocus(!0);return}}}),!0);return o}FlexGrid.prototype._handleResize=function(){this._rcBounds=null;e.prototype._handleResize.call(this)};Object.defineProperty(FlexGrid.prototype,"headersVisibility",{get:function(){return this._hdrVis},set:function(e){if((e=wijmo_1.asEnum(e,HeadersVisibility))!=this._hdrVis){this._hdrVis=e;this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"stickyHeaders",{get:function(){return this._stickyHdr},set:function(e){if(e!=this._stickyHdr){this._stickyHdr=wijmo_1.asBoolean(e);this._updateStickyHeaders();this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"preserveSelectedState",{get:function(){return this._pSel},set:function(e){this._pSel=wijmo_1.asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"preserveOutlineState",{get:function(){return this._pOutline},set:function(e){this._pOutline=wijmo_1.asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"anchorCursor",{get:function(){return this._anchorCursor},set:function(e){this._anchorCursor=wijmo_1.asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"copyHeaders",{get:function(){return this._copyHeaders},set:function(e){this._copyHeaders=wijmo_1.asEnum(e,HeadersVisibility)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"lazyRender",{get:function(){return this._lazyRender},set:function(e){this._lazyRender=wijmo_1.asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"refreshOnEdit",{get:function(){return this._refreshOnEdit},set:function(e){this._refreshOnEdit=wijmo_1.asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"virtualizationThreshold",{get:function(){return this._vt},set:function(e){this._vt=e;if(wijmo_1.isNumber(e))this._vtRows=this._vtCols=wijmo_1.asNumber(e);else if(e)if(wijmo_1.isArray(e)&&2==e.length){this._vtRows=wijmo_1.asNumber(e[0]);this._vtCols=wijmo_1.asNumber(e[1])}else wijmo_1.assert(!1,"virtualizationThreshold should be a number or an array with two numbers.");else this._vtRows=this._vtCols=0},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"autoGenerateColumns",{get:function(){return this._autoGenCols},set:function(e){this._autoGenCols=wijmo_1.asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"autoClipboard",{get:function(){return this._autoClipboard},set:function(e){this._autoClipboard=wijmo_1.asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"expandSelectionOnCopyPaste",{get:function(){return this._xOnCopyPaste},set:function(e){this._xOnCopyPaste=wijmo_1.asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"autoScroll",{get:function(){return this._autoScroll},set:function(e){this._autoScroll=wijmo_1.asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"autoSearch",{get:function(){return this._autoSearch},set:function(e){this._autoSearch=wijmo_1.asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"caseSensitiveSearch",{get:function(){return this._caseSensitive},set:function(e){this._caseSensitive=wijmo_1.asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"columnLayout",{get:function(){var e=FlexGrid._getSerializableProperties(Column),t=new Column,i=[];this.columns.forEach((function(o){var n={};e.forEach((function(e){var i=o[e];i!=t[e]&&wijmo_1.isPrimitive(i)&&"size"!=e&&(n[e]=i)}));i.push(n)}));return JSON.stringify({columns:i})},set:function(e){var t=JSON.parse(wijmo_1.asString(e));if(!t||null==t.columns)throw"Invalid columnLayout data.";this.columns.clear();this.initialize(t)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"columnGroups",{get:function(){return this._grpHdl.getGroupDefinitions()},set:function(e){this.columns.clear();this._grpHdl.createColumnGroups(wijmo_1.asArray(e))},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"isReadOnly",{get:function(){return this._readOnly},set:function(e){if(e!=this._readOnly){this._readOnly=wijmo_1.asBoolean(e);this.finishEditing();this.invalidate(!0);this._addHdl.updateNewRowTemplate();wijmo_1.toggleClass(this.hostElement,"wj-state-readonly",this.isReadOnly);this._setAria("readonly",this.isReadOnly?"true":null)}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"bigCheckboxes",{get:function(){return this._bigChecks},set:function(e){this._bigChecks=wijmo_1.asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"isDisabled",{get:function(){return this._e&&null!=this._e.getAttribute("disabled")},set:function(e){if((e=wijmo_1.asBoolean(e,!0))!=this.isDisabled){var t=this._e;if(t){wijmo_1.enable(t,!e);this.invalidate()}}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"imeEnabled",{get:function(){return null!=this._imeHdl},set:function(e){if(wijmo_1.asBoolean(e)!=this.imeEnabled&&this.finishEditing()){var t=this.containsFocus();if(this._imeHdl){this._imeHdl.dispose();this._imeHdl=null}e&&(this._imeHdl=new _ImeHandler(this));t&&this.focus()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"allowResizing",{get:function(){return this._alResizing},set:function(e){this._alResizing=wijmo_1.asEnum(e,AllowResizing)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"deferResizing",{get:function(){return this._deferResizing},set:function(e){this._deferResizing=wijmo_1.asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"autoSizeMode",{get:function(){return this._autoSizeMode},set:function(e){this._autoSizeMode=wijmo_1.asEnum(e,AutoSizeMode)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"autoRowHeights",{get:function(){return this._autoHeights},set:function(e){this._autoHeights=wijmo_1.asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"quickAutoSize",{get:function(){return this._quickSize},set:function(e){this._quickSize=wijmo_1.asBoolean(e,!0)},enumerable:!0,configurable:!0});FlexGrid.prototype._getQuickAutoSize=function(){return wijmo_1.isBoolean(this._quickSize)?this._quickSize:!this.formatItem.hasHandlers&&null==this.itemFormatter};Object.defineProperty(FlexGrid.prototype,"allowSorting",{get:function(){return this._alSorting},set:function(e){wijmo_1.isBoolean(e)&&(e=e?AllowSorting.SingleColumn:AllowSorting.None);this._alSorting=wijmo_1.asEnum(e,AllowSorting)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"allowPinning",{get:function(){return this._alPinning},set:function(e){if(e!=this._alPinning){wijmo_1.isBoolean(e)&&(e=e?AllowPinning.SingleColumn:AllowPinning.None);this._alPinning=wijmo_1.asEnum(e,AllowPinning);this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"allowAddNew",{get:function(){return this._alAddNew},set:function(e){if(e!=this._alAddNew){this._alAddNew=wijmo_1.asBoolean(e);this._addHdl.updateNewRowTemplate()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"newRowAtTop",{get:function(){return this._addHdl.newRowAtTop},set:function(e){this._addHdl.newRowAtTop=wijmo_1.asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"allowDelete",{get:function(){return this._alDelete},set:function(e){e!=this._alDelete&&(this._alDelete=wijmo_1.asBoolean(e))},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"allowMerging",{get:function(){return this._alMerging},set:function(e){if((e=wijmo_1.asEnum(e,AllowMerging))!=this._alMerging){this._alMerging=e;this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"showSelectedHeaders",{get:function(){return this._ssHdr},set:function(e){if((e=wijmo_1.asEnum(e,HeadersVisibility))!=this._ssHdr){this._ssHdr=e;this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"showMarquee",{get:function(){return this._shMarquee},set:function(e){if(e!=this._shMarquee){this._shMarquee=wijmo_1.asBoolean(e);this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"showSort",{get:function(){return this._shSort},set:function(e){if(e!=this._shSort){this._shSort=wijmo_1.asBoolean(e);this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"showGroups",{get:function(){return this._shGroups},set:function(e){if(e!=this._shGroups){this._shGroups=wijmo_1.asBoolean(e);this._bindGrid(!1)}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"alternatingRowStep",{get:function(){return this._altStep},set:function(e){if(e!=this._altStep){this._altStep=wijmo_1.asInt(e,!1,!0);this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"showAlternatingRows",{get:function(){return this._altStep>0},set:function(e){wijmo_1._deprecated("showAlternatingRows","alternatingRowStep");this.alternatingRowStep=e?1:0},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"showErrors",{get:function(){return this._shErr},set:function(e){if(e!=this._shErr){this._clearCells();this._shErr=wijmo_1.asBoolean(e)}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"errorTip",{get:function(){return this._errorTip},set:function(e){if(e!=this._errorTip){this._clearCells();this._errorTip=wijmo_1.asType(e,wijmo_1.Tooltip,!0)}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"itemValidator",{get:function(){return this._itemValidator},set:function(e){if(e!=this.itemValidator){this._itemValidator=wijmo_1.asFunction(e);this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"validateEdits",{get:function(){return this._valEdt},set:function(e){this._valEdt=wijmo_1.asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"groupHeaderFormat",{get:function(){return this._gHdrFmt},set:function(e){if(e!=this._gHdrFmt){this._gHdrFmt=wijmo_1.asString(e);this._bindGrid(!1)}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"allowDragging",{get:function(){return this._alDragging},set:function(e){if((e=wijmo_1.asEnum(e,AllowDragging))!=this._alDragging){this._alDragging=e;this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"itemsSource",{get:function(){return this._items},set:function(e){if(e!=this._items){var t=new wijmo_1.CancelEventArgs;if(this.onItemsSourceChanging(t)){if(this._cv){(i=wijmo_1.tryCast(this._cv,wijmo_1.CollectionView))&&i.sortConverter==this._bndSortConverter&&(i.sortConverter=null);this._cv.currentChanged.removeHandler(this._cvCurrentChanged,this);this._cv.collectionChanged.removeHandler(this._cvCollectionChanged,this);this._cv=null}this._items=e;this._cv=this._getCollectionView(e);this._lastCount=0;if(this._cv){this._cv.currentChanged.addHandler(this._cvCurrentChanged,this);this._cv.collectionChanged.addHandler(this._cvCollectionChanged,this);var i;(i=wijmo_1.tryCast(this._cv,wijmo_1.CollectionView))&&!i.sortConverter&&(i.sortConverter=this._bndSortConverter)}this._bindGrid(!0);this._selHdl._setSelectionMode(this.selectionMode);this.onItemsSourceChanged(t)}}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"collectionView",{get:function(){return this._cv},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"editableCollectionView",{get:function(){return wijmo_1.tryCast(this._cv,"IEditableCollectionView")},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"childItemsPath",{get:function(){return this._childItemsPath},set:function(e){if(e!=this._childItemsPath){wijmo_1.assert(null==e||wijmo_1.isArray(e)||wijmo_1.isString(e),"childItemsPath should be an array or a string.");this._childItemsPath=e;this._bindGrid(!0)}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"rowHeaderPath",{get:function(){return this._rowHdrPath?this._rowHdrPath.path:null},set:function(e){if(e!=this.rowHeaderPath){e=wijmo_1.asString(e);this._rowHdrPath=e?new wijmo_1.Binding(e):null;this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"cells",{get:function(){return this._gpCells},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"columnHeaders",{get:function(){return this._gpCHdr},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"columnFooters",{get:function(){return this._gpCFtr},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"rowHeaders",{get:function(){return this._gpRHdr},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"topLeftCells",{get:function(){return this._gpTL},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"bottomLeftCells",{get:function(){return this._gpBL},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"rows",{get:function(){return this._rows},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"columns",{get:function(){return this._cols},enumerable:!0,configurable:!0});FlexGrid.prototype.getColumn=function(e){return this.columns.getColumn(e)};Object.defineProperty(FlexGrid.prototype,"frozenRows",{get:function(){return this.rows.frozen},set:function(e){this.rows.frozen=e},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"frozenColumns",{get:function(){return this.columns.frozen},set:function(e){this.columns.frozen=e},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"cloneFrozenCells",{get:function(){return this._fzClone},set:function(e){if(e!=this._fzClone){wijmo_1.setText(this._fCt,null);this._fzClone=wijmo_1.asBoolean(e,!0);this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"sortRowIndex",{get:function(){return this._sortRowIndex},set:function(e){if(e!=this._sortRowIndex){this._sortRowIndex=wijmo_1.asNumber(e,!0);this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"editColumnIndex",{get:function(){return this._editColIndex},set:function(e){if(e!=this._editColIndex){this._editColIndex=wijmo_1.asNumber(e,!0);this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"scrollPosition",{get:function(){return this._ptScrl.clone()},set:function(e){var t=this._root,i=-e.x;if(this.rightToLeft)switch(FlexGrid._getRtlMode()){case"rev":i=t.scrollWidth-t.clientWidth+e.x;break;case"neg":i=e.x;break;default:i=-e.x}t.scrollLeft=i;t.scrollTop=-e.y},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"clientSize",{get:function(){return this._szClient},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"controlRect",{get:function(){this._rcBounds||(this._rcBounds=wijmo_1.getElementRect(this._root));return this._rcBounds},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"scrollSize",{get:function(){return new wijmo_1.Size(this._gpCells.width,this._heightBrowser)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"viewRange",{get:function(){return this._gpCells.viewRange},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"cellFactory",{get:function(){return this._cf},set:function(e){if(e!=this._cf){this._clearCells();this._cf=wijmo_1.asType(e,CellFactory,!1)}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"itemFormatter",{get:function(){return this._itemFormatter},set:function(e){if(e!=this._itemFormatter){this._clearCells();this._itemFormatter=wijmo_1.asFunction(e)}},enumerable:!0,configurable:!0});FlexGrid.prototype.canEditCell=function(e,t){return this._edtHdl._allowEdit(e,t)};FlexGrid.prototype.getCellData=function(e,t,i){return this.cells.getCellData(e,t,i)};FlexGrid.prototype.getCellBoundingRect=function(e,t,i){return this.cells.getCellBoundingRect(e,t,i)};FlexGrid.prototype.setCellData=function(e,t,i,o,n){void 0===o&&(o=!0);void 0===n&&(n=!0);return this.cells.setCellData(e,t,i,o,n)};FlexGrid.prototype.hitTest=function(e,t){wijmo_1.isNumber(e)&&wijmo_1.isNumber(t)&&(e=new wijmo_1.Point(e,t));wijmo_1.isBoolean(t)&&t&&(this._rcBounds=null);return new HitTestInfo(this,e)};FlexGrid.prototype.getClipString=function(e,t,i,o){var n;n=null==t||wijmo_1.isBoolean(t)?t?ClipStringOptions.CSV:ClipStringOptions.Default:t;wijmo_1.assert(wijmo_1.isNumber(n),"Unexpected value for ClipStringOptions parameter.");return this._edtHdl.getClipString(e,n,i,o)};FlexGrid.prototype.setClipString=function(e,t){this._edtHdl.setClipString(e,t)};FlexGrid.prototype.focus=function(){this._setFocus(!1)};FlexGrid.prototype.dispose=function(){this.finishEditing(!0);this.itemsSource=null;e.prototype.dispose.call(this)};FlexGrid.prototype.refresh=function(t){void 0===t&&(t=!0);e.prototype.refresh.call(this,t);this.finishEditing();if(t){this._updateColumnTypes();this.scrollPosition=this._ptScrl;var i=this._getDefaultRowHeight();this._rows._setDefaultSize(i);this._cols._setDefaultSize(4*i);this._hdrRows._setDefaultSize(i);this._hdrCols._setDefaultSize(Math.round(1.25*i));this._ftrRows._setDefaultSize(i);clearTimeout(this._toInv);this._toInv=null}this.refreshCells(t);var o=this._e;o&&(this._szCtl=new wijmo_1.Size(o.offsetWidth,o.offsetHeight))};FlexGrid.prototype.refreshCells=function(e,t,i){this.isUpdating||(e?this._updateLayout():this._updateContent(t,i))};FlexGrid.prototype.refreshRange=function(e){for(var t=e.topRow;t<=e.bottomRow;t++)for(var i=e.leftCol;i<=e.rightCol;i++){var o=this.cells.getCellElement(t,i);if(o){var n=o[GridPanel._INDEX_KEY];this.cellFactory.updateCell(this.cells,t,i,o,n.rng)}}};FlexGrid.prototype.autoSizeColumn=function(e,t,i){void 0===t&&(t=!1);void 0===i&&(i=4);this.autoSizeColumns(e,e,t,i)};FlexGrid.prototype.autoSizeColumns=function(e,t,i,o){var n=this;void 0===i&&(i=!1);void 0===o&&(o=4);var r=0,l=i?this.topLeftCells:this.columnHeaders,s=i?this.bottomLeftCells:this.columnFooters,a=i?this.rowHeaders:this.cells,c=this.viewRange;e=null==e?0:wijmo_1.asInt(e);t=null==t?a.columns.length-1:wijmo_1.asInt(t);c.row=Math.max(0,c.row-1e3);c.row2=Math.min(c.row2+1e3,this.rows.length-1);this.finishEditing()&&this.columns.deferUpdate((function(){wijmo_1.setCss(n._eCt,{width:n._gpCells.width});for(var i=wijmo_1.createElement("<div "+FlexGrid._WJS_MEASURE+'="true"/>',a.hostElement,{visibility:"hidden"}),d=n._getCanvasContext(),u=e;u<=t&&u>-1&&u<a.columns.length;u++){var h=a.columns[u];if(h.isVisible){r=0;if(n.autoSizeMode&AutoSizeMode.Headers){for(var _=0;_<l.rows.length;_++)l.rows[_].isVisible&&(r=Math.max(n._getDesiredWidth(l,_,u,i),r));for(_=0;_<s.rows.length;_++)s.rows[_].isVisible&&(r=Math.max(n._getDesiredWidth(s,_,u,i),r))}if(n.autoSizeMode&AutoSizeMode.Cells&&c.isValid)if(h._getQuickAutoSize()){_=n._getWidestRow(a,c,u,d);r=Math.max(n._getDesiredWidth(a,_,u,i),r)}else for(_=c.row;_<=c.row2&&_<a.rows.length;_++)a.rows[_].isVisible&&(r=Math.max(n._getDesiredWidth(a,_,u,i),r));r>0&&(h.width=r+o+2)}}n.cellFactory.disposeCell(i);wijmo_1.removeChild(i)}))};FlexGrid.prototype.autoSizeRow=function(e,t,i){void 0===t&&(t=!1);void 0===i&&(i=0);this.autoSizeRows(e,e,t,i)};FlexGrid.prototype.autoSizeRows=function(e,t,i,o){var n=this;void 0===i&&(i=!1);void 0===o&&(o=0);var r=0,l=i?this.topLeftCells:this.rowHeaders,s=i?this.columnHeaders:this.cells;i=wijmo_1.asBoolean(i);o=wijmo_1.asNumber(o);e=null==e?0:wijmo_1.asInt(e);t=null==t?s.rows.length-1:wijmo_1.asInt(t);if(this.finishEditing()){wijmo_1.setCss(this._eCt,{width:this._gpCells.width});var a=wijmo_1.createElement("<div "+FlexGrid._WJS_MEASURE+'="true"/>',s.hostElement,{visibility:"hidden"});this.rows.deferUpdate((function(){for(var i={},c=e;c<=t&&c>-1&&c<s.rows.length;c++){if(s.rows[c].isVisible){r=0;n.autoSizeMode&AutoSizeMode.Headers&&(r=n._getDesiredRowHeight(l,c,a,i));n.autoSizeMode&AutoSizeMode.Cells&&(r=Math.max(n._getDesiredRowHeight(s,c,a,i),r));r>0&&(s.rows[c].height=r+o)}}}));this.cellFactory.disposeCell(a);wijmo_1.removeChild(a)}};Object.defineProperty(FlexGrid.prototype,"treeIndent",{get:function(){return this._indent},set:function(e){if(e!=this._indent){this._indent=wijmo_1.asNumber(e,!1,!0);this.columns.onCollectionChanged()}},enumerable:!0,configurable:!0});FlexGrid.prototype.collapseGroupsToLevel=function(e){var t=this;this.finishEditing()&&this.deferUpdate((function(){var i=t.rows;i.deferUpdate((function(){for(var t=0;t<i.length;t++){var o=i[t];o instanceof GroupRow&&(o.isCollapsed=o.level>=e)}}))}))};Object.defineProperty(FlexGrid.prototype,"selectionMode",{get:function(){return this._selHdl.selectionMode},set:function(e){(e=wijmo_1.asEnum(e,SelectionMode))!=this.selectionMode&&(this._selHdl.selectionMode=e)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"selection",{get:function(){return this._selHdl.selection.clone()},set:function(e){this._selHdl.selection=e},enumerable:!0,configurable:!0});FlexGrid.prototype.select=function(e,t){void 0===t&&(t=!0);return this._selHdl.select(e,t)};FlexGrid.prototype.selectAll=function(){var e=this.rows.length,t=this.columns.length;return!(!e||!t)&&this.select(new CellRange(0,0,e-1,t-1),!1)};FlexGrid.prototype.getSelectedState=function(e,t){return this.cells.getSelectedState(e,t,null)};Object.defineProperty(FlexGrid.prototype,"selectedRows",{get:function(){for(var e=[],t=0;t<this.rows.length;t++)this.rows[t].isSelected&&e.push(this.rows[t]);var i=this.selectionMode;if(0==e.length&&i!=SelectionMode.None){var o=this.selection;if(o.isValid)for(t=o.topRow;t>-1&&t<=o.bottomRow;t++)e.push(this.rows[t])}return e},set:function(e){var t=this;wijmo_1.assert(this.selectionMode==SelectionMode.ListBox,"This property can be set only in ListBox mode.");e=wijmo_1.asArray(e);this.deferUpdate((function(){for(var i=0,o=!0;i<t.rows.length;i++){var n=t.rows[i],r=e&&e.indexOf(n)>-1;if(r&&o){o=!1;t.select(i,t.selection.col)}n.isSelected=r}}))},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"selectedItems",{get:function(){var e=[];this.selectedRows.forEach((function(t){t&&t.dataItem&&e.push(t.dataItem)}));return e},set:function(e){var t=this;wijmo_1.assert(this.selectionMode==SelectionMode.ListBox,"This property can be set only in ListBox mode.");e=wijmo_1.asArray(e);this.deferUpdate((function(){for(var i=0,o=!0;i<t.rows.length;i++){var n=t.rows[i],r=e&&e.indexOf(n.dataItem)>-1;if(r&&o){o=!1;t.select(i,t.selection.col)}n.isSelected=r}}))},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"selectedRanges",{get:function(){var e=[this.selection];this._selHdl.extendedSelection.forEach((function(t){e.push(t)}));return e},set:function(e){if((e=wijmo_1.asArray(e))&&e.length>0){this.select(e[0]);if(this.selectionMode==SelectionMode.MultiRange){var t=this._selHdl.extendedSelection;t.deferUpdate((function(){t.clear();for(var i=1;i<e.length;i++)t.push(e[i])}))}}},enumerable:!0,configurable:!0});FlexGrid.prototype.scrollIntoView=function(e,t,i){(null==this._maxOffsetY||this._rows._dirty||this._cols._dirty)&&this._updateLayout();var o=this.scrollPosition,n=this._szClient,r=n.width,l=n.height-this._gpCFtr.rows.getTotalSize(),s=this.cells._getFrozenPos();if((e=wijmo_1.asInt(e))>-1&&e<this._rows.length&&e>=this._rows.frozen){var a=this._rows[e],c=this._getCssPage(a.pos);if(c!=this._cssPage){for(var d=this._maxOffsetY,u=Math.round(d*c);u>a.pos;c-=.1)u=Math.round(d*c);this._offsetY=u}var h=a.pos-this._offsetY,_=h+a.renderSize;_>l-o.y&&(o.y=Math.max(-h,l-_));h-s.y<-o.y&&(o.y=-(h-s.y));c!=this._cssPage&&(this._cssPage=this._getCssPage(-o.y))}if((t=wijmo_1.asInt(t))>-1&&t<this._cols.length&&t>=this._cols.frozen){var g=this._cols[t],p=g.pos+g.renderSize;p>-o.x+r&&(o.x=Math.max(-g.pos,r-p));g.pos-s.x<-o.x&&(o.x=-(g.pos-s.x))}if(!o.equals(this._ptScrl)){this.scrollPosition=o;if(i){this._updateScrollPosition();this.refresh()}return!0}if(this._focus&&this._activeCell&&e>-1&&t>-1){var f=this._root;if(f.scrollWidth==f.clientWidth||f.scrollHeight==f.clientHeight){var w=this._activeCell.getBoundingClientRect(),m=innerWidth,C=innerHeight;if(w.top<0||w.left<0||w.bottom>C||w.right>m)if(wijmo_1.isIE()){o.x=pageXOffset+(w.left<0?w.left:w.right>m?w.right-m:0);o.y=pageYOffset+(w.top<0?w.top:w.bottom>C?w.bottom-C:0);scrollTo(o.x,o.y)}else this._activeCell.scrollIntoView({behavior:"auto",block:"nearest",inline:"nearest"})}}return!1};FlexGrid.prototype.isRangeValid=function(e){return e&&e.isValid&&e.bottomRow<this.rows.length&&e.rightCol<this.columns.length};FlexGrid.prototype.startEditing=function(e,t,i,o,n){void 0===e&&(e=!0);return this._edtHdl.startEditing(e,t,i,o,n)};FlexGrid.prototype.finishEditing=function(e){return this._edtHdl.finishEditing(e)};Object.defineProperty(FlexGrid.prototype,"activeEditor",{get:function(){return this._edtHdl.activeEditor},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"editRange",{get:function(){return this._edtHdl.editRange},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"mergeManager",{get:function(){return this._mrgMgr},set:function(e){if(e!=this._mrgMgr){this._mrgMgr=wijmo_1.asType(e,MergeManager,!0);this.invalidate()}},enumerable:!0,configurable:!0});FlexGrid.prototype.getMergedRange=function(e,t,i,o){void 0===o&&(o=!0);return this._mrgMgr?this._mrgMgr.getMergedRange(e,t,i,o):null};Object.defineProperty(FlexGrid.prototype,"keyActionTab",{get:function(){return this._keyHdl._kaTab},set:function(e){this._keyHdl._kaTab=wijmo_1.asEnum(e,KeyAction)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"keyActionEnter",{get:function(){return this._keyHdl._kaEnter},set:function(e){this._keyHdl._kaEnter=wijmo_1.asEnum(e,KeyAction)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"preserveWhiteSpace",{get:function(){return wijmo_1.hasClass(this.hostElement,FlexGrid._WJS_WSPRE)},set:function(e){wijmo_1.toggleClass(this.hostElement,FlexGrid._WJS_WSPRE,wijmo_1.asBoolean(e))},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"showDropDown",{get:function(){return this._shDropDown},set:function(e){if(e!=this._shDropDown){this._shDropDown=wijmo_1.asBoolean(e,!0);this.invalidate()}},enumerable:!0,configurable:!0});FlexGrid.prototype.toggleDropDownList=function(){if(!this._tglDropDown){this._tglDropDown=!0;this._edtHdl._toggleListBox(null);this._tglDropDown=!1}return null!=this._edtHdl._lbx};Object.defineProperty(FlexGrid,"defaultTypeWidth",{get:function(){return FlexGrid._defTypeWidth},enumerable:!0,configurable:!0});FlexGrid.prototype.onItemsSourceChanging=function(e){this.itemsSourceChanging.raise(this,e);return!e.cancel};FlexGrid.prototype.onItemsSourceChanged=function(e){this.itemsSourceChanged.raise(this,e)};FlexGrid.prototype.onScrollPositionChanged=function(e){this.scrollPositionChanged.raise(this,e)};FlexGrid.prototype.onSelectionChanging=function(e){this.selectionChanging.raise(this,e);return!e.cancel};FlexGrid.prototype.onSelectionChanged=function(e){this.selectionChanged.raise(this,e)};FlexGrid.prototype.onLoadingRows=function(e){this.loadingRows.raise(this,e);return!e.cancel};FlexGrid.prototype.onLoadedRows=function(e){this.loadedRows.raise(this,e);this._autoRowHeights()};FlexGrid.prototype.onUpdatingLayout=function(e){this.updatingLayout.raise(this,e);return!e.cancel};FlexGrid.prototype.onUpdatedLayout=function(e){this.updatedLayout.raise(this,e)};FlexGrid.prototype.onResizingColumn=function(e){this.resizingColumn.raise(this,e);return!e.cancel};FlexGrid.prototype.onResizedColumn=function(e){this.resizedColumn.raise(this,e);this._autoRowHeights()};FlexGrid.prototype.onAutoSizingColumn=function(e){this.autoSizingColumn.raise(this,e);return!e.cancel};FlexGrid.prototype.onAutoSizedColumn=function(e){this.autoSizedColumn.raise(this,e)};FlexGrid.prototype.onStarSizedColumns=function(e){this.starSizedColumns.raise(this,e);this._autoRowHeights()};FlexGrid.prototype.onDraggingColumn=function(e){this.draggingColumn.raise(this,e);return!e.cancel};FlexGrid.prototype.onDraggingColumnOver=function(e){this.draggingColumnOver.raise(this,e);return!e.cancel};FlexGrid.prototype.onDraggedColumn=function(e){this.draggedColumn.raise(this,e)};FlexGrid.prototype.onPinningColumn=function(e){this.pinningColumn.raise(this,e);return!e.cancel};FlexGrid.prototype.onPinnedColumn=function(e){this.pinnedColumn.raise(this,e)};FlexGrid.prototype.onResizingRow=function(e){this.resizingRow.raise(this,e);return!e.cancel};FlexGrid.prototype.onResizedRow=function(e){this.resizedRow.raise(this,e)};FlexGrid.prototype.onAutoSizingRow=function(e){this.autoSizingRow.raise(this,e);return!e.cancel};FlexGrid.prototype.onAutoSizedRow=function(e){this.autoSizedRow.raise(this,e)};FlexGrid.prototype.onDraggingRow=function(e){this.draggingRow.raise(this,e);return!e.cancel};FlexGrid.prototype.onDraggingRowOver=function(e){this.draggingRowOver.raise(this,e);return!e.cancel};FlexGrid.prototype.onDraggedRow=function(e){this.draggedRow.raise(this,e)};FlexGrid.prototype.onGroupCollapsedChanging=function(e){this.groupCollapsedChanging.raise(this,e);return!e.cancel};FlexGrid.prototype.onGroupCollapsedChanged=function(e){this.groupCollapsedChanged.raise(this,e)};FlexGrid.prototype.onColumnGroupCollapsedChanging=function(e){this.columnGroupCollapsedChanging.raise(this,e);return!e.cancel};FlexGrid.prototype.onColumnGroupCollapsedChanged=function(e){this.columnGroupCollapsedChanged.raise(this,e)};FlexGrid.prototype.onSortingColumn=function(e){this.sortingColumn.raise(this,e);return!e.cancel};FlexGrid.prototype.onSortedColumn=function(e){this.sortedColumn.raise(this,e)};FlexGrid.prototype.onBeginningEdit=function(e){this.beginningEdit.raise(this,e);return!e.cancel};FlexGrid.prototype.onPrepareCellForEdit=function(e){this.prepareCellForEdit.raise(this,e)};FlexGrid.prototype.onCellEditEnding=function(e){this.cellEditEnding.raise(this,e);return!e.cancel&&!e.stayInEditMode};FlexGrid.prototype.onCellEditEnded=function(e){this.cellEditEnded.raise(this,e);this._autoRowHeights()};FlexGrid.prototype.onRowEditStarting=function(e){this.rowEditStarting.raise(this,e)};FlexGrid.prototype.onRowEditStarted=function(e){this.rowEditStarted.raise(this,e)};FlexGrid.prototype.onRowEditEnding=function(e){this.rowEditEnding.raise(this,e)};FlexGrid.prototype.onRowEditEnded=function(e){this.rowEditEnded.raise(this,e);this._autoRowHeights()};FlexGrid.prototype.onRowAdded=function(e){this.rowAdded.raise(this,e);return!e.cancel};FlexGrid.prototype.onDeletingRow=function(e){this.deletingRow.raise(this,e);return!e.cancel};FlexGrid.prototype.onDeletedRow=function(e){this.deletedRow.raise(this,e)};FlexGrid.prototype.onCopying=function(e){this.copying.raise(this,e);return!e.cancel};FlexGrid.prototype.onCopied=function(e){this.copied.raise(this,e)};FlexGrid.prototype.onPasting=function(e){this.pasting.raise(this,e);return!e.cancel};FlexGrid.prototype.onPasted=function(e){this.pasted.raise(this,e)};FlexGrid.prototype.onPastingCell=function(e){this.pastingCell.raise(this,e);return!e.cancel};FlexGrid.prototype.onPastedCell=function(e){this.pastedCell.raise(this,e)};FlexGrid.prototype.onFormatItem=function(e){this.formatItem.raise(this,e)};FlexGrid.prototype.onUpdatingView=function(e){this.updatingView.raise(this,e);return!e.cancel};FlexGrid.prototype.onUpdatedView=function(e){this.updatedView.raise(this,e)};FlexGrid.prototype._autoRowHeights=function(){var e=this;if(this._autoHeights){clearTimeout(this._toAutoHeights);this._toAutoHeights=setTimeout((function(){e._toAutoHeights=null;e.editRange||e.autoSizeRows()}),wijmo_1.Control._REFRESH_INTERVAL)}};FlexGrid.prototype._getShowErrors=function(){return this.showErrors&&this._hasValidation};FlexGrid.prototype._getHasValidation=function(){return this._hasValidation};FlexGrid.prototype._getError=function(e,t,i,o){if(wijmo_1.isFunction(this.itemValidator)){if(e==this.cells)return this.itemValidator(t,i,o);if(e==this.rowHeaders)for(i=0;i<this.columns.length;i++){if(c=this.itemValidator(t,i,o))return c}}var n=this._cv,r=n?n.getError:null;if(wijmo_1.isFunction(r)){var l=e.rows,s=this.columns,a=l[t].dataItem;if(a&&!(a instanceof wijmo_1.CollectionViewGroup))for(;t<l.length&&l[t].dataItem==a;t++){if(e==this.cells){return r(a,this._getBindingColumn(this.cells,t,s[i]).binding,o)}if(e==this.rowHeaders)for(i=0;i<s.length;i++){var c;if(c=r(a,this._getBindingColumn(this.cells,t,s[i]).binding))return c}}}return null};FlexGrid.prototype._setAria=function(e,t){wijmo_1.setAttribute(this.cells.hostElement,"aria-"+e,t)};FlexGrid.prototype._setFocus=function(e){if(this.hostElement&&(e||!this.containsFocus())){var t=wijmo_1.getActiveElement(),i=this.activeEditor,o=this._activeCell,n=this._eFocus,r=this._root;if(i){if(!wijmo_1.contains(i,t)){i.focus();n.tabIndex=-1}}else if(o){if(!wijmo_1.contains(o,t)&&t!=this._root){wijmo_1.isIE()&&wijmo_1.hasClass(o,"wj-group")&&(o=o.querySelector("."+CellFactory._WJC_COLLAPSE)||o);o.tabIndex=this._orgTabIndex;this._setFocusNoScroll(o);n.tabIndex=-1}}else if(!wijmo_1.contains(n,t)&&t!=r){n.tabIndex=this._orgTabIndex;this._setFocusNoScroll(n)}if(!this.containsFocus()){n.tabIndex=this._orgTabIndex;this._setFocusNoScroll(n)}}};FlexGrid.prototype._setFocusNoScroll=function(e){if(wijmo_1.getActiveElement()!=e){if(wijmo_1.supportsFocusOptions())e.focus({preventScroll:!0});else{var t=this.scrollPosition,i=e.style,o=i.position;i.position="fixed";e.focus();i.position=o;this.scrollPosition=t}this._fixScroll()}};FlexGrid.prototype._getDefaultRowHeight=function(){var e=this.hostElement,t=this._eFocus,i=null;if(!t.offsetHeight){i=wijmo_1.createElement('<div><div class="wj-cell">0</div></div>',document.documentElement);e&&i.setAttribute("class",e.getAttribute("class"));t=i.children[0]}var o=t.offsetHeight;(isNaN(o)||o<=6)&&(o=28);wijmo_1.removeChild(i);return o};FlexGrid.prototype._getCollectionView=function(e){return wijmo_1.asCollectionView(e)};FlexGrid.prototype._getCanvasContext=function(){var e=document.createElement("canvas").getContext("2d"),t=getComputedStyle(this.hostElement);e.font=t.fontSize+" "+t.fontFamily.split(",")[0];return e};FlexGrid.prototype._getWidestRow=function(e,t,i,o){for(var n=0,r=0,l=e.columns[i].dataType==wijmo_1.DataType.Boolean,s=t.row;s<=t.row2;s++)if(e.rows[s].isVisible){var a=e.getCellData(s,i,!0),c=o.measureText(a).width,d=this.getMergedRange(e,s,i,!1);d&&d.columnSpan>1&&(c/=d.columnSpan);if(c>r){r=c;n=s}if(l)break}return n};FlexGrid.prototype._getDesiredWidth=function(e,t,i,o){var n=this.getMergedRange(e,t,i,!1),r=o.style;this.cellFactory.updateCell(e,t,i,o,n);r.width=r.top=r.left="";return o.offsetWidth/(n&&n.columnSpan>1?n.columnSpan:1)};FlexGrid.prototype._getDesiredHeight=function(e,t,i,o){var n=o.style,r=this.getMergedRange(e,t,i,!1),l=r?r.rowSpan:1;this.cellFactory.updateCell(e,t,i,o,r);o.innerHTML.trim()||(o.innerHTML="&nbsp;");n.height=n.top=n.left="";return o.offsetHeight/l};FlexGrid.prototype._getDesiredRowHeight=function(e,t,i,o){for(var n=0,r=this._getQuickAutoSize(),l=0;l<e.columns.length;l++){var s=e.columns[l];if(s.isVisible){var a=this.getMergedRange(e,t,l,!1),c=void 0;if(r){var d={ct:e.cellType,col:l,rng:a&&a.rowSpan>1?a.rowSpan:1,data:s.dataType!=wijmo_1.DataType.Number||s.dataMap?e.getCellData(t,l,!0):"1"},u=JSON.stringify(d);if(null==(c=o[u])){c=this._getDesiredHeight(e,t,l,i);o[u]=c}}else c=this._getDesiredHeight(e,t,l,i);n=Math.max(c,n)}}return n};FlexGrid.prototype._getSortRowIndex=function(){return null!=this._sortRowIndex?this._sortRowIndex:this.columnHeaders.rows.length-1};FlexGrid.prototype._getEditColumnIndex=function(){return null!=this._editColIndex?this._editColIndex:this.rowHeaders.columns.length-1};FlexGrid.prototype._sortConverter=function(e,t,i,o){var n,r=this;if(o){this._mappedColumns=null;this._cv&&this._cv.sortDescriptions.forEach((function(e){if((n=r.getColumn(e.property))&&n.dataMap){r._mappedColumns||(r._mappedColumns={});r._mappedColumns[n.binding]=n.dataMap}}));if(this._mouseHdl._htDown&&this._mouseHdl._htDown.col>-1){n=this.columns[this._mouseHdl._htDown.col];this._mappedColumns&&n.dataMap&&(this._mappedColumns[n.binding]=n.dataMap)}}if(this._mappedColumns){var l=this._mappedColumns[e.property];l&&l.sortByDisplayValues&&(i=l.getDisplayValue(i))}return i};FlexGrid.prototype._bindGrid=function(e){var t=this;this.finishEditing();this.deferUpdate((function(){t.autoGenerateColumns&&0==t._lastCount&&wijmo_1.hasItems(t._cv)&&(e=!0);var i,o;t.preserveSelectedState&&(i=t._getMap())&&t.rows.forEach((function(e){e.isSelected&&e.dataItem&&i.set(e.dataItem,!0)}));if(t.preserveOutlineState&&t.rows.maxGroupLevel>-1&&(o=t._getMap()))for(var n=0;n<t.rows.length;n++){var r=t.rows[n];if(r instanceof GroupRow&&r.isCollapsed&&r.dataItem){var l=r.dataItem;l instanceof wijmo_1.CollectionViewGroup&&(l=l._path);o.set(l,!0)}}e&&t.columns.deferUpdate((function(){t._bindColumns()}));var s=new wijmo_1.CancelEventArgs;if(t.onLoadingRows(s)){t.rows.deferUpdate((function(){t._bindRows()}));t.onLoadedRows(s)}t._selHdl.extendedSelection.clear();var a=0;i&&i.size&&t.rows.forEach((function(e){var t=e.dataItem;if(t&&i.has(t)){e.isSelected=!0;a++}}));if(0==a&&t._lastCount>0&&t.selectionMode==SelectionMode.ListBox){var c=t.selection;for(n=c.topRow;n<=c.bottomRow&&n>-1&&n<t.rows.length;n++)t.rows[n].isSelected=!0}o&&o.size&&t.rows.deferUpdate((function(){t.rows.forEach((function(e){if(e instanceof GroupRow){var t=e.dataItem;t instanceof wijmo_1.CollectionViewGroup&&(t=t._path);o.has(t)&&(e.isCollapsed=!0)}}))}));if(!t._lastCount){var d=t._cv;d&&d.items&&(t._lastCount=d.items.length)}}));if(!this.rows.length){var i=this._selHdl.selection;i.row=i.row2=-1}if(this._cv){var o=e&&!this._toInv;this._syncSelection(o)}};FlexGrid.prototype._getMap=function(){return window.Map?new Map:null};FlexGrid.prototype._cvCollectionChanged=function(e,t){if(this.autoGenerateColumns&&0==this.columns.length)this._bindGrid(!0);else{var i=wijmo_1.NotifyCollectionChangedAction;if(this.childItemsPath&&t.action!=i.Change)this._bindGrid(!1);else{switch(t.action){case i.Change:this.invalidate();return;case i.Add:if(t.index==this._cv.items.length-1){var o=this.rows.length;this.rows[o-1]instanceof _NewRowTemplate&&o--;this.rows.insert(o,new Row(t.item));return}wijmo_1.assert(!1,"added item should be the last one.");break;case i.Remove:var n=this._findRow(t.item);if(n>-1){this.rows.removeAt(n);this._syncSelection();return}wijmo_1.assert(!1,"removed item not found on grid.")}this._bindGrid(!1)}}};FlexGrid.prototype._cvCurrentChanged=function(e,t){this._syncSelection()};FlexGrid.prototype._syncSelection=function(e){if(this._cv&&this.selectionMode!=SelectionMode.None){var t=this._selHdl.selection,i=t.row>-1&&t.row<this.rows.length?this.rows[t.row]:null,o=i?i.dataItem:null,n=this._cv;if(n instanceof wijmo_1.CollectionView&&n.isUpdating)return;if(this.newRowAtTop&&i instanceof _NewRowTemplate)return;o instanceof wijmo_1.CollectionViewGroup&&(o=null);if(o!=n.currentItem||e){var r=this.editableCollectionView;if(!this.childItemsPath||!r||!r.currentAddItem){var l=this._getRowIndex(n.currentPosition);if(l!=t.row||!this.childItemsPath){t=new CellRange(l,t.col,l,t.col2);this.select(t,!1);this.selectionMode&&this.scrollIntoView(t.row,-1)}}}}};FlexGrid.prototype._getRowIndex=function(e){if(this._cv){var t=this.rows;if(e>-1){for(var i=this._cv.items[e];e<t.length;e++)if(t[e].dataItem===i)return e;return-1}if(1==t.length&&t[0]instanceof _NewRowTemplate)return 0;var o=this.selection.row,n=o>-1?t[o]:null;return n&&(n instanceof GroupRow||null==n.dataItem)?o:-1}return this.selection.row};FlexGrid.prototype._getCvIndex=function(e){return e>-1&&e<this.rows.length?this.rows[e].dataIndex:-1};FlexGrid.prototype._findRow=function(e){for(var t=0;t<this.rows.length;t++)if(this.rows[t].dataItem==e)return t;return-1};FlexGrid.prototype._updateLayout=function(){var e=new wijmo_1.CancelEventArgs;if(this.onUpdatingLayout(e)){var t=this._hdrVis&HeadersVisibility.Row?this._hdrCols.getTotalSize():0,i=this._hdrVis&HeadersVisibility.Column?this._hdrRows.getTotalSize():0,o=this._ftrRows.getTotalSize(),n=this._rows.getTotalSize()+o;n<1&&(n=1);this._heightReal=n;this._heightBrowser=Math.min(n,FlexGrid._getMaxSupportedCssHeight());this._maxOffsetY=Math.max(0,n-this._heightBrowser);var r=getComputedStyle(this._eFocus);this._cellPadVert=parseInt(r.paddingTop)+parseInt(r.paddingBottom);this._cellPadHorz=parseInt(r.paddingLeft)+parseInt(r.paddingRight);this._cellPadLeft=parseInt(this.rightToLeft?r.paddingRight:r.paddingLeft);var l=this._heightBrowser+i-o,s=this._gpCells.width,a=this._heightBrowser;!s&&this.rows.length&&(s=.1);!a&&this.columns.length&&(a=.1);if(this.rightToLeft){wijmo_1.setCss(this._eTL,{right:0,top:0,width:t,height:i});wijmo_1.setCss(this._eCHdr,{right:t,top:0,height:i});wijmo_1.setCss(this._eRHdr,{right:0,top:i,width:t});wijmo_1.setCss(this._eCt,{right:t,top:i,width:s,height:a});wijmo_1.setCss(this._fCt,{right:t,top:i});wijmo_1.setCss(this._eBL,{right:0,top:l,width:t,height:o});wijmo_1.setCss(this._eCFtr,{right:t,top:l,height:o})}else{wijmo_1.setCss(this._eTL,{left:0,top:0,width:t,height:i});wijmo_1.setCss(this._eCHdr,{left:t,top:0,height:i});wijmo_1.setCss(this._eRHdr,{left:0,top:i,width:t});wijmo_1.setCss(this._eCt,{left:t,top:i,width:s,height:a});wijmo_1.setCss(this._fCt,{left:t,top:i});wijmo_1.setCss(this._eBL,{left:0,top:l,width:t,height:o});wijmo_1.setCss(this._eCFtr,{left:t,top:l,height:o})}this._stickyHdr&&this._updateStickyHeaders();var c=this.frozenRows||this.frozenColumns?"3":"";wijmo_1.setCss([this._eTL,this._eBL,this._eCHdr,this._eCFtr,this._eRHdr,this._eMarquee],{zIndex:c});var d=this._root,u=d.offsetWidth-d.clientWidth,h=d.offsetHeight-d.clientHeight;wijmo_1.setCss(this._eSz,{width:t+u+this._gpCells.width,height:i+h+this._heightBrowser});var _=null;if(this.columns._updateStarSizes(d.clientWidth-t)){_=d.clientWidth;wijmo_1.setCss(this._eCt,{width:this._gpCells.width});this.onStarSizedColumns()}this._szClient=new wijmo_1.Size(d.clientWidth-t,d.clientHeight-i);this._rcBounds=null;this._updateScrollHandler();this._updateContent(!1);u=d.offsetWidth-d.clientWidth;h=d.offsetHeight-d.clientHeight;wijmo_1.setCss(this._eSz,{width:t+u+this._gpCells.width,height:i+h+this._heightBrowser});this._szClient=new wijmo_1.Size(d.clientWidth-t,d.clientHeight-i);if(_&&_!=d.clientWidth&&this.columns._updateStarSizes(d.clientWidth-t)){wijmo_1.setCss(this._eCt,{width:this._gpCells.width});this._updateContent(!1)}wijmo_1.setCss([this._eCHdr,this._eCFtr,this._fCt],{width:this._szClient.width});wijmo_1.setCss([this._eRHdr,this._fCt],{height:this._szClient.height});if(o){l=Math.min(l,this._szClient.height+i-o);wijmo_1.setCss([this._eBL,this._eCFtr],{top:l})}this.onUpdatedLayout(e)}};FlexGrid.prototype._updateStickyHeaders=function(){var e=!1,t=0;if(this._stickyHdr){for(var i=0,o=null,n=this.hostElement;n;n=n.parentElement)if("inline"!=getComputedStyle(n).display){var r=n.getBoundingClientRect();null==o&&(o=r.top);i=Math.max(i,r.top)}t=-(o=Math.max(0,i-o-1));e=o>0;this._rcBounds=null}this._eTL.style.top=this._eCHdr.style.top=e?-t+"px":"";wijmo_1.toggleClass(this._eTL,FlexGrid._WJS_STICKY,e);wijmo_1.toggleClass(this._eCHdr,FlexGrid._WJS_STICKY,e)};FlexGrid.prototype._updateScrollHandler=function(){this._clipToScreen=this._getClipToScreen();var e=this._stickyHdr||this._clipToScreen;if(e!=this._scrollHandlerAttached){this._scrollHandlerAttached=e;e?this.addEventListener(window,"scroll",this._scroll.bind(this),!0):this.removeEventListener(window,"scroll")}};FlexGrid.prototype._getClipToScreen=function(){if(this.rows.length<=FlexGrid._MIN_VIRT_ROWS)return!1;if(this._root.scrollHeight>this._root.clientHeight)return!1;for(var e=this.hostElement;e&&e!=document.documentElement;e=e.parentElement){if("auto"==getComputedStyle(e).overflow)return!1}return!0};FlexGrid.prototype._scroll=function(e){var t=this;if(wijmo_1.contains(e.target,this.hostElement)){if(this._clipToScreen){this._afClip&&cancelAnimationFrame(this._afClip);this._afClip=requestAnimationFrame((function(){t._afClip=null;t.finishEditing();t._updateContent(!0)}))}if(this._stickyHdr){this._afSticky&&cancelAnimationFrame(this._afSticky);this._afSticky=requestAnimationFrame((function(){t._afSticky=null;var e=new wijmo_1.CancelEventArgs;if(t.onUpdatingLayout(e)){t._updateStickyHeaders();t.onUpdatedLayout(e)}}))}}};FlexGrid.prototype._getCssPage=function(e){if(this._heightReal>this._heightBrowser){var t=this._szClient.height-this._gpCFtr.rows.getTotalSize();if(this._heightBrowser>t)return wijmo_1.clamp(Math.round(e/(this._heightBrowser-t)*10)/10,0,1)}return 0};FlexGrid.prototype._updateScrollPosition=function(){var e=this._root,t=e.scrollTop,i=e.scrollLeft;this.rightToLeft&&"rev"==FlexGrid._getRtlMode()&&(i=e.scrollWidth-e.clientWidth-i);var o=new wijmo_1.Point(-Math.abs(i),-t);if(!this._ptScrl.equals(o)){this._ptScrl=o;this.onScrollPositionChanged();return!0}return!1};FlexGrid.prototype._updateContent=function(e,t){var i=this,o=this._root,n=this.hostElement,r=this.cells.hostElement,l=this._activeCell,s=wijmo_1.getActiveElement(),a=wijmo_1.contains(n,s),c=wijmo_1.closest(s,".wj-flexgrid")==n?s:null,d=new wijmo_1.CancelEventArgs;if(this.onUpdatingView(d)){wijmo_1.setAttribute(r,"role",this.rows.maxGroupLevel<0?"grid":"treegrid");this._hasValidation=wijmo_1.isFunction(this._itemValidator)||this._cv&&wijmo_1.isFunction(this._cv.getError);var u=!t&&this._errorTip&&this._errorTip._tips.length,h=this._getCssPage(-this._ptScrl.y);if(h!=this._cssPage){this._cssPage=h;this._offsetY=Math.round(this._maxOffsetY*h)}this._updateScrollPosition();var _=this._gpCells._updateContent(e,t,this._offsetY),g=this._hdrVis;if(g&HeadersVisibility.Column&&(!t||this._ssHdr&g)){this._gpCHdr._updateContent(e,t,0);this.rightToLeft||(this._eCHdr.scrollLeft=0)}if(g&HeadersVisibility.Row&&(!t||this._ssHdr&g)){this._gpRHdr._updateContent(e,t,this._offsetY);this._eRHdr.scrollTop=0}g&&!t&&this._gpTL._updateContent(e,t,0);if(this._gpCFtr.rows.length){this._gpBL._updateContent(e,t,0);this._gpCFtr._updateContent(e,t,0)}this._updateMarquee();if(u&&this._errorTip&&this._errorTip._tips.length){clearTimeout(this._toErrorTips);this._toErrorTips=setTimeout((function(){i._errorTip.hide();for(var e=i._errorTip._tips,t=0;t<e.length;t++){var o=e[t].element;if(!o.offsetHeight||!wijmo_1.hasClass(o,"wj-state-invalid")){i._errorTip.setTooltip(o,null);t--}}}),250)}if(this._useFrozenDiv()){this._updateFrozenCells(t);_&&wijmo_1.hasClass(_,"wj-frozen")&&(_=null)}this._fCt.style.display=this._fCt.childElementCount?"":"none";this._activeCell=_;if(c)if(c!=o&&c!=this._eFocus&&wijmo_1.contains(n,c)&&!wijmo_1.contains(r,c)){wijmo_1.getActiveElement()!==c&&c.focus();if(wijmo_1.isIE()&&c instanceof HTMLInputElement&&!c.type.match(/checkbox|radio|range/i)){var p=c.selectionStart,f=c.selectionEnd;c.setSelectionRange(p,f)}}else{var w=_!==l;this._setFocus(w)}!c&&_&&(_.tabIndex=this.isDisabled?-1:this._orgTabIndex);l&&l!=_&&(l.tabIndex=-1);this._eFocus.tabIndex=null!=_||this.isDisabled?-1:this._orgTabIndex;a&&this.focus();this._fixScroll();this._rcBounds=null;this.onUpdatedView(d)}};FlexGrid.prototype._fixScroll=function(){if(!this._updating){var e=this.hostElement,t=this._root?this._root.parentElement:null,i=this.rightToLeft;if(e){e.scrollTop&&(e.scrollTop=0);e.scrollLeft&&!i&&(e.scrollLeft=0)}if(t){t.scrollTop&&(t.scrollTop=0);t.scrollLeft&&!i&&(t.scrollLeft=0)}}};FlexGrid.prototype._clearCells=function(){for(var e in this)if("_"==e[0]){var t=this[e];t instanceof GridPanel&&t._clearCells()}this.invalidate()};FlexGrid.prototype._useFrozenDiv=function(){return wijmo_1.isBoolean(this._fzClone)?this._fzClone:wijmo_1.isIE()||wijmo_1.isFirefox()||wijmo_1.isSafari()||wijmo_1.isMobile()};FlexGrid.prototype._updateFrozenCells=function(e){var t=this._fCt;if(this.frozenRows||this.frozenColumns){var i=this._eCt.querySelectorAll(".wj-frozen");if(e&&t.children.length==i.length){for(var o=0;o<i.length;o++)t.children[o].className=i[o].className;return}wijmo_1.setText(t,null);if(!this.activeEditor){var n=this._errorTip,r=navigator.userAgent.indexOf("MSIE")>=0;for(o=0;o<i.length;o++){var l=i[o];if(wijmo_1.closest(l,".wj-flexgrid")==this.hostElement){var s=l[GridPanel._INDEX_KEY];if(r){var a="input[type=checkbox]",c=l.querySelector(a);l=l.cloneNode(!0);if(c){l.querySelector(a).checked=c.checked}}else l=l.cloneNode(!0);l[GridPanel._INDEX_KEY]=s;if(n){var d=n.getTooltip(i[o]);d&&n.setTooltip(l,d)}t.appendChild(l)}}}}else wijmo_1.setText(t,null)};FlexGrid.prototype._updateMarquee=function(){var e=this._eMarquee,t=this._getMarqueeRect();if(t&&t.width&&t.height){var i=e.firstChild,o=e.offsetWidth-i.offsetWidth,n=e.offsetHeight-i.offsetHeight,r=this.cells.hostElement;wijmo_1.setCss(e,{left:t.left+r.offsetLeft-o/2,top:t.top+r.offsetTop-n/2,width:t.width+o,height:t.height+n,display:""})}else e.style.display="none"};FlexGrid.prototype._getMarqueeRect=function(){if(!this._shMarquee)return null;var e=this._selHdl.selection;if(!this.isRangeValid(e))return null;e=(e=e.combine(this.getMergedRange(this.cells,e.topRow,e.leftCol))).combine(this.getMergedRange(this.cells,e.bottomRow,e.rightCol));var t=this.cells.getCellBoundingRect(e.topRow,e.leftCol,!0),i=this.cells.getCellBoundingRect(e.bottomRow,e.rightCol,!0);if(this.rows.frozen){var o=Math.min(this.rows.length,this.rows.frozen),n=this.cells.getCellBoundingRect(o-1,0,!0);e.topRow>=o&&t.top<n.bottom&&(t.top=n.bottom);e.bottomRow>=o&&i.bottom<n.bottom&&(i.height=n.bottom-i.top)}if(this.columns.frozen){var r=Math.min(this.columns.length,this.columns.frozen);n=this.cells.getCellBoundingRect(0,r-1,!0);if(this.rightToLeft){e.leftCol>=r&&t.right>n.left&&(t.left=n.left-t.width);e.rightCol>=r&&i.left>n.left&&(i.left=n.left)}else{e.leftCol>=r&&t.left<n.right&&(t.left=n.right);e.rightCol>=r&&i.right<n.right&&(i.width=n.right-i.left)}}return this.rightToLeft?new wijmo_1.Rect(i.left,t.top,t.right-i.left,i.bottom-t.top):new wijmo_1.Rect(t.left,t.top,i.right-t.left,i.bottom-t.top)};FlexGrid.prototype._bindColumns=function(){for(var e=this,t=this.columns,i=0;i<t.length;i++){if(t[i]._getFlag(RowColFlags.AutoGenerated)){t.removeAt(i);i--}}var o=this._cv,n=o?o.sourceCollection:null;n&&n.length&&this.autoGenerateColumns&&this._getColumnTypes(n).forEach((function(i){var o=new Column(i);o._setFlag(RowColFlags.AutoGenerated,!0);o.name=i.binding;o.header=wijmo_1.toHeaderCase(i.binding);var n=FlexGrid._defTypeWidth[o.dataType];if(null!=n){if(wijmo_1.isString(n)){var r=Math.round(parseFloat(n));n=n.indexOf("*")<0?r:r*e.columns.defaultSize}wijmo_1.isNumber(n)&&n>0&&(o.width=n)}t.push(o)}));this._updateColumnTypes()};FlexGrid.prototype._getColumnTypes=function(e){return wijmo_1.getTypes(e)};FlexGrid.prototype._updateColumnTypes=function(){var e=this._cv;if(wijmo_1.hasItems(e)){var t=e.items[0];this.columns.forEach((function(e){null==e.dataType&&e._binding&&(e.dataType=wijmo_1.getType(e._binding.getValue(t)))}))}};FlexGrid.prototype._getMapEditor=function(e,t){return!e.dataMap||e instanceof GroupRow?t.dataMap?t.dataMapEditor:null:e.dataMapEditor};FlexGrid.prototype._getBindingColumn=function(e,t,i){return i};FlexGrid.prototype._getBindingColumns=function(){return this.columns};FlexGrid.prototype._getRowHeaderPath=function(){return this._rowHdrPath};FlexGrid.prototype._bindRows=function(){this.rows.clear();var e=this._cv;if(e&&e.items){var t=e.items,i=e.groups;if(this.childItemsPath)for(var o=0;o<t.length;o++)this._addNode(t,o,0);else if(null!=i&&i.length>0&&this.showGroups)for(o=0;o<i.length;o++)this._addGroup(i[o]);else for(o=0;o<t.length;o++)this._addBoundRow(t,o)}};FlexGrid.prototype._addBoundRow=function(e,t){var i=new Row(e[t]),o=this.rows;i._list=o;o[o.length++]=i};FlexGrid.prototype._addGroupRow=function(e){this.rows.push(new GroupRow(e))};FlexGrid.prototype._addNode=function(e,t,i){var o=e[t],n=this.childItemsPath,r=o[wijmo_1.isArray(n)?n[i]:n],l=new GroupRow(o);l.level=i;this.rows.push(l);if(wijmo_1.isArray(r))for(var s=0;s<r.length;s++)this._addNode(r,s,i+1)};FlexGrid.prototype._addGroup=function(e){this._addGroupRow(e);if(e.isBottomLevel)for(var t=e.items,i=0;i<t.length;i++)this._addBoundRow(t,i);else for(i=0;i<e.groups.length;i++)this._addGroup(e.groups[i])};FlexGrid._getSerializableProperties=function(e){var t=[];for(e=e.prototype;e!=Object.prototype;e=Object.getPrototypeOf(e))for(var i=Object.getOwnPropertyNames(e),o=0;o<i.length;o++){var n=i[o],r=Object.getOwnPropertyDescriptor(e,n);r&&r.set&&r.get&&"_"!=n[0]&&!n.match(/disabled|required/)&&t.push(n)}return t};FlexGrid.prototype._hasColumnGroups=function(){return this._grpHdl.hasColumnGroups()};FlexGrid.prototype._getColumnGroup=function(e,t){return this._grpHdl.getColumnGroup(e,t)};FlexGrid.prototype._copy=function(e,t){var i=this;if("columns"==e){var o=wijmo_1.asArray(t);if(o.some((function(e){return null!=e.columns})))this.columnGroups=o;else{this.columns.clear();o.forEach((function(e){var t=new Column(e);i.columns.push(t)}))}return!0}return!1};FlexGrid.prototype._isInputElement=function(e){return e instanceof HTMLElement&&!wijmo_1.hasClass(e,"wj-btn-glyph")&&("true"==e.contentEditable||null!=e.tagName.match(/^(BUTTON|A|INPUT|TEXTAREA|SELECT|OPTION|LABEL)$/i))};FlexGrid.prototype._isNativeCheckbox=function(e){return e instanceof HTMLInputElement&&"checkbox"==e.type&&!e.disabled&&!e.readOnly&&wijmo_1.hasClass(e,CellFactory._WJC_CHECKBOX)&&wijmo_1.closest(e,".wj-flexgrid")==this.hostElement};FlexGrid.prototype._wantsInput=function(e){return this._isInputElement(e)&&!this.activeEditor&&!this._isNativeCheckbox(e)&&!wijmo_1.hasClass(e,"wj-grid-ime")&&wijmo_1.contains(document.body,e)};FlexGrid._getMaxSupportedCssHeight=function(){if(!FlexGrid._maxCssHeight){var e=265e5;wijmo_1.isIE()?e=15e5:wijmo_1.isFirefox()&&(e=175e5);FlexGrid._maxCssHeight=e}return FlexGrid._maxCssHeight};FlexGrid._getRtlMode=function(){if(!FlexGrid._rtlMode){var e=wijmo_1.createElement('<div dir="rtl"><div></div></div>');wijmo_1.setCss(e,{visibility:"hidden",width:100,height:100,overflow:"auto"});wijmo_1.setCss(e.firstChild,{width:2e3,height:2e3});document.body.appendChild(e);var t=e.scrollLeft;e.scrollLeft=-1e3;var i=e.scrollLeft;wijmo_1.removeChild(e);FlexGrid._rtlMode=i<0?"neg":t>0?"rev":"std"}return FlexGrid._rtlMode};FlexGrid._WJS_STICKY="wj-state-sticky";FlexGrid._WJS_MEASURE="wj-state-measuring";FlexGrid._WJS_UPDATING="wj-state-updating";FlexGrid._WJS_WSPRE="wj-whitespace-pre";FlexGrid._MIN_VIRT_ROWS=200;FlexGrid._defTypeWidth=((_a={})[wijmo_1.DataType.Number]="0.714285714*",_a);FlexGrid.controlTemplate='<div><div wj-part="root"><div wj-part="cells" class="wj-cells"></div><div wj-part="marquee" class="wj-marquee"><div></div></div></div><div wj-part="fcells" aria-hidden="true" class="wj-cells wj-frozen-clone"></div><div wj-part="rh"><div wj-part="rhcells" class="wj-rowheaders"></div></div><div wj-part="cf"><div wj-part="cfcells" class="wj-colfooters"></div></div><div wj-part="ch"><div wj-part="chcells" class="wj-colheaders"></div></div><div wj-part="bl"><div wj-part="blcells" class="wj-bottomleft"></div></div><div wj-part="tl"><div wj-part="tlcells" class="wj-topleft"></div></div><div wj-part="focus" class="wj-cell">0</div><div wj-part="sz"></div></div>';return FlexGrid}(wijmo_1.Control);exports.FlexGrid=FlexGrid;var _ImeHandler=function(){function _ImeHandler(e){this._updateImeFocusBnd=this._updateImeFocus.bind(this);this._cmpstartBnd=this._compositionstart.bind(this);this._mousedownBnd=this._mousedown.bind(this);this._mouseupBnd=this._mouseup.bind(this);this._keypressBnd=this._keypress.bind(this);this._g=e;var t=wijmo_1.createElement('<textarea class="wj-grid-editor wj-form-control wj-grid-ime" aria-hidden="true"/>');wijmo_1.setCss(t,_ImeHandler._cssHidden);wijmo_1.disableAutoComplete(t);t.tabIndex=-1;this._tbx=t;e._root.appendChild(t);this._updateImeFocus();var i=e.hostElement,o=e.addEventListener.bind(e);o(t,"compositionstart",this._cmpstartBnd);o(i,"blur",this._updateImeFocusBnd,!0);o(i,"focus",this._updateImeFocusBnd);o(i,"mousedown",this._mousedownBnd,!0);o(i,"mouseup",this._mouseupBnd,!0);o(i,"keypress",this._keypressBnd,!0);e.cellEditEnded.addHandler(this._cellEditEnded,this);e.selectionChanged.addHandler(this._updateImeFocus,this)}_ImeHandler.prototype.dispose=function(){var e=this._g,t=e.hostElement,i=this._tbx,o=e.removeEventListener.bind(e);o(i,"compositionstart",this._cmpstartBnd);o(t,"blur",this._updateImeFocusBnd);o(t,"focus",this._updateImeFocusBnd);o(t,"mousedown",this._mousedownBnd);o(t,"mouseup",this._mouseupBnd);o(t,"keypress",this._keypressBnd);e.cellEditEnded.removeHandler(this._cellEditEnded);e.selectionChanged.removeHandler(this._updateImeFocus);wijmo_1.removeChild(i)};_ImeHandler.prototype._compositionstart=function(e){var t=this._g;if(!t.activeEditor){if(e&&"keypress"==e.type&&27==e.keyCode)return;var i=t._selHdl.selection;if(t.startEditing(!1,i.row,i.col,!1,e)&&t.activeEditor&&"checkbox"!=t.activeEditor.type){i=t.editRange;var o=t.activeEditor,n=this._tbx,r=t.cells.hostElement,l=t.columns[i.col].pos+r.offsetLeft,s=t.rows[i.row].pos+r.offsetTop,a=t.getCellBoundingRect(i.row,i.col),c=wijmo_1.closest(o,".wj-cell");a.width=c.offsetWidth;a.height=c.offsetHeight;i.row<t.frozenRows&&(s+=t._root.scrollTop);i.col<t.frozenColumns&&(l+=t._root.scrollLeft);var d=c.querySelector(".wj-btn.wj-right");d&&(a.width-=d.offsetWidth);"minLength,maxLength,pattern".split(",").forEach((function(e){wijmo_1.setAttribute(n,e,o.getAttribute(e))}));var u=o instanceof HTMLTextAreaElement;wijmo_1.setAttribute(n,"wrap",u?"soft":"off");var h=getComputedStyle(c),_=h.paddingTop;if(i.rowSpan>1&&!u){var g=parseFloat(h.lineHeight);isNaN(g)&&(g=1.2*parseFloat(h.fontSize));_=Math.max(0,(a.height-g)/2)+"px"}var p={position:"absolute",left:l,top:s,width:a.width-1,height:a.height-1,paddingTop:_,paddingLeft:h.paddingLeft,paddingRight:h.paddingRight,textAlign:h.textAlign,zIndex:c.style.zIndex};if(t.rightToLeft){p.right=parseInt(c.style.right)+parseInt(t.cells.hostElement.style.right);p.left=""}wijmo_1.setCss(n,p);t._edtHdl._edt=n;n.select();var f=o.value;setTimeout((function(){if("　"==n.value||" "==n.value){n.value=f;wijmo_1.setSelectionRange(n,f.length)}}),20);o.value=""}}};_ImeHandler.prototype._cellEditEnded=function(){var e=this;wijmo_1.setCss(this._tbx,_ImeHandler._cssHidden);setTimeout((function(){e._tbx.value=""}))};_ImeHandler.prototype._mousedown=function(e){this._isMouseDown=!0;this._updateImeFocus()};_ImeHandler.prototype._mouseup=function(e){this._isMouseDown=!1;this._updateImeFocus()};_ImeHandler.prototype._keypress=function(e){if(!e.defaultPrevented&&e.target==this._tbx&&!(e.ctrlKey||e.altKey||e.metaKey||this._g.activeEditor)){this._tbx.value="";this._compositionstart(e);e.stopPropagation()}};_ImeHandler.prototype._updateImeFocus=function(){var e=this._g,t=this._tbx,i=wijmo_1.getActiveElement();if(!e.activeEditor&&wijmo_1.closest(i,".wj-flexgrid")==e.hostElement)if(this._enableIme()){if(i!=t){t.disabled=!1;t.select();t.focus()}}else{t.disabled=!0;t.value="";e.focus()}};_ImeHandler.prototype._enableIme=function(){var e=this._g,t=e._selHdl.selection;if(!e.canEditCell(t.row,t.col))return!1;var i=t.isValid?e._getBindingColumn(e.cells,t.row,e.columns[t.col]):null;return!(!i||i.dataType==wijmo_1.DataType.Boolean)};_ImeHandler._cssHidden={position:"fixed",width:"1px",left:-32e3,top:-32e3,overflow:"hidden"};return _ImeHandler}();exports._ImeHandler=_ImeHandler;var _ColumnGroupHandler=function(){function _ColumnGroupHandler(e){this._grid=e}_ColumnGroupHandler.prototype.createColumnGroups=function(e){var t=this,i=this._grid;this._groupDefs=wijmo_1.asArray(e);i.autoGenerateColumns=!1;i.columns.clear();this._colGroups=[];e.forEach((function(e){t._colGroups.push(new ColumnGroup(e,null))}));var o=1;this._colGroups.forEach((function(e){t._addColumnGroup(e);o=Math.max(o,e._getMaxLevel())}));this._colGroups.forEach((function(e){e._expandRange(o)}));var n=i.columnHeaders.rows;n.clear();for(var r=0;r<=o;r++){var l=new Row;n.splice(r,0,l);r<o&&(l.cssClassAll="wj-colgroup")}for(r=0;r<n.length;r++)for(var s=0;s<i.columns.length;s++){var a=this.getColumnGroup(r,s);if(a){var c=a.header||wijmo_1.toHeaderCase(a.binding);i.columnHeaders.setCellData(r,s,c)}}};_ColumnGroupHandler.prototype._addColumnGroup=function(e){var t=this,i=this._grid;e._grid=i;e._rng.col=i.columns.length;0==e.columns.length?i.columns.push(e):e.columns.forEach((function(e){t._addColumnGroup(e)}));e._rng.col2=i.columns.length-1};_ColumnGroupHandler.prototype.hasColumnGroups=function(){return null!=this._colGroups&&this._colGroups.length>0};_ColumnGroupHandler.prototype.getGroupDefinitions=function(){return this._groupDefs};_ColumnGroupHandler.prototype.getColumnGroup=function(e,t){var i=this._grid;if(e<i.columnHeaders.rows.length&&t<i.columns.length)for(var o=this._colGroups;o;){for(var n=o,r=0;r<o.length;r++){var l=o[r],s=l._rng;if(s.containsColumn(t)){if(s.containsRow(e)||0==l.columns.length)return l;o=l.columns;break}}if(o==n)break}return null};return _ColumnGroupHandler}();exports._ColumnGroupHandler=_ColumnGroupHandler;var CellType,ColumnGroup=function(e){__extends(ColumnGroup,e);function ColumnGroup(t,i){var o=e.call(this)||this;o._rng=new CellRange(0,-1);o._cols=[];o._lvl=0;o._collapsed=!1;o._pGrp=i;for(var n=i;n;n=n._pGrp)o._lvl++;o._rng.row=o._rng.row2=o._lvl;o.allowDragging=!1;t&&wijmo_1.copy(o,t);return o}Object.defineProperty(ColumnGroup.prototype,"columns",{get:function(){return this._cols},set:function(e){var t=this;this._cols=[];e.forEach((function(e){var i=new ColumnGroup(e,t);t._cols.push(i)}))},enumerable:!0,configurable:!0});Object.defineProperty(ColumnGroup.prototype,"collapseTo",{get:function(){return this._collTo},set:function(e){this._collTo=wijmo_1.asString(e)},enumerable:!0,configurable:!0});Object.defineProperty(ColumnGroup.prototype,"isCollapsed",{get:function(){return this._collapsed},set:function(e){var t=this;if(e!=this._collapsed){var i=this._grid;if(i){var o=new CellRangeEventArgs(i.rowHeaders,this._rng,this);if(i.onColumnGroupCollapsedChanging(o)){this._collapsed=wijmo_1.asBoolean(e);i.onColumnGroupCollapsedChanged(o)}}else this._collapsed=wijmo_1.asBoolean(e)}setTimeout((function(){t._updateCollapsedState()}))},enumerable:!0,configurable:!0});Object.defineProperty(ColumnGroup.prototype,"grid",{get:function(){return this._grid},enumerable:!0,configurable:!0});ColumnGroup.prototype._updateCollapsedState=function(){var e=this._grid.columns,t=this._rng,i=this._collapsed;this._cols.forEach((function(e){if(e instanceof ColumnGroup){e._collapsed=i;e._updateCollapsedState()}}));var o=t.rightCol;if(this.collapseTo)switch(this.collapseTo){case"$first":o=t.leftCol;break;case"$last":o=t.rightCol;break;default:var n=e.getColumn(this.collapseTo);n&&t.containsColumn(n.index)&&(o=n.index)}for(var r=t.leftCol;r<=t.rightCol;r++)e[r].visible=!i||r==o};ColumnGroup.prototype._getMaxLevel=function(){var e=this._lvl;this.columns.forEach((function(t){e=Math.max(e,t._getMaxLevel())}));return e};ColumnGroup.prototype._expandRange=function(e){var t=e-this._getMaxLevel();if(t>0){this._rng.row2+=t;this._cols.forEach((function(e){e._shiftRange(t)}))}for(var i=this._grid.columns,o=this._rng,n=o.col;n<=o.col2;n++){i[n]._rng.row2=e}};ColumnGroup.prototype._shiftRange=function(e){this._rng.row+=e;this._rng.row2+=e;this._cols.forEach((function(t){t._shiftRange(e)}))};return ColumnGroup}(Column);exports.ColumnGroup=ColumnGroup;!function(e){e[e.None=0]="None";e[e.Cell=1]="Cell";e[e.ColumnHeader=2]="ColumnHeader";e[e.RowHeader=3]="RowHeader";e[e.TopLeft=4]="TopLeft";e[e.ColumnFooter=5]="ColumnFooter";e[e.BottomLeft=6]="BottomLeft"}(CellType=exports.CellType||(exports.CellType={}));var AllowMerging,GridPanel=function(){function GridPanel(e,t,i,o,n){this._offsetY=0;this._rng=new CellRange;this._g=wijmo_1.asType(e,FlexGrid);this._ct=wijmo_1.asInt(t);this._rows=wijmo_1.asType(i,RowCollection);this._cols=wijmo_1.asType(o,ColumnCollection);this._e=wijmo_1.asType(n,HTMLElement);this._vrb=new CellRange}Object.defineProperty(GridPanel.prototype,"grid",{get:function(){return this._g},enumerable:!0,configurable:!0});Object.defineProperty(GridPanel.prototype,"cellType",{get:function(){return this._ct},enumerable:!0,configurable:!0});Object.defineProperty(GridPanel.prototype,"viewRange",{get:function(){return this._getViewRange()},enumerable:!0,configurable:!0});Object.defineProperty(GridPanel.prototype,"width",{get:function(){return this._cols.getTotalSize()},enumerable:!0,configurable:!0});Object.defineProperty(GridPanel.prototype,"height",{get:function(){return this._rows.getTotalSize()},enumerable:!0,configurable:!0});Object.defineProperty(GridPanel.prototype,"rows",{get:function(){return this._rows},enumerable:!0,configurable:!0});Object.defineProperty(GridPanel.prototype,"columns",{get:function(){return this._cols},enumerable:!0,configurable:!0});GridPanel.prototype.getCellData=function(e,t,i){var o,n=this._g,r=this._rows[wijmo_1.asNumber(e,!1,!0)],l=null;if(wijmo_1.isString(t)&&(t=this._cols.indexOf(t))<0)throw"Invalid column name or binding.";o=this._cols[wijmo_1.asNumber(t,!1,!0)];var s=n?n._getBindingColumn(this,e,o):o,a=null;r instanceof GroupRow&&r.dataItem instanceof wijmo_1.CollectionViewGroup&&!n.childItemsPath&&(a=r.dataItem);s.binding&&r.dataItem&&!a?l=s._binding.getValue(r.dataItem):r._ubv&&(l=r._ubv[o._hash]);if(null==l)switch(this._ct){case CellType.ColumnHeader:e!=this._rows.length-1&&s==o||(l=s.header);break;case CellType.ColumnFooter:if(s.aggregate!=wijmo_1.Aggregate.None&&r instanceof GroupRow){var c=this._g.collectionView;if(c){var d=wijmo_1.tryCast(c,wijmo_1.CollectionView);l=d?d.getAggregate(s.aggregate,s.binding):wijmo_1.getAggregate(s.aggregate,c.items,s.binding)}}break;case CellType.Cell:s.aggregate!=wijmo_1.Aggregate.None&&r instanceof GroupRow&&a&&(l=a.getAggregate(s.aggregate,s.binding,this._g.collectionView))}if(i){var u=s.dataMap||r.dataMap;this.cellType==CellType.Cell&&u&&(l=u.getDisplayValue(l));l=null!=l?wijmo_1.Globalize.format(l,s.format||r.format):""}return l};GridPanel.prototype.setCellData=function(e,t,i,o,n){void 0===o&&(o=!0);void 0===n&&(n=!0);var r,l=this._g,s=this._rows[wijmo_1.asNumber(e,!1,!0)],a=wijmo_1.DataType;if(wijmo_1.isString(t)&&(t=this._cols.indexOf(t))<0)throw"Invalid column name or binding.";r=this._cols[wijmo_1.asNumber(t,!1,!0)];var c=l?l._getBindingColumn(this,e,r):r;if(this._ct==CellType.Cell){var d=c.dataMap||s.dataMap,u=c.getIsRequired(s),h=c.isContentHtml||s.isContentHtml;if(d&&null!=i){var _=d.getKeyValue(i,h);if(null==_&&null==d.getDisplayValue(null)){if(d.getDisplayValue(i)!=i);else if(!d.isEditable||d.displayMemberPath!=d.selectedValuePath){if(""!=i||u)return!1;i=null}}else i=_}var g=a.Object,p=c.dataType||s.dataType;if(p)g=p;else{var f=this.getCellData(e,t,!1);g=wijmo_1.getType(f)}var w=""===i||null==i;if(!u&&w){g!=a.String&&(i=null);o=!1}else if(u&&w&&o)return!1;if(o){var m=c.format||s.format;m||g!=a.Date||(m="d");i=wijmo_1.changeType(i,g,m);if(g!=a.Object&&wijmo_1.getType(i)!=g)return!1}}if(s.dataItem&&c.binding){var C=c._binding,y=s.dataItem,v=C.getValue(y);if(i!==v&&!wijmo_1.DateTime.equals(i,v)){C.setValue(y,i);var b=l.collectionView;if(b instanceof wijmo_1.CollectionView&&y!=b.currentEditItem){var R=new wijmo_1.NotifyCollectionChangedEventArgs(wijmo_1.NotifyCollectionChangedAction.Change,y,b.items.indexOf(y));b.onCollectionChanged(R)}}}else{s._ubv||(s._ubv={});s._ubv[r._hash]=i}n&&l&&l.invalidate();return!0};GridPanel.prototype.getCellBoundingRect=function(e,t,i){var o=this._g,n=this.rows[e],r=this.columns[t],l=new wijmo_1.Rect(r.pos,n.pos,r.renderSize,n.renderSize);if(o.rightToLeft){l.left=this.hostElement.clientWidth-l.right;wijmo_1.isIE()||(l.left-=o._root.offsetWidth-o._root.clientWidth)}if(!i){var s=this.hostElement.getBoundingClientRect();l.left+=s.left;l.top+=s.top-this._offsetY}e<this.rows.frozen&&(l.top-=o.scrollPosition.y);t<this.columns.frozen&&(l.left-=o.scrollPosition.x*(o.rightToLeft?-1:1));return l};GridPanel.prototype.getCellElement=function(e,t){for(var i=this.hostElement.children,o=Math.min(e+2,i.length),n=0;n<o;n++)for(var r=i[n].children,l=Math.min(t+2,r.length),s=0;s<l;s++){var a=r[s],c=a[GridPanel._INDEX_KEY];if(c&&(c.row==e&&c.col==t||c.rng&&c.rng.contains(e,t)))return a}return null};GridPanel.prototype.getSelectedState=function(e,t,i){var o=this._g,n=o.selectionMode,r=o._selHdl.selection,l=SelectionMode,s=SelectedState;if(n==l.None)return s.None;switch(this._ct){case CellType.Cell:i||(i=o.getMergedRange(this,e,t));if(i){if(i.contains(r.row,r.col))return o.showMarquee?s.Active:s.Cursor;if(i.intersects(r))return s.Selected;for(var a=i.leftCol;a<=i.rightCol;a++)if(o.columns[a].isSelected)return s.Selected;for(var c=i.topRow;c<=i.bottomRow;c++)if(o.rows[c].isSelected)return s.Selected}if(r.row==e&&r.col==t)return o.showMarquee?s.Active:s.Cursor;if(o.rows[e].isSelected||o.columns[t].isSelected)return s.Selected;if(n==l.MultiRange)for(var d=o._selHdl.extendedSelection,u=0;u<d.length;u++)if(d[u].contains(e,t)||i&&i.intersects(d[u]))return s.Selected;if(i)switch(n){case l.Row:case l.RowRange:case l.ListBox:if(i.containsRow(r.row))return s.Selected}return n==l.ListBox?s.None:(r=this._getAdjustedSelection(r)).containsRow(e)&&r.containsColumn(t)?s.Selected:s.None;case CellType.ColumnHeader:if(o.showSelectedHeaders&HeadersVisibility.Column&&(o.columns[t].isSelected||r.containsColumn(t)||r.intersectsColumn(i))){i&&(e=i.bottomRow);if(e==this.rows.length-1)return s.Selected}break;case CellType.RowHeader:if(o.showSelectedHeaders&HeadersVisibility.Row&&(o.rows[e].isSelected||r.containsRow(e)||r.intersectsRow(i))){i&&(t=i.rightCol);if(t==this.columns.length-1)return s.Selected}}return s.None};Object.defineProperty(GridPanel.prototype,"hostElement",{get:function(){return this._e},enumerable:!0,configurable:!0});GridPanel.prototype._getAdjustedSelection=function(e){var t=this._g,i=this._rng,o=SelectionMode;switch(t.selectionMode){case o.Cell:i.setRange(e.row,e.col,e.row,e.col);break;case o.Row:i.setRange(e.row,0,e.row,t.columns.length-1);break;case o.RowRange:case o.ListBox:i.setRange(e.row,0,e.row2,t.columns.length-1);break;default:i.copy(e)}return i};GridPanel.prototype._getOffsetY=function(){return this._offsetY};GridPanel.prototype._updateContent=function(e,t,i){var o=this._g,n=this._e,r=this._rows,l=this._cols,s=this._ct;if(s==CellType.ColumnHeader||s==CellType.ColumnFooter||s==CellType.RowHeader){var a=o._ptScrl,c=n.style;s==CellType.RowHeader?c.top=a.y+"px":o.rightToLeft?c.right=a.x+"px":c.left=a.x+"px"}if(this._offsetY!=i){e=!1;this._offsetY=i}var d=this._getViewRange(),u=d;if(u.isValid){var h=r.length<=o._vtRows?r.length:0,_=l.length<=o._vtCols?l.length:0;u=new CellRange(Math.max(d.row-h,r.frozen),Math.max(d.col-_,l.frozen),Math.min(d.row2+h,r.length-1),Math.min(d.col2+_,l.length-1))}if(e&&!t&&this._vrb.contains(d)&&!r.frozen&&!l.frozen)return this._activeCell;e&&u.equals(this._vrb)||(t=!1);e&&!t&&this._ct!=CellType.TopLeft&&this._reorderCells(u,this._vrb);this._activeCell=null;this._vru=d;this._vrb=u;this._recycle=e;var g=0;this._ct==CellType.Cell&&(g=this._renderColHdrRow(u,t));for(var p=0;p<r.frozen&&p<r.length;p++)g=this._renderRow(p,u,t,g);for(p=u.topRow;p<=u.bottomRow&&p>-1;p++)g=this._renderRow(p,u,t,g);for(;n.childElementCount>g;){var f=n.lastElementChild;n.removeChild(f);this._removeExtraCells(f,0)}return this._activeCell};GridPanel.prototype._clearCells=function(){for(var e=this.hostElement,t=this._g.cellFactory,i=e.childElementCount-1;i>=0;i--){var o=e.children[i];e.removeChild(o);for(var n=o.childElementCount-1;n>=0;n--)t.disposeCell(o.children[n])}};GridPanel.prototype._reorderCells=function(e,t){if(this._g._reorderCells&&t.isValid&&e.isValid&&e.intersects(t)){if(e.row!=t.row){var i=this._e,o=e.row-t.row,n=Math.max(1,e.rowSpan-1);if(0!=o&&Math.abs(o)<n){var r=this._ct==CellType.Cell?1:0,l=i.childElementCount;r+=this.rows.frozen;if(o>0){var s=r,a=Math.min(r+o,l);(h=this._createRange(i,s,a))&&i.appendChild(h.extractContents())}if(o<0){a=l,s=Math.max(r,a+o);if((h=this._createRange(i,s,a))&&s>r){var c=i.children[r];i.insertBefore(h.extractContents(),c)}}}}if(e.col!=t.col){i=this._e,o=e.col-t.col,n=Math.max(1,e.columnSpan-1);if(0!=o&&Math.abs(o)<n){r=this._ct==CellType.Cell&&this._g.rowHeaderPath?1:0;r+=this.columns.frozen;for(var d=0;d<i.children.length;d++){var u=i.children[d];l=u.children.length;if(wijmo_1.hasClass(u,"wj-row")){if(o>0){s=r,a=Math.min(r+o,l);(h=this._createRange(u,s,a))&&u.appendChild(h.extractContents())}if(o<0){var h;a=l,s=Math.max(r,a+o);if((h=this._createRange(u,s,a))&&s>r){c=u.children[r];u.insertBefore(h.extractContents(),c)}}}}}}}};GridPanel.prototype._createRange=function(e,t,i){if(i>t&&i<=e.children.length&&t>-1){this._docRange||(this._docRange=document.createRange());var o=this._docRange;o.setStart(e,t);o.setEnd(e,i);return o}return null};GridPanel.prototype._renderColHdrRow=function(e,t){if(t)return 1;var i=this._e.children[0];i||(i=wijmo_1.createElement('<div class="wj-row" role="row"></div>',this._e));var o=this._g,n=o?o.columnHeaders.rows.ariaLabel:null;wijmo_1.setAttribute(i,"aria-label",n);wijmo_1.setAttribute(i,"aria-selected",null);var r=0,l=this._g._getRowHeaderPath();l&&(r=this._renderRowHdrCell(i,-1,l.path));for(var s=0;s<this.columns.frozen&&s<this.columns.length;s++)r=this._renderColHdrCell(i,s,e,t,r);for(s=e.leftCol;s<=e.rightCol&&s>-1;s++)r=this._renderColHdrCell(i,s,e,t,r);this._removeExtraCells(i,r);return 1};GridPanel.prototype._renderColHdrCell=function(e,t,i,o,n){var r=this.grid,l=this.columns[t];if(l.renderSize<=0)return n;if(o)return n+1;var s=e.children[n];s||(s=wijmo_1.createElement(GridPanel._HTML_CELL,e));wijmo_1.setAttribute(s,"role","columnheader");if(s&&this._recycle&&r._lazyRender){var a=s[GridPanel._INDEX_KEY];if(a&&-1==a.row&&a.col==t&&t>=this.columns.frozen)return n+1}s.textContent=this.columns[t].header;wijmo_1.setCss(s,{position:"fixed",left:l.pos,top:-32e3,width:l.renderSize,height:.1,overflow:"hidden",opacity:"0",pointerEvents:"none"});if(l.describedById||this.columns.describedById){var c=[l.describedById,this.columns.describedById].join(" ").trim();wijmo_1.setAttribute(s,"aria-describedby",c||null)}if(r.allowSorting){var d="none";switch(r._getBindingColumn(this,0,l).currentSort){case"+":d="ascending";break;case"-":d="descending"}wijmo_1.setAttribute(s,"aria-sort",d)}if(!r.isReadOnly){wijmo_1.setAttribute(s,"aria-readonly",l.isReadOnly);wijmo_1.setAttribute(s,"aria-required",l.getIsRequired())}s[GridPanel._INDEX_KEY]={row:-1,col:t,panel:this};return n+1};GridPanel.prototype._renderRowHdrCell=function(e,t,i){var o=e.children[0];o||(o=wijmo_1.createElement(GridPanel._HTML_CELL,e));o.setAttribute("role",t<0?"columnheader":"rowheader");o.textContent=i?i.toString():"";wijmo_1.setCss(o,{position:"fixed",left:-32e3,top:-32e3,width:.1,height:.1,overflow:"hidden",opacity:"0"});o[GridPanel._INDEX_KEY]={row:t,col:-1,panel:this};return 1};GridPanel.prototype._renderRow=function(e,t,i,o){var n=this._g,r=this.rows[e];if(r.renderSize<=0)return o;var l=this._e.children[o];l||(l=wijmo_1.createElement('<div class="wj-row"></div>',this._e));if(this._ct==CellType.Cell){l.setAttribute("role","row");var s=SelectionMode;switch(n.selectionMode){case s.Row:case s.RowRange:case s.ListBox:var a=r.isSelected||this._g._selHdl.selection.containsRow(e);wijmo_1.setAttribute(l,"aria-selected",!!a||null)}wijmo_1.setAttribute(l,"aria-level",r instanceof GroupRow?r.level+1:null);wijmo_1.setAttribute(l,"aria-expanded",r instanceof GroupRow?!r.isCollapsed:null);this.rows.ariaLabel&&wijmo_1.setAttribute(l,"aria-label",this.rows.ariaLabel)}var c=0;if(this._ct==CellType.Cell){var d=this._g._getRowHeaderPath();d&&(c=this._renderRowHdrCell(l,e,d.getValue(r.dataItem)))}for(var u=0;u<this.columns.frozen&&u<this.columns.length;u++)c=this._renderCell(l,e,u,t,i,c);for(u=t.leftCol;u<=t.rightCol&&u>-1;u++)c=this._renderCell(l,e,u,t,i,c);this._removeExtraCells(l,c);return o+1};GridPanel.prototype._renderCell=function(e,t,i,o,n,r){var l=this._g,s=l.getMergedRange(this,t,i);if(s){for(var a=Math.max(o.row,s.row);a<t;a++)if(this.rows[a].renderSize)return r;for(a=Math.max(o.col,s.col);a<i;a++)if(this.columns[a].renderSize)return r;var c=this.columns.frozen;if(c&&s.col<c&&s.col2>=c&&i>s.col)return r}var d=this.columns[i];if(d.renderSize<=0&&(!s||s.getRenderSize(this).width<=0))return r;var u=e.children[r];if(u&&!n&&this._recycle&&l._lazyRender&&!l.activeEditor){var h=u[GridPanel._INDEX_KEY];h&&h.row==t&&h.col==i&&h.rng==s&&t>=this.rows.frozen&&i>=this.columns.frozen&&(n=!0)}var _=SelectedState,g=this.getSelectedState(t,i,s),p=g==_.Cursor||g==_.Active;if(u&&n){wijmo_1.toggleClass(u,"wj-state-active",p);wijmo_1.toggleClass(u,"wj-state-selected",g==_.Cursor);wijmo_1.toggleClass(u,"wj-state-multi-selected",g==_.Selected);wijmo_1.setAttribute(u,"aria-selected",!(!p&&g==_.None)||null);p&&(this._activeCell=u);return r+1}u||(u=wijmo_1.createElement(GridPanel._HTML_CELL,e));p&&(this._activeCell=u);if(this._ct==CellType.Cell){wijmo_1.setAttribute(u,"role","gridcell");wijmo_1.setAttribute(u,"aria-selected",!(g==_.None&&!p)||null);wijmo_1.setAttribute(u,"aria-readonly",!l.canEditCell(t,i)||null);wijmo_1.setAttribute(u,"aria-required",d.getIsRequired())}l.cellFactory.updateCell(this,t,i,u,s);u[GridPanel._INDEX_KEY]={row:t,col:i,rng:s,panel:this};return r+1};GridPanel.prototype._removeExtraCells=function(e,t){for(var i=this._g.cellFactory;e.childElementCount>t;){var o=e.lastElementChild;e.removeChild(o);i.disposeCell(o)}};GridPanel.prototype._getViewRange=function(){var e=this._g,t=e._ptScrl,i=this._rows,o=this._cols,n=new CellRange(0,0,i.length-1,o.length-1);if(this._ct==CellType.Cell||this._ct==CellType.RowHeader){var r=-t.y+this._offsetY,l=e._szClient.height;if((d=Math.min(i.frozen,i.length-1))>0){r+=_=i[d-1].pos;l-=_}n.row=Math.min(i.length-1,Math.max(i.frozen,i.getItemAt(r+1)));n.row2=i.getItemAt(r+l);var s=e.hostElement;if(e._clipToScreen&&s){var a=s.getBoundingClientRect(),c=-a.top-e.cells._e.offsetTop;a.top<0&&(n.row=Math.max(n.row,i.getItemAt(c)-1));a.bottom>innerHeight&&(n.row2=Math.min(n.row2,i.getItemAt(c+innerHeight)+1))}}if(this._ct==CellType.Cell||this._ct==CellType.ColumnHeader){var d,u=-t.x,h=e._szClient.width;if((d=Math.min(o.frozen,o.length-1))>0){var _;u+=_=o[d-1].pos;h-=_}n.col=Math.min(o.length-1,Math.max(o.frozen,o.getItemAt(u+1)));n.col2=o.getItemAt(u+h)}i.length<=i.frozen&&(n.row=n.row2=-1);o.length<=o.frozen&&(n.col=n.col2=-1);return n};GridPanel.prototype._getFrozenPos=function(){var e=this._rows.frozen,t=this._cols.frozen,i=e>0?this._rows[e-1]:null,o=t>0?this._cols[t-1]:null,n=i?i.pos+i.renderSize:0,r=o?o.pos+o.renderSize:0;return new wijmo_1.Point(r,n)};GridPanel._INDEX_KEY="wj-cell-index";GridPanel._HTML_CELL='<div class="wj-cell" tabindex="-1"></div>';return GridPanel}();exports.GridPanel=GridPanel;!function(e){e[e.None=0]="None";e[e.Cells=1]="Cells";e[e.ColumnHeaders=2]="ColumnHeaders";e[e.RowHeaders=4]="RowHeaders";e[e.AllHeaders=6]="AllHeaders";e[e.All=7]="All"}(AllowMerging=exports.AllowMerging||(exports.AllowMerging={}));var MergeManager=function(){function MergeManager(e){this._g=e}MergeManager.prototype.getMergedRange=function(e,t,i,o){void 0===o&&(o=!0);var n=this._g,r=e.cellType,l=e.columns,s=e.rows,a=s[t],c=l[i];if(a instanceof _NewRowTemplate)return null;if(e==n.columnHeaders){var d=n._getColumnGroup(t,i);if(d){var u=d._rng,h=e.columns;if(h.isFrozen(u.col)!=h.isFrozen(u.col2)){u=u.clone();h.isFrozen(i)?u.col2=h.frozen-1:u.col=h.frozen}return u}}if(n.showGroups&&!n.childItemsPath&&a instanceof GroupRow&&a.dataItem instanceof wijmo_1.CollectionViewGroup&&r==CellType.Cell){u=new CellRange(t,i);if(c.aggregate==wijmo_1.Aggregate.None){for(;u.col>0&&l[u.col-1].aggregate==wijmo_1.Aggregate.None&&u.col!=l.frozen;)u.col--;for(;u.col2<l.length-1&&l[u.col2+1].aggregate==wijmo_1.Aggregate.None&&u.col2+1!=l.frozen;)u.col2++}for(;u.col<i&&!l[u.col].visible;)u.col++;return u.isSingleCell?null:u}var _=!1,g=AllowMerging,p=CellType;switch(n.allowMerging){case g.None:_=!0;break;case g.Cells:_=r!=p.Cell;break;case g.ColumnHeaders:_=r!=p.ColumnHeader&&r!=p.TopLeft;break;case g.RowHeaders:_=r!=p.RowHeader&&r!=p.TopLeft;break;case g.AllHeaders:_=r==p.Cell}if(_)return null;if(l[i].allowMerging){u=new CellRange(t,i);var f=e._vrb,w=0,m=s.length-1;if(t>=s.frozen){if(o&&(r==CellType.Cell||r==CellType.RowHeader)&&n._vtRows<s.length&&f){w=f.topRow;m=f.bottomRow}}else s.length>s.frozen&&(m=s.frozen-1);for(var C=t-1;C>=w&&this._mergeCell(e,C,i,t,i);C--)u.row=C;for(var y=t+1;y<=m&&this._mergeCell(e,t,i,y,i);y++)u.row2=y;for(;u.row<t&&!s[u.row].visible;)u.row++;if(!u.isSingleCell)return u}if(s[t].allowMerging){u=new CellRange(t,i),f=e._vrb;var v=0,b=l.length-1;if(i>=l.frozen){if(o&&(r==CellType.Cell||r==CellType.ColumnHeader)&&n._vtCols<l.length&&f){v=f.leftCol;b=f.rightCol}}else b=l.frozen-1;for(var R=i-1;R>=v&&this._mergeCell(e,t,R,t,i);R--)u.col=R;for(var j=i+1;j<=b&&this._mergeCell(e,t,i,t,j);j++)u.col2=j;for(;u.col<i&&!l[u.col].visible;)u.col++;if(!u.isSingleCell)return u}return null};MergeManager.prototype._mergeCell=function(e,t,i,o,n){var r=e.rows[t],l=e.rows[o];if(r instanceof GroupRow||r instanceof _NewRowTemplate||l instanceof GroupRow||l instanceof _NewRowTemplate)return!1;if(t!=o&&e.rows.isFrozen(t)!=e.rows.isFrozen(o))return!1;if(i!=n&&e.columns.isFrozen(i)!=e.columns.isFrozen(n))return!1;if(t!=o){if(i>0&&(r.allowMerging&&this._mergeCell(e,t,i-1,t,i)||l.allowMerging&&this._mergeCell(e,o,i-1,o,i)))return!1;if(n<e.columns.length-1&&(r.allowMerging&&this._mergeCell(e,t,n,t,n+1)||l.allowMerging&&this._mergeCell(e,o,n,o,n+1)))return!1}return e.getCellData(t,i,!0)==e.getCellData(o,n,!0)};return MergeManager}();exports.MergeManager=MergeManager;var HitTestInfo=function(){function HitTestInfo(e,t){this._row=-1;this._col=-1;this._edge=0;var i;if(t instanceof Element){if(wijmo_1.closest(t,".wj-flexgrid")!=e.hostElement)return;e=t;this._target=t}if(!(e instanceof Element)||e instanceof FlexGrid){if(e instanceof FlexGrid){this._target=e.hostElement;i=this._g=e}else{if(!(e instanceof GridPanel))throw"First parameter should be a FlexGrid or GridPanel.";this._target=e.hostElement;this._p=e;i=this._g=this._p.grid}if(t instanceof MouseEvent){this._target=t.target;"mousedown"==t.type&&(i._rcBounds=null)}t=wijmo_1.mouseToPage(t);this._pt=t.clone();var o=i.controlRect,n=i._szClient,r=i.topLeftCells,l=i._eTL,s=i.headersVisibility,a=HeadersVisibility,c=s&a.Row?r.columns.getTotalSize():0,d=s&a.Column?r.rows.getTotalSize():0,u=s&a.Column?d+l.offsetTop:0,h=i._eBL,_=h.offsetHeight;t.x-=o.left;t.y-=o.top;i.rightToLeft&&(t.x=o.width-t.x);this._p||t.x>=0&&t.y>=l.offsetTop&&n&&t.x<=n.width+c&&t.y<=n.height+d&&(t.y<u?this._p=t.x<c?i.topLeftCells:i.columnHeaders:t.y<h.offsetTop?this._p=t.x<c?i.rowHeaders:i.cells:this._p=t.x<c?i.bottomLeftCells:i.columnFooters);if(null!=this._p){var g=this._p.rows,p=this._p.columns,f=this._p.cellType,w=CellType,m=this._p._getFrozenPos(),C=f==w.TopLeft||f==w.ColumnHeader?d:f==w.BottomLeft||f==w.ColumnFooter?_:g.getTotalSize(),y=f==w.TopLeft||f==w.BottomLeft||f==w.RowHeader?c:p.getTotalSize();if(f==w.RowHeader||f==w.Cell){t.y-=d;if(t.y>m.y||m.y<=0){t.y-=i._ptScrl.y;t.y+=this._p._getOffsetY()}}else f!=w.BottomLeft&&f!=w.ColumnFooter||(t.y-=h.offsetTop);if(f==w.ColumnHeader||f==w.Cell||f==w.ColumnFooter){t.x-=c;(t.x>m.x||m.x<=0)&&(t.x-=i._ptScrl.x)}f!=w.ColumnHeader&&f!=w.TopLeft||(t.y-=u-d);this._edge=0;var v=HitTestInfo._SZEDGE[this._g.isTouching?1:0];if(this._g.isTouching){v=HitTestInfo._SZEDGE[1];t.x-=v/2}this._row=t.y>C?-1:g.getItemAt(t.y);this._col=t.x>y?-1:p.getItemAt(t.x);if(this._row<0||this._col<0){this._p=null;return}if(this._col>-1){var b=p[this._col];t.x-b.pos<=v&&(this._edge|=1);var R=b.pos+b.renderSize-t.x;if(R<=v){this._edge|=4;R<=v/2&&(this._edge|=16)}}if(this._row>-1){var j=g[this._row];t.y-j.pos<=v&&(this._edge|=2);var x=j.pos+j.renderSize-t.y;if(x<=v){this._edge|=8;x<=v/2&&(this._edge|=32)}}}}else{var E=wijmo_1.closest(e,".wj-cell"),S=E?E[GridPanel._INDEX_KEY]:null;if(S){this._target=e;this._row=S.row;this._col=S.col;this._rng=S.rng;this._p=S.panel;this._g=S.panel.grid}}}Object.defineProperty(HitTestInfo.prototype,"point",{get:function(){return this._pt},enumerable:!0,configurable:!0});Object.defineProperty(HitTestInfo.prototype,"cellType",{get:function(){return this._p?this._p.cellType:CellType.None},enumerable:!0,configurable:!0});Object.defineProperty(HitTestInfo.prototype,"panel",{get:function(){return this._p},enumerable:!0,configurable:!0});Object.defineProperty(HitTestInfo.prototype,"grid",{get:function(){return this._p?this._p.grid:null},enumerable:!0,configurable:!0});Object.defineProperty(HitTestInfo.prototype,"row",{get:function(){return this._row},enumerable:!0,configurable:!0});HitTestInfo.prototype.getRow=function(){return this._p&&this._row>-1?this._p.rows[this._row]:null};Object.defineProperty(HitTestInfo.prototype,"col",{get:function(){return this._col},enumerable:!0,configurable:!0});HitTestInfo.prototype.getColumn=function(){return this._p&&this._col>-1?this._p.columns[this._col]:null};Object.defineProperty(HitTestInfo.prototype,"range",{get:function(){this._rng||(this._rng=new CellRange(this._row,this._col));return this._rng},enumerable:!0,configurable:!0});Object.defineProperty(HitTestInfo.prototype,"edgeLeft",{get:function(){return 0!=(1&this._edge)},enumerable:!0,configurable:!0});Object.defineProperty(HitTestInfo.prototype,"edgeTop",{get:function(){return 0!=(2&this._edge)},enumerable:!0,configurable:!0});Object.defineProperty(HitTestInfo.prototype,"edgeRight",{get:function(){return 0!=(4&this._edge)},enumerable:!0,configurable:!0});Object.defineProperty(HitTestInfo.prototype,"edgeFarRight",{get:function(){return 0!=(16&this._edge)},enumerable:!0,configurable:!0});Object.defineProperty(HitTestInfo.prototype,"edgeBottom",{get:function(){return 0!=(8&this._edge)},enumerable:!0,configurable:!0});Object.defineProperty(HitTestInfo.prototype,"edgeFarBottom",{get:function(){return 0!=(32&this._edge)},enumerable:!0,configurable:!0});Object.defineProperty(HitTestInfo.prototype,"target",{get:function(){return this._target},enumerable:!0,configurable:!0});HitTestInfo._SZEDGE=[6,30];return HitTestInfo}();exports.HitTestInfo=HitTestInfo;function softInput(){return wijmo_1._getModule("wijmo.input")}exports.softInput=softInput;var CellFactory=function(){function CellFactory(){}CellFactory.prototype.updateCell=function(e,t,i,o,n,r){var l=e.grid,s=l.rightToLeft,a=e.rows,c=e.columns,d=a[t],u=c[i],h=t,_=i,g=d instanceof GroupRow?d:null,p=d instanceof _NewRowTemplate?d:null,f=u.renderWidth,w=d.renderHeight,m=e.cellType,C="wj-cell",y="",v={display:""},b=CellType;0!=r&&o.firstElementChild&&(1==o.childNodes.length&&"checkbox"==o.firstElementChild.type||(o.textContent=""));if(n&&!n.isSingleCell){t=n.row;i=n.col;h=n.row2;_=n.col2;d=a[t];u=c[i];g=d instanceof GroupRow?d:null;var R=n.getRenderSize(e);w=R.height;f=R.width}var j=l._getBindingColumn(e,t,u),x=j.dataType||d.dataType,E=j.dataMap||d.dataMap,S=E&&m==b.Cell?l._getMapEditor(d,j):null,H=m==b.Cell&&(!g||l.childItemsPath),M=H&&S==DataMapEditor.RadioButtons,F=x==wijmo_1.DataType.Boolean&&!E,z=u.pos,P=d.pos;if(l._useFrozenDiv()&&m==b.Cell&&!l.editRange){i<c.frozen&&h>=a.frozen&&(P+=l._ptScrl.y);t<a.frozen&&_>=c.frozen&&(z+=l._ptScrl.x)}else{h<a.frozen&&(P-=l._ptScrl.y);_<c.frozen&&(z-=l._ptScrl.x)}s?v.right=z+"px":v.left=z+"px";h>=a.frozen&&(P-=e._getOffsetY());v.top=P+"px";v.width=f+"px";v.height=w+"px";v.zIndex="";(t<a.frozen||i<c.frozen)&&(v.zIndex=t<a.frozen&&i<c.frozen?2:1);var T=!1,G=l.alternatingRowStep;if(G&&(!n||n.row==n.row2)){T=d.visibleIndex%(G+1)==0;1==G&&(T=!T)}if(m==b.Cell){g&&(C+=" wj-group");T&&(C+=" wj-alt");(t<a.frozen||i<c.frozen)&&(C+=" wj-frozen");p&&(C+=" wj-new");d.cssClass&&(C+=" "+d.cssClass);j.cssClass&&(C+=" "+j.cssClass)}else{C+=" wj-header";T&&(C+=" wj-header-alt");var A=!1;m!=b.ColumnHeader&&m!=b.TopLeft||l.allowResizing&AllowResizing.Columns&&(A=null!=l._mouseHdl._getResizeCol(e,_));A||m!=b.RowHeader||l.allowResizing&AllowResizing.Rows&&(A=null!=l._mouseHdl._getResizeRow(e,h));A&&(C+=" wj-big-header")}d.cssClassAll&&(C+=" "+d.cssClassAll);j.cssClassAll&&(C+=" "+j.cssClassAll);var I=SelectedState,L=e.getSelectedState(t,i,n);L!=I.None&&m==b.Cell&&!F&&l.editRange&&l.editRange.contains(t,i)&&(L=I.None);switch(L){case I.Active:C+=" wj-state-active";break;case I.Cursor:C+=" wj-state-selected wj-state-active";break;case I.Selected:C+=" wj-state-multi-selected"}h==a._lastFrozen&&(C+=" wj-frozen-row");_==c._lastFrozen&&(C+=" wj-frozen-col");(j.wordWrap||d.wordWrap)&&(C+=" wj-wrap");(j.multiLine||d.multiLine)&&(C+=" wj-multiline");var D=j.getAlignment(d);D&&(y=" wj-align-"+D);var O=m==b.ColumnHeader&&l._hasColumnGroups()?l._getColumnGroup(t,i):null;O&&O.align&&(y=" wj-align-"+O.align);v.paddingLeft=v.paddingRight=v.paddingTop=v.paddingBottom="";if(m==b.Cell&&l.rows.maxGroupLevel>-1&&i==c.firstVisibleIndex&&l.treeIndent){var N=g?Math.max(0,g.level):a.maxGroupLevel+1,B=Math.min(l.treeIndent*N+l._cellPadLeft,f-l._cellPadHorz)+"px";s?v.paddingRight=B:v.paddingLeft=B}f<=l._cellPadHorz&&(v.paddingLeft=v.paddingRight=0);if(0!=r){var k=e.getCellData(t,i,!1),V=e.getCellData(t,i,!0);if(m==b.Cell&&i==c.firstVisibleIndex&&g&&g.hasChildren&&!this._isEditingCell(l,t,i)){var K=this._getTreeBtn(g);V=wijmo_1.escapeHtml(V)||g.getGroupHeader();o.innerHTML=K.outerHTML+" "+V;y=""}else if(m!=b.ColumnHeader||h!=l._getSortRowIndex()&&j==u)if(m!=b.RowHeader||i!=l._getEditColumnIndex()||V)if(m!=b.Cell||x!=wijmo_1.DataType.Boolean||E||g&&!wijmo_1.isBoolean(k))if(m==b.Cell&&!M&&this._isEditingCell(l,t,i)){var W=j.inputType||d.inputType;W||(W=x!=wijmo_1.DataType.Number||E?"text":"tel");if(!E&&!j.mask&&!d.mask){var q=e.getCellData(t,i,!1);if(wijmo_1.isNumber(q)){var U=j.format||d.format,J=q.toString();if(U&&q!=Math.round(q)){var Y=J.indexOf("e")<0?J.match(/\.(\d+)/)[1].length:20;U=U.replace(/([a-z])(\d*)(.*)/gi,"$01"+Y+"$3")}V=wijmo_1.Globalize.formatNumber(q,U,!0)}}o.innerHTML=(j.multiLine||d.multiLine)&&"checkbox"!=W?'<textarea wrap="soft"></textarea>':'<input type="'+W+'"/>';var X=o.children[0];wijmo_1.addClass(X,"wj-grid-editor wj-form-control");wijmo_1.disableAutoComplete(X);X.value=j.isContentHtml||d.isContentHtml?wijmo_1.toPlainText(V):V;X.tabIndex=-1;X.required=j.getIsRequired(d);wijmo_1.setAttribute(X,"aria-required",X.required);var Z=j.maxLength||d.maxLength;Z&&(X.maxLength=Z);X.style.textAlign=j.getAlignment(d);var Q=j.mask||d.mask;Q&&new wijmo_1._MaskProvider(X,Q);l._edtHdl._edt=X}else{if(M){var $=[],ee=e.getCellData(t,i,!1);E.getDisplayValues(d.dataItem).forEach((function(e){var t=E.getKeyValue(e)==ee?" checked":"",i=l.isReadOnly||d.isReadOnly||u.isReadOnly?" disabled":"";$.push('<label><input type="radio" tabindex="-1"'+t+i+"><span>"+wijmo_1.escapeHtml(e)+"</span></label>")}));o.innerHTML=$.join(" ");C+=" "+CellFactory._WJC_RADIOMAP}var te=H?j._tpl:null;if(te){var ie=CellFactory._tplCtx;ie.value=k;ie.text=V;ie.item=d.dataItem;ie.row=d;ie.col=j;var oe=wijmo_1.isString(te)?wijmo_1.evalTemplate(te,ie):te(ie,o);null==oe||M||(o.innerHTML=oe)}else M||(m==b.Cell&&(d.isContentHtml||j.isContentHtml)?o.innerHTML=V:o.textContent=V||"");if(O&&O.collapseTo){var ne=O._rng;if(ne&&ne.columnSpan>1){var re=O.isCollapsed;o.innerHTML='<div role="button" class="'+CellFactory._WJC_COLLAPSE+'"><span class="wj-glyph-'+(re?"plus":"minus")+'"></span></div>&nbsp;'+o.innerHTML;re&&wijmo_1.addClass(o,"wj-state-collapsed")}}}else{var le=o.firstChild;if(!l._isNativeCheckbox(le)){o.innerHTML='<label><input type="checkbox" class="'+CellFactory._WJC_CHECKBOX+'" tabindex="-1"/><span></span></label>';le=o.querySelector("input")}le.checked=1==k;le.indeterminate=null==k;le.disabled=!l.canEditCell(t,i);le.disabled&&(le.style.cursor="default");l.editRange&&l.editRange.contains(t,i)&&(l._edtHdl._edt=le)}else{var se=l.editableCollectionView,ae=se?se.currentEditItem:null;ae&&d.dataItem==ae?o.innerHTML='<span class="wj-glyph-pencil"></span>':d instanceof _NewRowTemplate&&(o.innerHTML='<span class="wj-glyph-asterisk"></span>')}else{o.innerHTML=wijmo_1.escapeHtml(V);var ce=j.currentSort;if(ce&&l.showSort){C+=" wj-sort-"+("+"==ce?"asc":"desc");o.innerHTML+="&nbsp;"+this._getSortIcon(j)}l.allowPinning&&wijmo_1.contains(l.hostElement,o)&&this._addPinButton(o,i<l.frozenColumns)}if(S==DataMapEditor.DropDownList&&l.showDropDown&&l.canEditCell(t,i)&&softInput()){var de=this._getDropDownBtn();o.insertBefore(de,o.firstChild);this._isEditingCell(l,t,i)&&(C+=" wj-hasdropdown")}}if(m==b.RowHeader||m==b.ColumnHeader){var ue=m==b.RowHeader?!g&&!p&&d.allowDragging&&0!=(l.allowDragging&AllowDragging.Rows):u.allowDragging&&0!=(l.allowDragging&AllowDragging.Columns);wijmo_1.setAttribute(o,"draggable",ue?"true":null)}C+=y;o.className!=C&&(o.className=C);var he=o.style;for(var _e in v)he[_e]!==v[_e]&&(he[_e]=v[_e]);if(l._edtHdl._edt&&l._edtHdl._edt.parentElement==o){var ge=l._root,pe=ge.getBoundingClientRect(),fe=o.getBoundingClientRect(),we=pe.top+ge.clientHeight-fe.top,me=pe.left+ge.clientWidth-fe.left;fe.height>we&&(o.style.height=we+"px");fe.width>me&&(o.style.width=me+"px")}if((m==b.Cell||m==b.RowHeader)&&l._getShowErrors()){var Ce=l._getError(e,t,i);l._edtHdl._setCellError(o,Ce)}l.itemFormatter&&l.itemFormatter(e,t,i,o);if(l.formatItem.hasHandlers){var ye=CellFactory._fmtRng;ye?ye.setRange(t,i,h,_):ye=CellFactory._fmtRng=new CellRange(t,i,h,_);var ve=new FormatItemEventArgs(e,ye,o);l.onFormatItem(ve)}};CellFactory.prototype.disposeCell=function(e){};CellFactory.prototype.getEditorValue=function(e){var t=e._edtHdl._edt;if(t instanceof HTMLInputElement&&"checkbox"==t.type)return t.checked;if(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement){var i=t.value,o=t.maxLength;wijmo_1.isNumber(o)&&o>-1&&i.length>o&&(i=i.substr(0,o));return i}return null};CellFactory.prototype._isEditingCell=function(e,t,i){return e.editRange&&e.editRange.contains(t,i)};CellFactory.prototype._getDropDownBtn=function(){var e=CellFactory._ddBtn;if(!e){e=CellFactory._ddBtn=wijmo_1.createElement('<button class="wj-btn wj-btn-glyph wj-right '+CellFactory._WJC_DROPDOWN+'" type="button" tabindex="-1"><span class="wj-glyph-down"></span></button>');wijmo_1.setAriaLabel(e,wijmo_1.culture.FlexGrid.ariaLabels.toggleDropDown);wijmo_1.setAttribute(e,"aria-expanded",!1)}return e.cloneNode(!0)};CellFactory.prototype._getTreeBtn=function(e){var t=CellFactory._WJC_COLLAPSE,i=(e.isCollapsed?"":"down-")+(e.grid.rightToLeft?"left":"right"),o=wijmo_1.createElement('<button class="wj-btn wj-btn-glyph '+t+'" type="button" tabindex="-1"><span class="wj-glyph-'+i+'"></span></button>');wijmo_1.setAriaLabel(o,wijmo_1.culture.FlexGrid.ariaLabels.toggleGroup);wijmo_1.setAttribute(o,"aria-expanded",!e.isCollapsed);return o};CellFactory.prototype._getSortIcon=function(e){var t='<span class="wj-glyph-'+("+"==e.currentSort?"up":"down")+'"></span>',i=e.grid.collectionView;if(i&&i.sortDescriptions.length>1){var o=e.currentSortIndex;o>-1&&(t+='<span class="wj-sort-index">'+(o+1)+"</span>")}return t};CellFactory.prototype._addPinButton=function(e,t){var i=CellFactory._WJC_PIN,o=wijmo_1.createElement('<button class="wj-btn wj-btn-glyph wj-right '+i+'" type="button" tabindex="-1"><span class="wj-glyph-pin"></span></button>');wijmo_1.toggleClass(o,"wj-state-pinned",t);wijmo_1.setAttribute(o,"aria-pressed",t);e.insertBefore(o,e.firstChild)};CellFactory._WJC_RADIOMAP="wj-radio-map";CellFactory._WJC_CHECKBOX="wj-cell-check";CellFactory._WJC_COLLAPSE="wj-elem-collapse";CellFactory._WJC_DROPDOWN="wj-elem-dropdown";CellFactory._WJC_PIN="wj-elem-pin";CellFactory._tplCtx={row:null,col:null,value:null,text:null,item:null};return CellFactory}();exports.CellFactory=CellFactory;var KeyAction,_LB_PAGE_SIZE=4,_EditHandler=function(){function _EditHandler(e){var t=this;this._fullEdit=!1;this._list=null;this._g=e;this._evtInput=document.createEvent("HTMLEvents");this._evtInput.initEvent("input",!0,!1);this._evtChange=document.createEvent("HTMLEvents");this._evtChange.initEvent("change",!0,!1);e.selectionChanging.addHandler((function(i,o){if(t.finishEditing()){var n=e._selHdl.selection.row;if(n!=o.row){var r=e.rows.length;(n>-1&&n<r?e.rows[n].dataItem:null)!=(o.row>-1&&o.row<r?e.rows[o.row].dataItem:null)&&t._commitRowEdits()}}else o.cancel=!0}));e.lostFocus.addHandler((function(){var e=wijmo_1.getActiveElement();e&&"fixed"==getComputedStyle(e).position?t.finishEditing():t._commitRowEdits()}));var i=e.hostElement;e.addEventListener(i,"mousedown",(function(i){if(!i.defaultPrevented&&0==i.button&&!e._mouseHdl._szRowCol){var o=e.hitTest(i);o.cellType!=CellType.Cell&&o.cellType!=CellType.None&&(t.finishEditing()||t.finishEditing(!0))}}),!0);e.addEventListener(i,"compositionend",this._keypress.bind(this))}_EditHandler.prototype.startEditing=function(e,t,i,o,n){void 0===e&&(e=!0);var r=this._g,l=r._selHdl.selection;t=wijmo_1.asNumber(t,!0,!0);i=wijmo_1.asNumber(i,!0,!0);null==t&&(t=l.row);null==i&&(i=l.col);null==o&&(o=!0);if(!this._allowEdit(t,i))return!1;var s=r.getMergedRange(r.cells,t,i,!1);s||(s=new CellRange(t,i));var a=r.rows[t].dataItem;r.scrollIntoView(s.row,s.col,!0);if(!r.select(s,!0))return!1;if(!r.rows[t]||a!=r.rows[t].dataItem)return!1;if(s.equals(this._rng))return!0;if(this.activeEditor&&!this.finishEditing())return!1;var c=new CellRangeEventArgs(r.cells,s,n);if(!r.onBeginningEdit(c))return!1;var d=r.editableCollectionView,u=!1;if(d){(u=(a=r.rows[t].dataItem)!=d.currentEditItem)&&r.onRowEditStarting(c);d.editItem(a);if(u){r.onRowEditStarted(c);this._edItem=a}}var h=r.rows[t],_=r._getBindingColumn(r.cells,t,r.columns[i]),g=_.dataMap||h.dataMap,p=DataMapEditor.RadioButtons,f=h.dataMap&&h.dataMapEditor==p||_.dataMap&&_.dataMapEditor==p;this._fullEdit=wijmo_1.asBoolean(e);this._rng=s;this._list=null;if(g&&!f){var w=g.getDisplayValues(a);(_.isContentHtml||h.isContentHtml)&&(w=w.map((function(e){return wijmo_1.toPlainText(e)})));this._list=w}if(f){var m=r._activeCell||r.hostElement.querySelector(".wj-cell.wj-state-active");if(m){this._edt=m.querySelector("input");this._updateRowHeaderCell(t)}}else s.isSingleCell?this._updateEditorCell(t,i,u):r.refresh(!1);var C=this._edt;if(C){if("checkbox"==C.type||"radio"==C.type)this._fullEdit=!1;else if(o){var y=0,v=C.value.length,b=!1,R=wijmo_1.culture.Globalize.numberFormat["%"]||"%",j=r.getCellData(t,i,!1);wijmo_1.isNumber(j)?b=C.value.indexOf(R)>-1:null==j&&(b=/^p/i.test(_.format))&&C.value.indexOf(R)<0&&(C.value+=R);if(b){var x=C.value;y=0;v=x.length;for(;v>0&&(x[v-1]==R||" "==x[v-1]);)v--;for(;y<v&&x[y]==R;)y++}n&&"keydown"==n.type&&n.keyCode==wijmo_1.Key.Space&&(y=v);wijmo_1.setSelectionRange(C,y,v);wijmo_1.isIE()&&"right"==C.style.textAlign&&(C.style.paddingRight="1px")}r.onPrepareCellForEdit(c)}return null!=C&&!C.disabled&&!C.readOnly};_EditHandler.prototype.finishEditing=function(e){var t=this._edt;if(!t){this._removeListBox();return!0}var i=this._g,o=this._rng,n=new CellEditEndingEventArgs(i.cells,o),r=i.containsFocus(),l=i.hostElement.querySelector(".wj-control.wj-state-focused");if(l){var s=wijmo_1.Control.getControl(l);s&&s.onLostFocus(n)}n.cancel=e;if(!e&&i.validateEdits){if(h=this._getValidationError()){n.cancel=!0;var a=wijmo_1.closest(t,".wj-cell");if(a){this._setCellError(a,h);n.stayInEditMode=!0}}}if(!i.onCellEditEnding(n)&&n.stayInEditMode){r?setTimeout((function(){t.select()})):t.select();this._fullEdit=!0;return!1}if(!n.cancel){n.data=i.cells.getCellData(o.topRow,o.leftCol,!1);for(var c=i.cellFactory.getEditorValue(i),d=o.topRow;d<=o.bottomRow&&d<i.rows.length;d++)for(var u=o.leftCol;u<=o.rightCol&&u<i.columns.length;u++){if(!i.cells.setCellData(d,u,c,!0,!1)&&i.validateEdits){var h;if(h=this._getValidationError(!0)){n.cancel=!0;var _=wijmo_1.closest(t,".wj-cell");if(_){this._setCellError(_,h);n.stayInEditMode=!0}return!1}}}t.value==this._edtValue&&t.dispatchEvent(this._evtChange)}this._edt=null;this._rng=null;this._list=null;this._edtValue=null;this._removeListBox();var g=wijmo_1.closest(t,".wj-cell");wijmo_1.contains(g,wijmo_1.getActiveElement())&&i._setFocusNoScroll(g);!n.cancel&&n.refresh&&i._refreshOnEdit?i.refresh(!1):this._updateEditorCell(o.row,o.col,!1);r&&i.focus();i.onCellEditEnded(n);return!0};_EditHandler.prototype._setCellError=function(e,t){""==t&&(t=null);wijmo_1.toggleClass(e,"wj-state-invalid",null!=t);var i=this._g.errorTip;i?i.setTooltip(e,t):wijmo_1.setAttribute(e,"title",t)};Object.defineProperty(_EditHandler.prototype,"activeEditor",{get:function(){return this._edt},enumerable:!0,configurable:!0});Object.defineProperty(_EditHandler.prototype,"editRange",{get:function(){return this._rng},enumerable:!0,configurable:!0});_EditHandler.prototype.getClipString=function(e,t,i,o){var n,r=this,l=this._g,s=l.selectionMode,a=[],c=0!=(t&ClipStringOptions.CSV),d=c?"\r\n":"\n",u=c?",":"\t",h=0!=(t&ClipStringOptions.InvisibleRows),_=SelectionMode;if(!e&&s!=_.ListBox)for(var g=l.rows,p=0;p<g.length;p++)if(g[p].isSelected){s=_.ListBox;break}if(!e){l._selHdl._expandSelection();e=l.selection;switch(s){case _.Row:case _.RowRange:case _.ListBox:e.col=0;e.col2=l.columns.length-1;break;case _.MultiRange:var f=l.selectedRanges;if(f.length>1){var w=this._sameCols(f),m=this._sameRows(f);if(w||m){(f=f.slice()).sort((function(e,t){var i=e.topRow-t.topRow;return i||e.leftCol-t.leftCol}));for(var C=0;C<f.length;C++)for(var y=f[C],v=C+1;v<f.length;v++)if(y.contains(f[v])){f.splice(v,1);v--}if(w){var b=[];f.forEach((function(e){b.push(r.getClipString(e,t,i,o));i=!1}));return b.join(d)}if(m){var R;f.forEach((function(e){var n=r.getClipString(e,t,i,o).split(d);if(null==R){R=n;o=!1}else n.forEach((function(e,t){R[t]+=u+e}))}));return R.join(d)}}}}}i&&(n=l.columnHeaders).rows.forEach((function(i,l){if(h||i.isVisible){var s=r._getRowClipString(n,l,e,t,o);a.push(s)}}));n=l.cells;if(s==_.ListBox)n.rows.forEach((function(i,l){if(i.isSelected&&(h||i.isVisible)){var s=r._getRowClipString(n,l,e,t,o);a.push(s)}}));else for(C=e.topRow;C<=e.bottomRow;C++)if(h||n.rows[C].isVisible){var j=this._getRowClipString(n,C,e,t,o);a.push(j)}return a.join(d)};_EditHandler.prototype._getRowClipString=function(e,t,i,o,n){var r=[],l=e.rows[t],s=ClipStringOptions,a=0!=(o&s.CSV),c=0!=(o&s.InvisibleColumns),d=0==(o&s.Unformatted),u=0!=(o&s.SkipMerged);if(l.isVisible){if(n)for(var h=e.cellType==CellType.ColumnHeader?e.grid.topLeftCells:e.grid.rowHeaders,_=0;_<h.columns.length;_++)if(c||h.columns[_].isVisible){var g=h.getCellData(t,_,!0);u&&this._skipMergedCell(e,i,t,_)&&(g="");r.push(this._getCellClipString(g,o))}for(_=i.leftCol;_<=i.rightCol;_++)if(c||e.columns[_].isVisible){!(g=e.getCellData(t,_,d))&&l instanceof GroupRow&&_==e.columns.firstVisibleIndex&&(g=wijmo_1.toPlainText(l.getGroupHeader()));u&&this._skipMergedCell(e,i,t,_)&&(g="");r.push(this._getCellClipString(g,o))}}return r.join(a?",":"\t")};_EditHandler.prototype._skipMergedCell=function(e,t,i,o){var n=e.grid.getMergedRange(e,i,o,!1);if(n){if(t){n.row=Math.max(t.topRow,n.row);n.col=Math.max(t.leftCol,n.col)}if(n.row!=i||n.col!=o)return!0}return!1};_EditHandler.prototype._getCellClipString=function(e,t){wijmo_1.isString(e)||(e=wijmo_1.isDate(e)?e.toJSON():null!=e?e.toString():"");e=e.replace(/\t/g," ");var i=0!=(t&ClipStringOptions.QuoteAll);(i=i||/\n|^"|"$/.test(e))||0==(t&ClipStringOptions.CSV)||(i=e.indexOf(",")>-1);i&&(e='"'+(e=e.replace(/"/g,'""'))+'"');return e};_EditHandler.prototype._sameRows=function(e){for(var t=e[0],i=1;i<e.length;i++)if(e[i].topRow!=t.topRow||e[i].bottomRow!=t.bottomRow)return!1;return!0};_EditHandler.prototype._sameCols=function(e){for(var t=e[0],i=1;i<e.length;i++)if(e[i].leftCol!=t.leftCol||e[i].rightCol!=t.rightCol)return!1;return!0};_EditHandler.prototype.setClipString=function(e,t){var i=this,o=this._g,n=o.editableCollectionView,r=null==t,l=SelectionMode;if(r){o._selHdl._expandSelection();t=o.selection;switch(o.selectionMode){case l.Row:case l.RowRange:case l.ListBox:t.col=0;t.col2=o.columns.length-1;break;case l.MultiRange:var s=o.selectedRanges;if(s.length>1){n&&n.beginUpdate();s.forEach((function(t){o.setClipString(e,t)}));n&&n.endUpdate();o.selectedRanges=s;return}}}t=wijmo_1.asType(t,CellRange);var a=this._parseClipString(wijmo_1.asString(e));!r&&a.length>t.rowSpan&&(a=a.slice(0,t.rowSpan));this._expandClipRows(a,t);var c=r?new CellRange(t.topRow,t.leftCol,t.topRow+a.length-1,t.leftCol+a[0].length-1):t,d=new CellRangeEventArgs(o.cells,c,e);if(!o.onPasting(d))return!1;c=new CellRange(t.topRow,t.leftCol);var u=!1,h=t.topRow,_=o.newRowAtTop&&0==h,g=o.rows,p=o.columns;o.deferUpdate((function(){for(var e=0;e<a.length&&h<g.length;e++,h++){var r=g[h];if(r.isVisible){for(var l=a[e],s=t.leftCol,f=0;f<l.length&&s<p.length;f++,s++){var w=p[s];if(w.isVisible){if(i._allowEdit(h,s)){var m=l[f],C=m.length;C>1&&'"'==m[0]&&'"'==m[C-1]&&m.indexOf("\n")>-1&&(m=m.substr(1,C-2));var y=w.maxLength||r.maxLength;y&&(m=m.substr(0,y));var v=new CellRangeEventArgs(o.cells,new CellRange(h,s),m);if(o.onPastingCell(v)){if(n){n.editItem(g[h].dataItem);i._edItem=n.currentEditItem}if(o.setCellData(h,s,v.data)){o.onPastedCell(v);u=!0}}c.row2=Math.max(c.row2,h);c.col2=Math.max(c.col2,s)}}else f--}if(i._edItem&&n instanceof wijmo_1.CollectionView){var b=new wijmo_1.NotifyCollectionChangedEventArgs(wijmo_1.NotifyCollectionChangedAction.Change,i._edItem,h);n.onCollectionChanged(b)}if(_)break}else e--}n&&a.length>1&&c.rowSpan>1&&n.commitEdit();o.select(c);o.onPasted(d);if(u&&wijmo_1.closest(o.hostElement,"form")){var R=document.createEvent("HTMLEvents"),j=wijmo_1.createElement("<input>",o.hostElement);R.initEvent("change",!0,!1);j.dispatchEvent(R);wijmo_1.removeChild(j)}}))};_EditHandler.prototype._parseClipString=function(e){e=(e=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n")).replace(/\n$/,"");var t=0,i=0,o=[];for(t=0;t<e.length;t++){var n='"'==e[t],r=!1,l=!1;for(i=t;i<e.length&&!l;i++){var s=e[i];switch(s){case'"':n&&(r=!r);break;case"\t":case"\n":if(!r){this._parseClipCell(o,e,t,i,"\n"==s);t=i;i==e.length-1&&(t=i+1);l=!0}}}if(i==e.length){this._parseClipCell(o,e,t,i,!1);break}}0==o.length&&o.push([""]);return o};_EditHandler.prototype._parseClipCell=function(e,t,i,o,n){e.length||e.push([]);var r=t.substr(i,o-i),l=r.length;l>2&&'"'==r[0]&&'"'==r[l-1]&&r.indexOf('""')>-1?r=(r=r.substr(1,l-2)).replace(/""/g,'"'):"\t"==r&&(r="");e[e.length-1].push(r);n&&e.push([])};_EditHandler.prototype._expandClipRows=function(e,t){for(var i=e.length,o=0,n=0;n<i;n++)o=Math.max(o,e[n].length);for(var r=this._g,l=0,s=0,a=t.topRow;a<=t.bottomRow;a++)r.rows[a].isVisible&&l++;for(var c=t.leftCol;c<=t.rightCol;c++)r.columns[c].isVisible&&s++;if(l>1||s>1){1==l&&(l=i);1==s&&(s=o);if(s%o==0&&l%i==0){for(c=o;c<s;c++)for(a=0;a<i;a++)e[a].push(e[a%i][c%o]);for(a=i;a<l;a++)e.push(e[a%i])}}};_EditHandler.prototype._updateEditorCell=function(e,t,i){var o=this._g,n=o.cells.getCellElement(e,t),r=o._useFrozenDiv()&&(e<o.frozenRows||t<o.frozenColumns);if(!n||r||o._hasPendingUpdates())o.refresh(!1);else if(o.onUpdatingView(new wijmo_1.CancelEventArgs)){this._updateCell(n);(i||o._getHasValidation())&&this._updateRowHeaderCell(e);o.onUpdatedView()}};_EditHandler.prototype._updateRowHeaderCell=function(e){var t=this._g;if(t.headersVisibility&HeadersVisibility.Row){var i=t.rowHeaders,o=t._getEditColumnIndex(),n=i.getCellElement(e,o);n&&this._updateCell(n)}};_EditHandler.prototype._updateCell=function(e){var t=new HitTestInfo(e,null),i=FlexGrid._WJS_UPDATING;if(t.panel){wijmo_1.addClass(e,i);t.grid.cellFactory.updateCell(t.panel,t.row,t.col,e,t.range);wijmo_1.removeClass(e,i)}};_EditHandler.prototype._getValidationError=function(e){var t=this._g;if(t._getHasValidation()){var i=this._rng.row,o=this._rng.col,n=t.cellFactory.getEditorValue(t),r=t.getCellData(i,o,!1);if(e)return t._getError(t.cells,i,o,!0);if(t.setCellData(i,o,n,!0,!1)){var l=t._getError(t.cells,i,o);t.setCellData(i,o,r,!1,!1);return l}}return null};_EditHandler.prototype._allowEdit=function(e,t){var i=this._g;if(i.isReadOnly||i.selectionMode==SelectionMode.None)return!1;if(i.collectionView&&!i.editableCollectionView)return!1;if(null!=e){if(e<0||e>=i.rows.length)return!1;var o=i.rows[e];if(!o||o.isReadOnly||!o.isVisible)return!1}if(null!=t){if(t<0||t>=i.columns.length)return!1;var n=i._getBindingColumn(i.cells,e,i.columns[t]);if(!n||n.isReadOnly||!n.isVisible)return!1}return!0};_EditHandler.prototype._commitRowEdits=function(){var e=this._g;if(this.finishEditing()&&this._edItem){var t=e.editableCollectionView;if(t&&(t.currentEditItem||t.currentAddItem)){var i=new CellRangeEventArgs(e.cells,e.selection);e.onRowEditEnding(i);t.commitEdit();e.onRowEditEnded(i)}this._edItem=null}};_EditHandler.prototype._keydown=function(e){var t=this._edt;switch(e.keyCode){case wijmo_1.Key.F2:this._fullEdit=!this._fullEdit;e.preventDefault();return!0;case wijmo_1.Key.F4:this._toggleListBox(e);e.preventDefault();return!0;case wijmo_1.Key.Space:if(t&&"checkbox"==t.type&&!t.disabled&&!t.readOnly){t.checked=!t.checked;this.finishEditing();e.preventDefault()}return!0;case wijmo_1.Key.Enter:e.preventDefault();if(t&&e.altKey){var i=e.target;if(i instanceof HTMLTextAreaElement&&"soft"==i.wrap){var o=i.value,n=i.selectionStart,r=i.selectionEnd;i.value=o.substr(0,n)+"\n"+o.substr(r);wijmo_1.setSelectionRange(i,n+1)}return!0}return!this.finishEditing();case wijmo_1.Key.Tab:e.preventDefault();return!this.finishEditing();case wijmo_1.Key.Escape:e.preventDefault();this.finishEditing(!0);return!0;case wijmo_1.Key.Up:case wijmo_1.Key.Down:case wijmo_1.Key.Left:case wijmo_1.Key.Right:case wijmo_1.Key.PageUp:case wijmo_1.Key.PageDown:case wijmo_1.Key.Home:case wijmo_1.Key.End:if(this._lbx)return this._keydownListBox(e);if(e.altKey)switch(e.keyCode){case wijmo_1.Key.Up:case wijmo_1.Key.Down:this._toggleListBox(e);e.preventDefault();return!0}if(!this._fullEdit&&this.finishEditing())return!1}return!0};_EditHandler.prototype._keydownListBox=function(e){var t=!0;if(this._lbx)switch(e.keyCode){case wijmo_1.Key.Up:e.altKey?this._toggleListBox(e):this._lbx.selectedIndex>0&&this._lbx.selectedIndex--;break;case wijmo_1.Key.Down:e.altKey?this._toggleListBox(e):this._lbx.selectedIndex++;break;case wijmo_1.Key.Home:case wijmo_1.Key.PageUp:this._lbx.selectedIndex=0;break;case wijmo_1.Key.End:case wijmo_1.Key.PageDown:this._lbx.selectedIndex=this._lbx.collectionView.items.length-1;break;default:t=!1}if(t){e.preventDefault();return!0}return!1};_EditHandler.prototype._keypress=function(e){if("AltLeft"!=e.code&&"AltRight"!=e.code){var t=this._edt,i=e.charCode||32;if(t&&"checkbox"!=t.type&&wijmo_1.getActiveElement()==t&&this._list&&this._list.length>0&&i>=32){var o=t.selectionStart,n=t.value.substr(0,o);if(e.target==t&&e.charCode){n+=String.fromCharCode(e.charCode);o++}var r=this._findString(this._list,n,!0);r<0&&(r=this._findString(this._list,n,!1));if(r>-1){t.value=this._list[r];wijmo_1.setSelectionRange(t,o,t.value.length);t.dispatchEvent(this._evtInput);e.preventDefault&&e.preventDefault()}}}else e.preventDefault()};_EditHandler.prototype._findString=function(e,t,i){i||(t=t.toLowerCase());for(var o=0;o<e.length;o++){var n=e[o];if(null!=n){n=n.toString();i||(n=n.toLowerCase());if(0==n.indexOf(t))return o}}return-1};_EditHandler.prototype._toggleListBox=function(e,t){var i=this._g,o=i._selHdl.selection,n=i.isTouching;t||(t=o);if(this._lbx){this._removeListBox();if(o.contains(t)){i.activeEditor?i.activeEditor.focus():i.containsFocus()||i.focus();return!0}}var r=i.rows[t.row],l=i._getBindingColumn(i.cells,t.row,i.columns[t.col]),s=i._getMapEditor(r,l);if(!softInput()||s!=DataMapEditor.DropDownList)return!1;if(!this.startEditing(!0,t.row,t.col,!n,e))return!1;var a=this._lbx=this._createListBox();a.showSelection();n&&a.focus();return!0};_EditHandler.prototype._createListBox=function(){var e=this,t=this._g,i=t.activeEditor,o=this._rng,n=t.rows[o.row],r=t._getBindingColumn(t.cells,o.row,t.columns[o.col]),l=r.dataMap||n.dataMap,s=r.dropDownCssClass||n.dropDownCssClass,a=document.createElement("div");this._removeListBox();wijmo_1.addClass(a,"wj-dropdown-panel wj-grid-listbox");wijmo_1.addClass(a,s);var c=new mInput.ListBox(a,{maxHeight:n.renderHeight*_LB_PAGE_SIZE,isContentHtml:r.isContentHtml,itemsSource:l.getDisplayValues(n.dataItem),selectedValue:i?i.value:t.getCellData(o.row,o.col,!0)});c.addEventListener(c.hostElement,"click",(function(){e._removeListBox();t.focus();e.finishEditing()}));c.lostFocus.addHandler((function(){e._removeListBox()}));c.selectedIndexChanged.addHandler((function(){var i=t.activeEditor;if(i){i.value=e._list[c.selectedIndex];i.dispatchEvent(e._evtInput);wijmo_1.setSelectionRange(i,0,i.value.length)}}));var d=t.cells.getCellElement(o.row,o.col);if(d){wijmo_1.showPopup(a,d,!1,!1,!1);var u=d.querySelector("."+CellFactory._WJC_DROPDOWN);wijmo_1.setAttribute(u,"aria-expanded",!0)}else{wijmo_1.showPopup(a,t.getCellBoundingRect(o.row,o.col));a[wijmo_1.Control._OWNR_KEY]=t.hostElement}return c};_EditHandler.prototype._removeListBox=function(){var e=this._lbx;if(e){this._lbx=null;wijmo_1.hidePopup(e.hostElement,(function(){e.dispose()}))}};return _EditHandler}();exports._EditHandler=_EditHandler;!function(e){e[e.None=0]="None";e[e.MoveDown=1]="MoveDown";e[e.MoveAcross=2]="MoveAcross";e[e.Cycle=3]="Cycle";e[e.CycleOut=4]="CycleOut"}(KeyAction=exports.KeyAction||(exports.KeyAction={}));var _KeyboardHandler=function(){function _KeyboardHandler(e){this._kaTab=KeyAction.None;this._kaEnter=KeyAction.MoveDown;this._g=e;var t=e.hostElement;e.addEventListener(t,"keypress",this._keypress.bind(this));e.addEventListener(t,"keydown",this._keydown.bind(this))}_KeyboardHandler.prototype._keydown=function(e){var t=this._g,i=t._edtHdl,o=t.selection,n=e.ctrlKey||e.metaKey,r=e.shiftKey,l=e.altKey,s=e.target,a=e.char||e.key,c=!0;if(!n&&!l&&a&&1==a.length&&s.firstElementChild&&(" "!=a||!r)){var d=s.querySelectorAll("."+CellFactory._WJC_RADIOMAP+" label input");if(d&&d.length){for(var u=-1,h=0;h<d.length;h++)if(d[h].checked){u=h;break}a=a.toLowerCase();for(h=0;h<d.length;h++){var _=d[(u+h+1)%d.length],g=_.parentElement;if(" "==a||g.textContent[0].toLowerCase()==a){_.click();e.preventDefault();return}}}}if(!t._wantsInput(s)){var p=e.defaultPrevented&&!(s instanceof HTMLInputElement),f=wijmo_1.tryCast(t.rows[o.row],GroupRow),w=t.editableCollectionView,m=t._getKeyCode(e),C=SelMove,y=SelectionMode;if(!t.isRangeValid(o)&&t.selectionMode!=y.None&&m!=wijmo_1.Key.Tab){t.select(new CellRange(0,0),!1);o=t.selection}if(t.isRangeValid(o)&&!p&&(!t.activeEditor||!i._keydown(e)||t._isNativeCheckbox(t.activeEditor))){if(t.autoClipboard){if(n&&(67==m||45==m)){var v=new CellRangeEventArgs(t.cells,o);if(t.onCopying(v)){var b=HeadersVisibility,R=0!=(t.copyHeaders&b.Column),j=0!=(t.copyHeaders&b.Row),x=t.getClipString(null,!1,R,j)+"\r\n";t._eFocus.focus();wijmo_1.Clipboard.copy(x);t.onCopied(v)}e.stopPropagation();return}if(n&&86==m||r&&45==m){t.isReadOnly||wijmo_1.Clipboard.paste((function(e){t.setClipString(e)}));e.stopPropagation();return}}(r||n)&&"Space"==e.code&&(m=wijmo_1.Key.Space);switch(m){case wijmo_1.Key.Space:if(r&&o.isValid)switch(t.selectionMode){case y.CellRange:case y.MultiRange:case y.Row:case y.RowRange:case y.ListBox:t.select(new CellRange(o.row,0,o.row,t.columns.length-1),!1)}else if(n&&o.isValid)switch(t.selectionMode){case y.CellRange:case y.MultiRange:t.select(new CellRange(0,o.col,t.rows.length-1,o.col),!1)}else(c=this._startEditing(!0,e))&&setTimeout((function(){var e=t.activeEditor;if(e)if(e.disabled||e.readOnly)t.finishEditing();else if("checkbox"==e.type){e.checked=!e.checked;t.finishEditing()}}));break;case 65:if(n)switch(t.selectionMode){case y.None:case y.Cell:break;default:t.selectAll()}else c=!1;break;case wijmo_1.Key.Left:n||l?c=!1:o.isValid&&0==o.leftCol&&f&&!f.isCollapsed&&f.hasChildren?f.isCollapsed=!0:this._moveSel(C.None,n?C.Home:C.Prev,r);break;case wijmo_1.Key.Right:n||e.altKey?c=!1:o.isValid&&0==o.leftCol&&f&&f.isCollapsed?f.isCollapsed=!1:this._moveSel(C.None,n?C.End:C.Next,r);break;case wijmo_1.Key.Up:n?c=!1:e.altKey?c=i._toggleListBox(e):this._moveSel(C.Prev,C.None,r);break;case wijmo_1.Key.Down:n?c=!1:e.altKey?c=i._toggleListBox(e):this._moveSel(C.Next,C.None,r);break;case wijmo_1.Key.PageUp:this._moveSel(e.altKey?C.Home:C.PrevPage,C.None,r);if(t.rows.frozen&&t.selection.row<t.rows.frozen){var E=t.scrollPosition;E.y&&(t.scrollPosition=new wijmo_1.Point(E.x,0))}break;case wijmo_1.Key.PageDown:this._moveSel(e.altKey?C.End:C.NextPage,C.None,r);break;case wijmo_1.Key.Home:this._moveSel(n?C.Home:C.None,C.Home,r);break;case wijmo_1.Key.End:this._moveSel(n?C.End:C.None,C.End,r);break;case wijmo_1.Key.Tab:c=this._performKeyAction(t.keyActionTab,r);break;case wijmo_1.Key.Enter:c=this._performKeyAction(t.keyActionEnter,r);!r&&w&&null!=w.currentEditItem&&i._commitRowEdits();break;case wijmo_1.Key.Escape:c=!1;if(w&&(w.currentAddItem||w.currentEditItem)){var S=new CellRangeEventArgs(t.cells,t.selection);S.cancel=!0;t.onRowEditEnding(S);w.currentAddItem&&w.cancelNew();w.currentEditItem&&w.cancelEdit();t.onRowEditEnded(S);c=!0}t._mouseHdl.resetMouseState();break;case wijmo_1.Key.Delete:case wijmo_1.Key.Back:c=this._deleteSel(e);break;case wijmo_1.Key.F2:c=this._startEditing(!0,e);break;case wijmo_1.Key.F4:c=i._toggleListBox(e);break;default:c=!1}if(c){t.containsFocus()||t.focus();e.preventDefault();e.stopPropagation()}}}};_KeyboardHandler.prototype._performKeyAction=function(e,t){var i=KeyAction,o=SelMove;switch(e){case i.MoveDown:this._moveSel(t?o.Prev:o.Next,o.None,!1);return!0;case i.MoveAcross:this._moveSel(o.None,t?o.Prev:o.Next,!1);return!0;case i.Cycle:this._moveSel(o.None,t?o.PrevCell:o.NextCell,!1);return!0;case i.CycleOut:var n=this._g.selection;this._moveSel(o.None,t?o.PrevCell:o.NextCell,!1);return!n.equals(this._g.selection)}return!1};_KeyboardHandler.prototype._keypress=function(e){var t=this,i=this._g;if(!i._wantsInput(e.target)&&!e.defaultPrevented){var o=i._edtHdl;if(i.activeEditor)o._keypress(e);else if(e.charCode>wijmo_1.Key.Space&&"AltLeft"!=e.code&&"AltRight"!=e.code)if(this._startEditing(!1,e)&&i.activeEditor){var n=wijmo_1.getActiveElement();if(n instanceof HTMLInputElement&&"checkbox"!=n.type||n instanceof HTMLTextAreaElement){var r=i._selHdl.selection,l=i.getCellData(r.row,r.col,!0),s=i.getCellData(r.row,r.col,!1),a=wijmo_1.culture.Globalize.numberFormat["%"]||"%",c=String.fromCharCode(e.charCode),d=wijmo_1.isNumber(s)&&l.indexOf(a)>-1||""==l&&n.value==a;n.value=c+(d?a:"");wijmo_1.setSelectionRange(n,1);n.dispatchEvent(o._evtInput);o._keypress(e);o._edtValue=n.value!=l?n.value:null;e.preventDefault()}}else if(i.autoSearch){var u=!1;r=i._selHdl.selection;if(e.charCode>32||32==e.charCode&&this._search){e.preventDefault();this._search+=String.fromCharCode(e.charCode);this._toSearch&&clearTimeout(this._toSearch);this._toSearch=setTimeout((function(){t._toSearch=null;t._search=""}),wijmo_1.Control._SEARCH_DELAY);var h=this._findNext(r.row,r.col);if(h<0&&this._search.length>1){this._search=this._search[this._search.length-1];h=this._findNext(r.row,r.col)}if(h>-1){u=!0;i.select(h,r.col)}}u||(this._search="")}}};_KeyboardHandler.prototype._findNext=function(e,t){var i=this._g,o=i.rows.length;(e<0||1==this._search.length)&&e++;var n=this._search,r=i.caseSensitiveSearch;r||(n=n.toLowerCase());for(var l=0;l<o;l++){var s=(e+l)%o,a=i.getCellData(s,t,!0).trim();r||(a=a.toLowerCase());if(0==a.indexOf(this._search))return s}return-1};_KeyboardHandler.prototype._moveSel=function(e,t,i){var o=this._g;o.selectionMode!=SelectionMode.None&&o._selHdl.moveSelection(e,t,i)};_KeyboardHandler.prototype._deleteSel=function(e){var t=this,i=this._g,o=i.rows,n=i.editableCollectionView,r=i.selection,l=[],s=new CellRange,a=new CellEditEndingEventArgs(i.cells,s,e),c=SelectionMode;if(!i._edtHdl._allowEdit())return!1;if(i.allowDelete&&(null==n||n.canRemove&&!n.isAddingNew&&!n.isEditingItem)&&0==(l=o.filter((function(e){return e.isSelected}))).length)switch(i.selectionMode){case c.CellRange:case c.MultiRange:i.selectedRanges.forEach((function(e){if(0==e.leftCol&&e.rightCol==i.columns.length-1)for(var t=e.topRow;t>-1&&t<=e.bottomRow;t++){var n=o[t];l.indexOf(n)<0&&l.push(n)}}));break;case c.Row:r.topRow>-1&&l.push(o[r.topRow]);break;case c.RowRange:for(var d=r.topRow;d>-1&&d<=r.bottomRow;d++)l.push(o[d])}if(l.length>0){i.deferUpdate((function(){n&&n.beginUpdate();for(var e=l.length-1;e>=0;e--){var t=l[e];if(!(t instanceof _NewRowTemplate)){s.setRange(t.index,-1);if(i.onDeletingRow(a)){n&&t.dataItem?n.remove(t.dataItem):i.rows.removeAt(t.index);i.onDeletedRow(a)}}}n&&n.endUpdate(!1)}));var u=r.topRow;u=Math.min(u,i.rows.length-1);for(;u>0&&i.rows[u]instanceof _NewRowTemplate;)u--;r.row=r.row2=u;i.select(r,!1);i.childItemsPath&&n&&n.refresh();return!0}if(0==l.length){i.deferUpdate((function(){var o=i.scrollPosition;n&&n.beginUpdate();t._deleteRange(e,r);i.selectionMode==c.MultiRange&&i._selHdl.extendedSelection.forEach((function(i){t._deleteRange(e,i)}));i.select(r,!1);i.scrollPosition=o;n&&n.endUpdate()}));return!0}return!1};_KeyboardHandler.prototype._deleteRange=function(e,t){for(var i=this._g,o=i.editableCollectionView,n=new CellRange,r=new CellEditEndingEventArgs(i.cells,n,e),l=t.row>t.row2?1:-1,s=t.row2;t.containsRow(s);s+=l){var a=i.rows[s];if(!a.isReadOnly)for(var c=t.leftCol;c<=t.rightCol;c++){if(!i._getBindingColumn(i.cells,s,i.columns[c]).getIsRequired(a)&&i.canEditCell(a.index,c)&&i.getCellData(s,c,!0)){n.setRange(s,c);r.cancel=!1;if(i.onBeginningEdit(r)){if(o){var d=a.dataItem;o.editItem(d);i._edtHdl._edItem=d}i.setCellData(s,c,"",!0,!1);i.onCellEditEnding(r);i.onCellEditEnded(r)}}}}};_KeyboardHandler.prototype._startEditing=function(e,t,i,o){return this._g._edtHdl.startEditing(e,i,o,!0,t)};return _KeyboardHandler}();exports._KeyboardHandler=_KeyboardHandler;var AllowResizing,AutoSizeMode,AllowDragging,_AR_ALLCELLS=4,_WJC_DRAGSRC="wj-state-dragsrc",_WJC_FLEXGRID="wj-flexgrid";!function(e){e[e.None=0]="None";e[e.Columns=1]="Columns";e[e.Rows=2]="Rows";e[e.Both=3]="Both";e[e.ColumnsAllCells=e.Columns|_AR_ALLCELLS]="ColumnsAllCells";e[e.RowsAllCells=e.Rows|_AR_ALLCELLS]="RowsAllCells";e[e.BothAllCells=e.Both|_AR_ALLCELLS]="BothAllCells"}(AllowResizing=exports.AllowResizing||(exports.AllowResizing={}));!function(e){e[e.None=0]="None";e[e.Headers=1]="Headers";e[e.Cells=2]="Cells";e[e.Both=3]="Both"}(AutoSizeMode=exports.AutoSizeMode||(exports.AutoSizeMode={}));!function(e){e[e.None=0]="None";e[e.Columns=1]="Columns";e[e.Rows=2]="Rows";e[e.Both=3]="Both"}(AllowDragging=exports.AllowDragging||(exports.AllowDragging={}));var _MouseHandler=function(){function _MouseHandler(e){var t=this,i=e.hostElement,o=e.addEventListener.bind(e),n=e.removeEventListener.bind(e);this._g=e;this._dvMarker=wijmo_1.createElement('<div class="wj-marker">&nbsp;</div>');o(i,"mousedown",(function(i){e._rcBounds=null;if(!i.defaultPrevented&&0==i.button){var r=i.target;if(!e.containsFocus()){var l=r instanceof HTMLElement&&r.tabIndex>-1?r:e._eFocus;e._setFocusNoScroll(l)}setTimeout((function(){i.defaultPrevented||e.focus()}));var s=wijmo_1.closestClass(r,_WJC_FLEXGRID);if(s&&s!=e.hostElement||!e.activeEditor&&e._isInputElement(r)&&!t._hasRadioMap(i)&&!e._isNativeCheckbox(r)){var a=e.hitTest(i),c=CellType;switch(a.cellType){case c.Cell:e.select(a.range,!1);r instanceof HTMLElement&&"root"!=r.getAttribute("wj-part")&&r.focus();break;case c.ColumnHeader:case c.ColumnFooter:e.scrollIntoView(-1,a.col);break;case c.RowHeader:e.scrollIntoView(a.row,-1)}wijmo_1.isIE()&&a.cellType!=c.Cell&&e._isInputElement(r)&&r.focus();return}var d=document;n(d,"mousemove");n(d,"mouseup");o(d,"mousemove",mouseMove);o(d,"mouseup",mouseUp);t._isDown=!0;t._mousedown(i)}}));var mouseMove=function(e){t._mousemove(e)},mouseUp=function(e){t._isDown=!1;n(document,"mousemove");n(document,"mouseup");t._mouseup(e)};o(i,"mouseenter",(function(t){e._rcBounds=null}));o(i,"mousemove",this._hover.bind(this));o(i,"dblclick",this._dblclick.bind(this));o(i,"click",this._click.bind(this));o(i,"selectstart",(function(t){e._isInputElement(t.target)||t.preventDefault()}));o(i,"wheel",(function(t){if(!t.defaultPrevented&&t.deltaY&&!t.ctrlKey&&!t.metaKey){var i=e._root,o=t.deltaY,n=0;if(i.scrollHeight>i.offsetHeight&&wijmo_1.closestClass(t.target,_WJC_FLEXGRID)==e.hostElement){switch(t.deltaMode){case 1:n=e.rows.defaultSize*(o<0?-1:1);break;case 2:n=i.clientHeight*(o<0?-1:1);break;case 0:default:wijmo_1.isSafari()&&(o=wijmo_1.clamp(o,-150,150));n=o}e.focus();t.shiftKey?i.scrollLeft+=n:i.scrollTop+=n;t.preventDefault()}}}));o(i,"dragstart",this._dragstart.bind(this));o(i,"dragover",this._dragover.bind(this));o(i,"dragleave",this._dragover.bind(this));o(i,"drop",this._drop.bind(this));o(i,"dragend",this._dragend.bind(this))}_MouseHandler.prototype.resetMouseState=function(){var e=this._g,t=e.hostElement;if(this._updating){this._updating=!1;e.endUpdate()}this._dragSrc&&wijmo_1.removeClass(this._dragSrc,_WJC_DRAGSRC);this._showDragMarker(null);t&&(t.style.cursor="");e.removeEventListener(document,"mousemove");e.removeEventListener(document,"mouseup");this._eMouse=null;this._isDown=null;this._htDown=null;this._lbSelRows=null;this._szRowCol=null;this._szArgs=null;e._rcBounds=null};_MouseHandler.prototype._mousedown=function(e){var t=this._g,i=t.hitTest(e),o=i.cellType,n=CellType,r=e.ctrlKey||e.metaKey,l=e.target;this._selDown=t.selection;if(i.panel==t.cells){if(wijmo_1.closestClass(l,CellFactory._WJC_DROPDOWN)){t._edtHdl._toggleListBox(e,i.range);e.preventDefault();return}if(t.editRange&&t.editRange.contains(i.range))return}var s=wijmo_1.getActiveElement();if(l!=s||!t._isInputElement(l))if(o!=n.None){this._htDown=i;this._eMouse=e;this._resized=!1;if(null==this._szRowCol){var a=t.allowResizing,c=AllowResizing;if(o==n.RowHeader&&i.edgeBottom&&a&c.Rows&&this._getResizeRowHt(i))this._resized=!0;else if(o==n.ColumnHeader&&i.edgeRight&&a&c.Columns&&this._getResizeColHt(i))this._resized=!0;else{var d=t.allowDragging,u=AllowDragging;switch(o){case n.Cell:case n.RowHeader:r&&t.selectionMode==SelectionMode.ListBox&&this._startListBoxSelection(i.row);this._mouseSelect(e,e.shiftKey);if(o==n.RowHeader&&!(d&u.Rows)){e.preventDefault();t.focus()}break;case n.ColumnHeader:t.allowSorting||d&u.Columns||this._mouseSelect(e,e.shiftKey)}if(o==n.Cell&&t.rows.maxGroupLevel>-1){var h=wijmo_1.tryCast(t.rows[i.row],GroupRow),_=null!=wijmo_1.closestClass(l,CellFactory._WJC_COLLAPSE);if(wijmo_1.isIE9()&&t.showMarquee){var g=h?t.cells.getCellElement(i.row,i.col):null,p=g?g.querySelector("."+CellFactory._WJC_COLLAPSE):null,f=p?wijmo_1.Rect.fromBoundingRect(p.getBoundingClientRect()):null,w=e.touches||e;_=f&&f.contains(new wijmo_1.Point(w.clientX,w.clientY))}if(_){r?t.collapseGroupsToLevel(h.isCollapsed?h.level+1:h.level):h.isCollapsed=!h.isCollapsed;this.resetMouseState()}}}}else{var m=t._eFocus;if(s!=m){m.tabIndex=0;m.focus()}this._resized=!0;this._handleResizing(e)}}else{t.finishEditing();l!=t._root&&l!=t._fCt&&t._edtHdl._commitRowEdits()}};_MouseHandler.prototype._mousemove=function(e){if(this._htDown&&!e.defaultPrevented){if(0==e.buttons&&this._eMouse&&e.timeStamp-this._eMouse.timeStamp>600){this.resetMouseState();return}this._eMouse=e;if(this._szRowCol)this._handleResizing(e);else{var t=this._g,i=t.allowDragging,o=AllowDragging,n=CellType;switch(this._htDown.cellType){case n.Cell:this._mouseSelect(e,!0);break;case n.RowHeader:i&o.Rows||this._mouseSelect(e,!0);break;case n.ColumnHeader:i&o.Columns||t.allowSorting||this._mouseSelect(e,!0)}}}};_MouseHandler.prototype._mouseup=function(e){var t=this._g;if(!t.isTouching||!(this._dragSrc||e.target instanceof HTMLHtmlElement)){var i=t.hitTest(e),o=this._htDown;if(o&&!e.defaultPrevented){this._szArgs&&this._finishResizing(e);if(!this._szArgs&&i.panel==o.panel&&i.row==o.row&&i.col==o.col){var n=i.target;if(n!=o.target&&n instanceof HTMLElement){if(o.target instanceof HTMLInputElement){var r=i.point,l=o.point;Math.abs(r.x-l.x)+Math.abs(r.y-l.y)<10&&(n=n.querySelector("input")||n)}n.click()}}}this.resetMouseState()}};_MouseHandler.prototype._click=function(e){if(!e.defaultPrevented){var t=this._g,i=e.target;if(this._resized){e.preventDefault();return}var o=wijmo_1.tryCast(i,HTMLInputElement);!o&&t.bigCheckboxes&&(o=i.querySelector("input."+CellFactory._WJC_CHECKBOX));if(o!=t.activeEditor&&t._isNativeCheckbox(o)){if((r=t.hitTest(i)).panel==t.cells&&t.startEditing(!1,r.row,r.col,!1,e)){var n=t.getCellData(r.row,r.col,!1);t.activeEditor.checked=!n;t.finishEditing();t.focus()}return}if(this._hasRadioMap(e)){this._handleClick(e);return}if(!(e.ctrlKey||e.metaKey||e.shiftKey||t.activeEditor)){var r;if((r=t.hitTest(i)).panel==t.cells&&t.selection.equals(this._selDown)){t.startEditing(!0,null,null,!0,e);return}}this._handleClick(e)}};_MouseHandler.prototype._handleClick=function(e){var t=this._g,i=e.target,o=t.hitTest(i),n=o.panel;if(!e.defaultPrevented&&o.grid==t){if(n==t.cells&&this._hasRadioMap(e)){var r=i instanceof HTMLInputElement?i:i.querySelector("input");if(r instanceof HTMLInputElement&&!r.disabled){if(r.parentElement instanceof HTMLLabelElement&&t.startEditing(!1,o.row,o.col,!1)){t.setCellData(o.row,o.col,r.parentElement.textContent);t.finishEditing()}}return}if(!t._isInputElement(i)){if(n==t.topLeftCells){var l=SelectionMode;switch(t.selectionMode){case l.None:case l.Cell:break;default:t.selectAll()}return}if(n==t.columnHeaders){if(t.allowPinning&&wijmo_1.closestClass(i,CellFactory._WJC_PIN))this._clickPin(e,o);else if(wijmo_1.closestClass(e.target,CellFactory._WJC_COLLAPSE)){var s=t._getColumnGroup(o.row,o.col);s&&(s.isCollapsed=!s.isCollapsed)}else{i instanceof HTMLSpanElement&&i.parentElement instanceof HTMLLabelElement&&(i=i.parentElement.querySelector("input"));i instanceof HTMLInputElement||this._clickSort(e,o);t.focus()}return}if(n==t.cells){if(o.row<0){this._clickSort(e,o);return}if(wijmo_1.closestClass(i,CellFactory._WJC_COLLAPSE)){var a=t.rows[o.row];a instanceof GroupRow&&(e.ctrlKey?t.collapseGroupsToLevel(a.isCollapsed?a.level+1:a.level):a.isCollapsed=!a.isCollapsed);return}}}}};_MouseHandler.prototype._hasRadioMap=function(e){var t=e.target;if(t instanceof HTMLInputElement||t instanceof HTMLLabelElement){var i=wijmo_1.closestClass(t,CellFactory._WJC_RADIOMAP);return wijmo_1.closestClass(i,_WJC_FLEXGRID)==this._g.hostElement}};_MouseHandler.prototype._clickSort=function(e,t){var i=this._g,o=i.allowSorting,n=i.collectionView,r=n?n.sortDescriptions:null,l=e.ctrlKey||e.metaKey,s=e.shiftKey;if(n&&n.canSort&&o!=AllowSorting.None){var a=t.panel.columns[t.col],c=i._getBindingColumn(t.panel,t.row,a),d=c?c._getBindingSort():null;if(c.allowSorting&&d){if(a==c){var u=i.getMergedRange(t.panel,t.row,t.col,!1);if(u&&u.columnSpan>1)return}var h=new CellRangeEventArgs(t.panel,t.range,e);if(i.onSortingColumn(h)){i._edtHdl._commitRowEdits();for(var _=-1,g=0;g<r.length;g++)if(r[g].property==d){_=g;break}r.deferUpdate((function(){if(l&&s)r.clear();else if(_<0){o!=AllowSorting.MultiColumn&&r.clear();var e=new wijmo_1.SortDescription(d,!0);r.push(e)}else if(l)r.splice(_,1);else{e=new wijmo_1.SortDescription(d,!r[_].ascending);r.splice(_,1,e)}}));i.onSortedColumn(h)}}}};_MouseHandler.prototype._clickPin=function(e,t){var i=this._g,o=i.columns,n=o.frozen,r=i.allowPinning;r==AllowPinning.Both&&(r=e.shiftKey?AllowPinning.ColumnRange:AllowPinning.SingleColumn);var l=new CellRangeEventArgs(i.cells,t.range);if(i.onPinningColumn(l)){if(r==AllowPinning.SingleColumn)if(t.col>=n){o.moveElement(t.col,n,!1);o.frozen++}else{o.moveElement(t.col,n-1,!1);o.frozen--}r==AllowPinning.ColumnRange&&(t.col+1!=n?o.frozen=t.col+1:o.frozen=0);i.onPinnedColumn(l)}};_MouseHandler.prototype._dblclick=function(e){var t,i=this._g,o=i.hitTest(e),n=o.cellType,r=i.selection,l=o.range;if(!e.defaultPrevented){var s=i.allowResizing,a=AllowResizing,c=CellType;if(o.edgeRight&&s&a.Columns){if(n==c.ColumnHeader||n==c.Cell&&s&_AR_ALLCELLS){e.ctrlKey&&r.containsColumn(o.col)&&(l=r);for(var d=l.leftCol;d<=l.rightCol;d++)if(i.columns[d].allowResizing){t=new CellRangeEventArgs(i.cells,new CellRange(-1,d));if(i.onAutoSizingColumn(t)&&i.onResizingColumn(t)){this._resized=!0;i.autoSizeColumn(d);i.onResizedColumn(t);i.onAutoSizedColumn(t);e.preventDefault()}}}else if(n==c.TopLeft&&o.panel.columns[o.col].allowResizing){t=new CellRangeEventArgs(o.panel,new CellRange(-1,o.col));if(i.onAutoSizingColumn(t)&&i.onResizingColumn(t)){this._resized=!0;i.autoSizeColumn(o.col,!0);i.onAutoSizedColumn(t);i.onResizedColumn(t);e.preventDefault()}}this.resetMouseState()}else if(o.edgeBottom&&s&a.Rows){if(n==c.RowHeader||n==c.Cell&&s&_AR_ALLCELLS){e.ctrlKey&&r.containsRow(o.row)&&(l=r);for(var u=l.topRow;u<=l.bottomRow;u++)if(i.rows[u].allowResizing){t=new CellRangeEventArgs(i.cells,new CellRange(u,-1));if(i.onAutoSizingRow(t)&&i.onResizingRow(t)){this._resized=!0;i.autoSizeRow(u);i.onResizedRow(t);i.onAutoSizedRow(t);e.preventDefault()}}}else if(n==c.TopLeft&&o.getRow().allowResizing){t=new CellRangeEventArgs(o.panel,new CellRange(o.row,-1));if(i.onAutoSizingRow(t)&&i.onResizingRow(t)){this._resized=!0;i.autoSizeRow(o.row,!0);i.onResizedRow(t);i.onAutoSizedRow(t);e.preventDefault()}}this.resetMouseState()}else;}};_MouseHandler.prototype._hover=function(e){if(!this._isDown){var t=this._g,i=t.hitTest(e),o="";this._szRowCol=this._getResizeColHt(i)||this._getResizeRowHt(i);this._szRowCol instanceof Column?o="col-resize":this._szRowCol instanceof Row&&(o="row-resize");this._szStart=this._szRowCol?this._szRowCol.renderSize:0;t.hostElement.style.cursor=o;return i}return null};_MouseHandler.prototype._getResizeColHt=function(e){var t,i=this._g.allowResizing,o=e.cellType,n=CellType;if(i&AllowResizing.Columns&&(o==n.ColumnHeader||o==n.TopLeft||o==n.Cell&&i&_AR_ALLCELLS)){e.edgeRight&&(t=e.getColumn());e.edgeFarRight&&(t=this._getResizeCol(e.panel,e.col)||e.getColumn());e.edgeLeft&&(t=this._getResizeCol(e.panel,e.col,!0))}return t&&t.allowResizing?t:null};_MouseHandler.prototype._getResizeRowHt=function(e){var t,i=this._g.allowResizing,o=e.cellType,n=CellType;if(i&AllowResizing.Rows&&(o==n.RowHeader||o==n.TopLeft||o==n.Cell&&i&_AR_ALLCELLS)){e.edgeBottom&&(t=e.getRow());e.edgeFarBottom&&(t=this._getResizeRow(e.panel,e.row)||e.getRow());e.edgeTop&&(t=this._getResizeRow(e.panel,e.row,!0))}return t&&t.allowResizing?t:null};_MouseHandler.prototype._getResizeCol=function(e,t,i){void 0===i&&(i=!1);var o=this._g,n=e.columns;if(i){for(var r=t-1;r>=0;r--){if((l=n[r]).visible)return this._asResizable(l)}if(n==o.columns&&0!=(o.headersVisibility&HeadersVisibility.Row))for(r=(n=o.rowHeaders.columns).length-1;r>=0;r--){if((l=n[r]).visible)return this._asResizable(l)}return null}for(r=t+1;r<n.length;r++){if((l=n[r]).visible)return this._asResizable(l)}if(t==n.length-1&&n==o.rowHeaders.columns){n=o.columns;for(r=0;r<n.length;r++){var l;if((l=n[r]).visible)return this._asResizable(l)}}return null};_MouseHandler.prototype._getResizeRow=function(e,t,i){void 0===i&&(i=!1);var o=this._g,n=e.rows;if(i){for(var r=t-1;r>=0;r--){if((l=n[r]).visible)return this._asResizable(l)}if(n==o.rows&&0!=(o.headersVisibility&HeadersVisibility.Column))for(r=(n=o.columnHeaders.rows).length-1;r>=0;r--){if((l=n[r]).visible)return this._asResizable(l)}return null}for(r=t+1;r<n.length;r++){if((l=n[r]).visible)return this._asResizable(l)}if(t==n.length-1&&n==o.columnHeaders.rows){n=o.rows;for(r=0;r<n.length;r++){var l;if((l=n[r]).visible)return this._asResizable(l)}}return null};_MouseHandler.prototype._asResizable=function(e){return 0==e.renderSize&&e.allowResizing?e:null};_MouseHandler.prototype._mouseSelect=function(e,t){var i=this,o=this._g;if(e&&this._htDown&&this._htDown.panel&&o.selectionMode!=SelectionMode.None){var n=new HitTestInfo(this._htDown.panel,e);this._handleSelection(n,t);!wijmo_1.isIE9()&&e.button>=0&&e.target!=o._root&&((n=new HitTestInfo(o,e)).panel||setTimeout((function(){i._isDown&&i._eMouse&&i._mouseSelect(i._eMouse,t)}),100))}};_MouseHandler.prototype._handleResizing=function(e){e.preventDefault();if(this._szRowCol instanceof Column){var t=this._g,i=wijmo_1.mouseToPage(e).x,o=Math.round(Math.max(_MouseHandler._SZ_MIN,this._szStart+(i-this._htDown.point.x)*(t.rightToLeft?-1:1)));if(this._szRowCol.renderSize!=o){if(null==this._szArgs){var n=t.rowHeaders.columns.indexOf(this._szRowCol)>-1?t.rowHeaders:t.cells;this._szArgs=new CellRangeEventArgs(n,new CellRange(-1,this._szRowCol.index))}this._szArgs.cancel=!1;t.onResizingColumn(this._szArgs)&&(t.deferResizing?this._showResizeMarker(o):this._szRowCol.width=o)}}if(this._szRowCol instanceof Row){t=this._g;var r=wijmo_1.mouseToPage(e).y;o=Math.round(Math.max(_MouseHandler._SZ_MIN,this._szStart+(r-this._htDown.point.y)));if(this._szRowCol.renderSize!=o){if(null==this._szArgs){n=t.columnHeaders.rows.indexOf(this._szRowCol)>-1?t.columnHeaders:t.cells;this._szArgs=new CellRangeEventArgs(n,new CellRange(this._szRowCol.index,-1))}this._szArgs.cancel=!1;t.onResizingRow(this._szArgs)&&(t.deferResizing?this._showResizeMarker(o):this._szRowCol.height=o)}}};_MouseHandler.prototype._dragstart=function(e){var t=this._g,i=this._htDown,o=AllowDragging;if(i){this._dragSrc=null;this._htDrag=null;if(!this._szRowCol){var n=new CellRangeEventArgs(i.panel,i.range);if(i.cellType==CellType.ColumnHeader&&t.allowDragging&o.Columns&&i.col>-1&&t.columns[i.col].allowDragging)t.onDraggingColumn(n)?this._dragSrc=e.target:e.preventDefault();else if(i.cellType==CellType.RowHeader&&t.allowDragging&o.Rows&&i.row>-1&&t.rows[i.row].allowDragging){var r=t.rows[i.row];r instanceof GroupRow||r instanceof _NewRowTemplate||(t.onDraggingRow(n)?this._dragSrc=e.target:e.preventDefault())}else i.cellType==CellType.TopLeft&&t.allowDragging&o.Columns&&i.col>-1&&t.topLeftCells.columns[i.col].allowDragging&&(t.onDraggingColumn(n)?this._dragSrc=e.target:e.preventDefault())}if(this._dragSrc&&e.dataTransfer&&!e.defaultPrevented){this._htDrag=i;wijmo_1._startDrag(e.dataTransfer,"move");e.stopPropagation();wijmo_1.addClass(this._dragSrc,_WJC_DRAGSRC);t.beginUpdate();this._updating=!0}}};_MouseHandler.prototype._dragend=function(e){this._dragSrc=null;this._htDrag=null;this.resetMouseState()};_MouseHandler.prototype._dragover=function(e){var t=this._g,i=this._hitTest(e),o=this._dragSrc?this._htDrag:null,n=CellType,r=!1;if(o&&i.cellType==o.cellType){var l=new CellRangeEventArgs(i.panel,i.range,o);if(i.cellType==n.ColumnHeader){l.cancel=!t.columns.canMoveElement(o.col,i.col);r=t.onDraggingColumnOver(l)}else if(i.cellType==n.RowHeader){l.cancel=!t.rows.canMoveElement(o.row,i.row);r=t.onDraggingRowOver(l)}else if(i.cellType==n.TopLeft){l.cancel=!t.topLeftCells.columns.canMoveElement(o.col,i.col);r=t.onDraggingColumnOver(l)}}if(r){e.dataTransfer.dropEffect="move";e.preventDefault();e.stopPropagation();this._showDragMarker(i)}else this._showDragMarker(null);if(o&&t.autoScroll){var s=t.controlRect,a=t.scrollPosition,c=wijmo_1.Control._DRAG_SCROLL_EDGE,d=wijmo_1.Control._DRAG_SCROLL_STEP;if(o.panel==t.columnHeaders){e.pageX-s.left<c&&(a.x+=d);s.right-e.pageX<c&&(a.x-=d)}else if(o.panel==t.rowHeaders){e.pageY-s.top<c&&(a.y+=d);s.bottom-e.pageY<c&&(a.y-=d)}if(!a.equals(t._ptScrl)){t.scrollPosition=a;t._rcBounds=null}}};_MouseHandler.prototype._drop=function(e){var t=this._g,i=this._hitTest(e),o=this._dragSrc?this._htDrag:null,n=CellType;if(o&&i.cellType==o.cellType){var r=t.selection,l=new CellRangeEventArgs(i.panel,i.range,o);if(i.cellType==n.ColumnHeader){t.columns.moveElement(o.col,i.col);t.select(r.row,i.col);t.onDraggedColumn(l)}else if(i.cellType==n.RowHeader){t.rows.moveElement(o.row,i.row);t.select(i.row,r.col);t.onDraggedRow(l)}else if(i.cellType==n.TopLeft){t.topLeftCells.columns.moveElement(o.col,i.col);t.onDraggedColumn(l)}}this.resetMouseState()};_MouseHandler.prototype._hitTest=function(e){var t=this._g;t._rcBounds=null;return t.hitTest(e)};_MouseHandler.prototype._showResizeMarker=function(e){var t,i=this._g,o=i._ptScrl,n=this._szArgs.panel.cellType,r=CellType,l=this._dvMarker,s=i.cells.hostElement;l.parentElement!=s&&s.appendChild(l);if(this._szRowCol instanceof Column){t={left:this._szRowCol.pos+e-1,top:-1e3,right:"",bottom:0,width:3,height:""};n!=r.TopLeft&&n!=r.RowHeader||(t.left-=i._eTL.offsetWidth+o.x);n==r.Cell&&this._szRowCol.index<i.frozenColumns&&(t.left-=o.x);i.rightToLeft&&(t.left=s.clientWidth-t.left-t.width)}else{t={left:-1e3,top:this._szRowCol.pos+e-1,right:0,bottom:"",width:"",height:3};n!=r.TopLeft&&n!=r.ColumnHeader||(t.top-=i._eTL.offsetHeight+o.y);n==r.Cell&&this._szRowCol.index<i.frozenRows&&(t.top-=o.y)}wijmo_1.setCss(l,t)};_MouseHandler.prototype._showDragMarker=function(e){var t=this._dvMarker;if(e&&e.panel){if(!e.range.equals(this._rngTarget)){this._rngTarget=e.range;var i=e.panel.hostElement;t.parentElement!=i&&i.appendChild(t);var o=this._g,n=o._ptScrl,r=CellType,l={left:0,top:0,width:6,height:6,right:"",bottom:""};switch(e.cellType){case r.TopLeft:case r.ColumnHeader:var s=e.panel.columns[e.col];l.left=s.pos-l.width/2;l.height=e.panel.height;this._htDown&&e.col>this._htDown.col&&(l.left+=s.renderWidth);e.cellType==r.ColumnHeader&&e.col<o.frozenColumns&&(l.left-=n.x);o.rightToLeft&&(l.left=t.parentElement.clientWidth-l.left-l.width);break;case r.RowHeader:var a=e.getRow();l.top=a.pos-l.height/2;l.width=e.panel.width;e.row>this._htDown.row&&(l.top+=a.renderHeight);e.row<o.frozenRows&&(l.top-=n.y)}wijmo_1.setCss(t,l)}}else{wijmo_1.removeChild(t);this._rngTarget=null}};_MouseHandler.prototype._finishResizing=function(e){var t=this._g,i=t.selection,o=this._szArgs,n=this._eMouse&&this._eMouse.ctrlKey,r=CellType;if(o&&!o.cancel){if(o.col>-1){var l=o.col,s=wijmo_1.mouseToPage(e).x,a=Math.round(Math.max(_MouseHandler._SZ_MIN,this._szStart+(s-this._htDown.point.x)*(this._g.rightToLeft?-1:1)));o.panel.columns[l].width=Math.round(a);t.onResizedColumn(o);if(n&&this._htDown.cellType==r.ColumnHeader&&i.containsColumn(l))for(var c=i.leftCol;c<=i.rightCol;c++)if(t.columns[c].allowResizing&&c!=l){o=new CellRangeEventArgs(t.cells,new CellRange(-1,c));if(t.onResizingColumn(o)){t.columns[c].size=t.columns[l].size;t.onResizedColumn(o)}}e.preventDefault()}if(o.row>-1){var d=o.row,u=wijmo_1.mouseToPage(e).y;a=Math.round(Math.max(_MouseHandler._SZ_MIN,this._szStart+(u-this._htDown.point.y)));o.getRow().height=Math.round(a);t.onResizedRow(o);if(n&&this._htDown.cellType==r.RowHeader&&i.containsRow(d))for(var h=i.topRow;h<=i.bottomRow;h++)if(t.rows[h].allowResizing&&h!=d){o=new CellRangeEventArgs(t.cells,new CellRange(h,-1));if(t.onResizingRow(o)){t.rows[h].size=t.rows[d].size;t.onResizedRow(o)}}e.preventDefault()}}};_MouseHandler.prototype._startListBoxSelection=function(e){var t=this._g.rows,i=this._lbSelRows={};this._lbSelState=!t[e].isSelected;for(var o=0;o<t.length;o++)t[o].isSelected&&(i[o]=!0)};_MouseHandler.prototype._handleSelection=function(e,t){var i=this._g,o=i._selHdl.selection,n=new CellRange(e.row,e.col),r=CellType;if(n.isValid)if(this._lbSelRows)this._handleListBoxSelection(e,t);else{switch(e.cellType){case r.RowHeader:n.col=0;n.col2=i.columns.length-1;break;case r.ColumnHeader:n.row=0;n.row2=i.rows.length-1}if(t){if(i.anchorCursor){n.row=o.row;n.col=o.col}else{n.row2=o.row2;n.col2=o.col2}if(!n.isValid){var l=this._htDown;l&&(n=new CellRange(l.row,l.col))}}if(i.selectionMode==SelectionMode.MultiRange){var s=i._mouseHdl._eMouse,a=s&&(s.ctrlKey||s.metaKey),c=i._selHdl,d=c.selection,u=c.extendedSelection;if(a){if(!t&&c._deselectRange(n))c.selection.isValid&&(n=null);else if(d.isValid&&!d.intersects(n)){this._splitRange(d).forEach((function(e){u.push(e)}))}}else u.clear()}if(n){i.select(n,!1);switch(e.cellType){case r.RowHeader:i.scrollIntoView(e.row,-1);break;case r.ColumnHeader:i.scrollIntoView(-1,e.col);break;default:i.scrollIntoView(e.row,e.col)}}else{var h=new CellRangeEventArgs(i.cells,new CellRange(e.row,e.col));i.onSelectionChanging(h);i.onSelectionChanged(h);i.invalidate()}}};_MouseHandler.prototype._handleListBoxSelection=function(e,t){var i=this,o=this._g,n=o.rows,r=o._selHdl.selection,l=new CellRange(e.row,e.col,this._htDown.row,this._htDown.col),s=!1;n.forEach((function(e,t){var n=l.containsRow(t)?i._lbSelState:null!=i._lbSelRows[t];if(n!=e.isSelected){var a=new CellRangeEventArgs(o.cells,new CellRange(t,r.col,t,r.col2));if(o.onSelectionChanging(a)){e._setFlag(RowColFlags.Selected,n,!0);s=!0;o.onSelectionChanged(a)}}}));s&&o.refreshCells(!1,!0,!0);o.scrollIntoView(e.row,e.col)};_MouseHandler.prototype._splitRange=function(e){var t=this._g,i=t.columns.length,o=t.rows.length,n=[];if(e.columnSpan==i)for(var r=e.topRow;r<=e.bottomRow;r++)n.push(new CellRange(r,0,r,i-1));else if(e.rowSpan==o)for(var l=e.leftCol;l<=e.rightCol;l++)n.push(new CellRange(0,l,o-1,l));else n.push(e.clone());return n};_MouseHandler._SZ_MIN=0;return _MouseHandler}();exports._MouseHandler=_MouseHandler;wijmo_1._registerModule("wijmo.grid",selfModule);